/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/aztec/encoder/Encoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import BitArray from"../../common/BitArray";import IllegalArgumentException from"../../IllegalArgumentException";import StringUtils from"../../common/StringUtils";import BitMatrix from"../../common/BitMatrix";import AztecCode from"./AztecCode";import ReedSolomonEncoder from"../../common/reedsolomon/ReedSolomonEncoder";import GenericGF from"../../common/reedsolomon/GenericGF";import HighLevelEncoder from"./HighLevelEncoder";import Integer from"../../util/Integer";export default class Encoder{constructor(){}static encodeBytes(e){return Encoder.encode(e,Encoder.DEFAULT_EC_PERCENT,Encoder.DEFAULT_AZTEC_LAYERS)}static encode(e,t,r){let n,o,i,s,c,l=new HighLevelEncoder(e).encode(),a=Integer.truncDivision(l.getSize()*t,100)+11,d=l.getSize()+a;if(r!==Encoder.DEFAULT_AZTEC_LAYERS){if(n=r<0,o=Math.abs(r),o>(n?Encoder.MAX_NB_BITS_COMPACT:Encoder.MAX_NB_BITS))throw new IllegalArgumentException(StringUtils.format("Illegal value %s for layers",r));i=Encoder.totalBitsInLayer(o,n),s=Encoder.WORD_SIZE[o];let e=i-i%s;if(c=Encoder.stuffBits(l,s),c.getSize()+a>e)throw new IllegalArgumentException("Data to large for user specified layer");if(n&&c.getSize()>64*s)throw new IllegalArgumentException("Data to large for user specified layer")}else{s=0,c=null;for(let e=0;;e++){if(e>Encoder.MAX_NB_BITS)throw new IllegalArgumentException("Data too large for an Aztec code");if(n=e<=3,o=n?e+1:e,i=Encoder.totalBitsInLayer(o,n),d>i)continue;null!=c&&s===Encoder.WORD_SIZE[o]||(s=Encoder.WORD_SIZE[o],c=Encoder.stuffBits(l,s));let t=i-i%s;if(!(n&&c.getSize()>64*s)&&c.getSize()+a<=t)break}}let g,E=Encoder.generateCheckWords(c,i,s),f=c.getSize()/s,u=Encoder.generateModeMessage(n,o,f),A=(n?11:14)+4*o,m=new Int32Array(A);if(n){g=A;for(let e=0;e<m.length;e++)m[e]=e}else{g=A+1+2*Integer.truncDivision(Integer.truncDivision(A,2)-1,15);let e=Integer.truncDivision(A,2),t=Integer.truncDivision(g,2);for(let r=0;r<e;r++){let n=r+Integer.truncDivision(r,15);m[e-r-1]=t-n-1,m[e+r]=t+n+1}}let I=new BitMatrix(g);for(let e=0,t=0;e<o;e++){let r=4*(o-e)+(n?9:12);for(let n=0;n<r;n++){let o=2*n;for(let i=0;i<2;i++)E.get(t+o+i)&&I.set(m[2*e+i],m[2*e+n]),E.get(t+2*r+o+i)&&I.set(m[2*e+n],m[A-1-2*e-i]),E.get(t+4*r+o+i)&&I.set(m[A-1-2*e-i],m[A-1-2*e-n]),E.get(t+6*r+o+i)&&I.set(m[A-1-2*e-n],m[2*e+i])}t+=8*r}if(Encoder.drawModeMessage(I,n,g,u),n)Encoder.drawBullsEye(I,Integer.truncDivision(g,2),5);else{Encoder.drawBullsEye(I,Integer.truncDivision(g,2),7);for(let e=0,t=0;e<Integer.truncDivision(A,2)-1;e+=15,t+=16)for(let e=1&Integer.truncDivision(g,2);e<g;e+=2)I.set(Integer.truncDivision(g,2)-t,e),I.set(Integer.truncDivision(g,2)+t,e),I.set(e,Integer.truncDivision(g,2)-t),I.set(e,Integer.truncDivision(g,2)+t)}let p=new AztecCode;return p.setCompact(n),p.setSize(g),p.setLayers(o),p.setCodeWords(f),p.setMatrix(I),p}static drawBullsEye(e,t,r){for(let n=0;n<r;n+=2)for(let r=t-n;r<=t+n;r++)e.set(r,t-n),e.set(r,t+n),e.set(t-n,r),e.set(t+n,r);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)}static generateModeMessage(e,t,r){let n=new BitArray;return e?(n.appendBits(t-1,2),n.appendBits(r-1,6),n=Encoder.generateCheckWords(n,28,4)):(n.appendBits(t-1,5),n.appendBits(r-1,11),n=Encoder.generateCheckWords(n,40,4)),n}static drawModeMessage(e,t,r,n){let o=Integer.truncDivision(r,2);if(t)for(let t=0;t<7;t++){let r=o-3+t;n.get(t)&&e.set(r,o-5),n.get(t+7)&&e.set(o+5,r),n.get(20-t)&&e.set(r,o+5),n.get(27-t)&&e.set(o-5,r)}else for(let t=0;t<10;t++){let r=o-5+t+Integer.truncDivision(t,5);n.get(t)&&e.set(r,o-7),n.get(t+10)&&e.set(o+7,r),n.get(29-t)&&e.set(r,o+7),n.get(39-t)&&e.set(o-7,r)}}static generateCheckWords(e,t,r){let n=e.getSize()/r,o=new ReedSolomonEncoder(Encoder.getGF(r)),i=Integer.truncDivision(t,r),s=Encoder.bitsToWords(e,r,i);o.encode(s,i-n);let c=t%r,l=new BitArray;l.appendBits(0,c);for(const e of Array.from(s))l.appendBits(e,r);return l}static bitsToWords(e,t,r){let n,o,i=new Int32Array(r);for(n=0,o=e.getSize()/t;n<o;n++){let r=0;for(let o=0;o<t;o++)r|=e.get(n*t+o)?1<<t-o-1:0;i[n]=r}return i}static getGF(e){switch(e){case 4:return GenericGF.AZTEC_PARAM;case 6:return GenericGF.AZTEC_DATA_6;case 8:return GenericGF.AZTEC_DATA_8;case 10:return GenericGF.AZTEC_DATA_10;case 12:return GenericGF.AZTEC_DATA_12;default:throw new IllegalArgumentException("Unsupported word size "+e)}}static stuffBits(e,t){let r=new BitArray,n=e.getSize(),o=(1<<t)-2;for(let i=0;i<n;i+=t){let s=0;for(let r=0;r<t;r++)(i+r>=n||e.get(i+r))&&(s|=1<<t-1-r);(s&o)===o?(r.appendBits(s&o,t),i--):0==(s&o)?(r.appendBits(1|s,t),i--):r.appendBits(s,t)}return r}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}Encoder.DEFAULT_EC_PERCENT=33,Encoder.DEFAULT_AZTEC_LAYERS=0,Encoder.MAX_NB_BITS=32,Encoder.MAX_NB_BITS_COMPACT=4,Encoder.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);
//# sourceMappingURL=/sm/e69932b100988f7f55ce5418f138816d8435e75130a39bb034a3b0f97d5b5b10.map