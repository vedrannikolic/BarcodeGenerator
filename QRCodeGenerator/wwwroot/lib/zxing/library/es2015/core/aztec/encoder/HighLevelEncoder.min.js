/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/aztec/encoder/HighLevelEncoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Collections from"../../util/Collections";import State from"./State";import*as C from"./EncoderConstants";import*as CharMap from"./CharMap";import*as ShiftTable from"./ShiftTable";import StringUtils from"../../common/StringUtils";export default class HighLevelEncoder{constructor(t){this.text=t}encode(){const t=StringUtils.getCharCode(" "),e=StringUtils.getCharCode("\n");let i=Collections.singletonList(State.INITIAL_STATE);for(let r=0;r<this.text.length;r++){let a,o=r+1<this.text.length?this.text[r+1]:0;switch(this.text[r]){case StringUtils.getCharCode("\r"):a=o===e?2:0;break;case StringUtils.getCharCode("."):a=o===t?3:0;break;case StringUtils.getCharCode(","):a=o===t?4:0;break;case StringUtils.getCharCode(":"):a=o===t?5:0;break;default:a=0}a>0?(i=HighLevelEncoder.updateStateListForPair(i,r,a),r++):i=this.updateStateListForChar(i,r)}return Collections.min(i,((t,e)=>t.getBitCount()-e.getBitCount())).toBitArray(this.text)}updateStateListForChar(t,e){const i=[];for(let r of t)this.updateStateForChar(r,e,i);return HighLevelEncoder.simplifyStates(i)}updateStateForChar(t,e,i){let r=255&this.text[e],a=CharMap.CHAR_MAP[t.getMode()][r]>0,o=null;for(let s=0;s<=C.MODE_PUNCT;s++){let n=CharMap.CHAR_MAP[s][r];if(n>0){if(null==o&&(o=t.endBinaryShift(e)),!a||s===t.getMode()||s===C.MODE_DIGIT){const t=o.latchAndAppend(s,n);i.push(t)}if(!a&&ShiftTable.SHIFT_TABLE[t.getMode()][s]>=0){const t=o.shiftAndAppend(s,n);i.push(t)}}}if(t.getBinaryShiftByteCount()>0||0===CharMap.CHAR_MAP[t.getMode()][r]){let r=t.addBinaryShiftChar(e);i.push(r)}}static updateStateListForPair(t,e,i){const r=[];for(let a of t)this.updateStateForPair(a,e,i,r);return this.simplifyStates(r)}static updateStateForPair(t,e,i,r){let a=t.endBinaryShift(e);if(r.push(a.latchAndAppend(C.MODE_PUNCT,i)),t.getMode()!==C.MODE_PUNCT&&r.push(a.shiftAndAppend(C.MODE_PUNCT,i)),3===i||4===i){let t=a.latchAndAppend(C.MODE_DIGIT,16-i).latchAndAppend(C.MODE_DIGIT,1);r.push(t)}if(t.getBinaryShiftByteCount()>0){let i=t.addBinaryShiftChar(e).addBinaryShiftChar(e+1);r.push(i)}}static simplifyStates(t){let e=[];for(const i of t){let t=!0;for(const r of e){if(r.isBetterThanOrEqualTo(i)){t=!1;break}i.isBetterThanOrEqualTo(r)&&(e=e.filter((t=>t!==r)))}t&&e.push(i)}return e}}
//# sourceMappingURL=/sm/658af22a467d58dd5a7acb6dbcc45171796765b0fd60c6ea6817f7a6dccfeda8.map