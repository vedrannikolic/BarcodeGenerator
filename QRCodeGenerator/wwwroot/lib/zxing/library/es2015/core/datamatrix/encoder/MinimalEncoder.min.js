/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/datamatrix/encoder/MinimalEncoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{MACRO_05_HEADER,MACRO_06_HEADER,MACRO_TRAILER}from"./constants";import HighLevelEncoder from"./HighLevelEncoder";import{MinimalECIInput}from"../../common/MinimalECIInput";import Integer from"../../util/Integer";var Mode;!function(e){e[e.ASCII=0]="ASCII",e[e.C40=1]="C40",e[e.TEXT=2]="TEXT",e[e.X12=3]="X12",e[e.EDF=4]="EDF",e[e.B256=5]="B256"}(Mode||(Mode={}));const C40_SHIFT2_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"];export class MinimalEncoder{static isExtendedASCII(e,t){return e!==t&&e>=128&&e<=255}static isInC40Shift1Set(e){return e<=31}static isInC40Shift2Set(e,t){for(const t of C40_SHIFT2_CHARS)if(t.charCodeAt(0)===e)return!0;return e===t}static isInTextShift1Set(e){return this.isInC40Shift1Set(e)}static isInTextShift2Set(e,t){return this.isInC40Shift2Set(e,t)}static encodeHighLevel(e,t=null,i=-1,s=0){let r=0;return e.startsWith(MACRO_05_HEADER)&&e.endsWith(MACRO_TRAILER)?(r=5,e=e.substring(MACRO_05_HEADER.length,e.length-2)):e.startsWith(MACRO_06_HEADER)&&e.endsWith(MACRO_TRAILER)&&(r=6,e=e.substring(MACRO_06_HEADER.length,e.length-2)),decodeURIComponent(escape(String.fromCharCode(...this.encode(e,t,i,s,r))))}static encode(e,t,i,s,r){return this.encodeMinimally(new Input(e,t,i,s,r)).getBytes()}static addEdge(e,t){const i=t.fromPosition+t.characterLength;(null===e[i][t.getEndMode()]||e[i][t.getEndMode()].cachedTotalSize>t.cachedTotalSize)&&(e[i][t.getEndMode()]=t)}static getNumberOfC40Words(e,t,i,s){let r=0;for(let o=t;o<e.length();o++){if(e.isECI(o))return s[0]=0,0;const n=e.charAt(o);if(i&&HighLevelEncoder.isNativeC40(n)||!i&&HighLevelEncoder.isNativeText(n))r++;else if(MinimalEncoder.isExtendedASCII(n,e.getFNC1Character())){const e=255&n;e>=128&&(i&&HighLevelEncoder.isNativeC40(e-128)||!i&&HighLevelEncoder.isNativeText(e-128))?r+=3:r+=4}else r+=2;if(r%3==0||(r-2)%3==0&&o+1===e.length())return s[0]=o-t+1,Math.ceil(r/3)}return s[0]=0,0}static addEdges(e,t,i,s){if(e.isECI(i))return void this.addEdge(t,new Edge(e,Mode.ASCII,i,1,s));const r=e.charAt(i);if(null===s||s.getEndMode()!==Mode.EDF){HighLevelEncoder.isDigit(r)&&e.haveNCharacters(i,2)&&HighLevelEncoder.isDigit(e.charAt(i+1))?this.addEdge(t,new Edge(e,Mode.ASCII,i,2,s)):this.addEdge(t,new Edge(e,Mode.ASCII,i,1,s));const o=[Mode.C40,Mode.TEXT];for(const r of o){const o=[];MinimalEncoder.getNumberOfC40Words(e,i,r===Mode.C40,o)>0&&this.addEdge(t,new Edge(e,r,i,o[0],s))}e.haveNCharacters(i,3)&&HighLevelEncoder.isNativeX12(e.charAt(i))&&HighLevelEncoder.isNativeX12(e.charAt(i+1))&&HighLevelEncoder.isNativeX12(e.charAt(i+2))&&this.addEdge(t,new Edge(e,Mode.X12,i,3,s)),this.addEdge(t,new Edge(e,Mode.B256,i,1,s))}let o;for(o=0;o<3;o++){const r=i+o;if(!e.haveNCharacters(r,1)||!HighLevelEncoder.isNativeEDIFACT(e.charAt(r)))break;this.addEdge(t,new Edge(e,Mode.EDF,i,o+1,s))}3===o&&e.haveNCharacters(i,4)&&HighLevelEncoder.isNativeEDIFACT(e.charAt(i+3))&&this.addEdge(t,new Edge(e,Mode.EDF,i,4,s))}static encodeMinimally(e){const t=e.length(),i=Array(t+1).fill(null).map((()=>Array(6).fill(0)));this.addEdges(e,i,0,null);for(let s=1;s<=t;s++){for(let r=0;r<6;r++)null!==i[s][r]&&s<t&&this.addEdges(e,i,s,i[s][r]);for(let e=0;e<6;e++)i[s-1][e]=null}let s=-1,r=Integer.MAX_VALUE;for(let e=0;e<6;e++)if(null!==i[t][e]){const o=i[t][e],n=e>=1&&e<=3?o.cachedTotalSize+1:o.cachedTotalSize;n<r&&(r=n,s=e)}if(s<0)throw new Error('Failed to encode "'+e+'"');return new Result(i[t][s])}}class Result{constructor(e){const t=e.input;let i=0,s=[];const r=[],o=[];e.mode!==Mode.C40&&e.mode!==Mode.TEXT&&e.mode!==Mode.X12||e.getEndMode()===Mode.ASCII||(i+=this.prepend(Edge.getBytes(254),s));let n=e;for(;null!==n;)i+=this.prepend(n.getDataBytes(),s),null!==n.previous&&n.getPreviousStartMode()===n.getMode()||(n.getMode()===Mode.B256&&(i<=249?(s.unshift(i),i++):(s.unshift(i%250),s.unshift(i/250+249),i+=2),r.push(s.length),o.push(i)),this.prepend(n.getLatchBytes(),s),i=0),n=n.previous;5===t.getMacroId()?i+=this.prepend(Edge.getBytes(236),s):6===t.getMacroId()&&(i+=this.prepend(Edge.getBytes(237),s)),t.getFNC1Character()>0&&(i+=this.prepend(Edge.getBytes(232),s));for(let e=0;e<r.length;e++)this.applyRandomPattern(s,s.length-r[e],o[e]);const h=e.getMinSymbolSize(s.length);for(s.length<h&&s.push(129);s.length<h;)s.push(this.randomize253State(s.length+1));this.bytes=new Uint8Array(s.length);for(let e=0;e<this.bytes.length;e++)this.bytes[e]=s[e]}prepend(e,t){for(let i=e.length-1;i>=0;i--)t.unshift(e[i]);return e.length}randomize253State(e){const t=129+(149*e%253+1);return t<=254?t:t-254}applyRandomPattern(e,t,i){for(let s=0;s<i;s++){const i=t+s,r=(255&e[i])+(149*(i+1)%255+1);e[i]=r<=255?r:r-256}}getBytes(){return this.bytes}}class Edge{constructor(e,t,i,s,r){if(this.input=e,this.mode=t,this.fromPosition=i,this.characterLength=s,this.previous=r,this.allCodewordCapacities=[3,5,8,10,12,16,18,22,30,32,36,44,49,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.squareCodewordCapacities=[3,5,8,12,18,22,30,36,44,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.rectangularCodewordCapacities=[5,10,16,33,32,49],!(i+s<=e.length()))throw new Error("Invalid edge");let o=null!==r?r.cachedTotalSize:0;const n=this.getPreviousMode();switch(t){case Mode.ASCII:o++,(e.isECI(i)||MinimalEncoder.isExtendedASCII(e.charAt(i),e.getFNC1Character()))&&o++,n!==Mode.C40&&n!==Mode.TEXT&&n!==Mode.X12||o++;break;case Mode.B256:o++,(n!==Mode.B256||250===this.getB256Size())&&o++,n===Mode.ASCII?o++:n!==Mode.C40&&n!==Mode.TEXT&&n!==Mode.X12||(o+=2);break;case Mode.C40:case Mode.TEXT:case Mode.X12:if(t===Mode.X12)o+=2;else{let s=[];o+=2*MinimalEncoder.getNumberOfC40Words(e,i,t===Mode.C40,s)}n===Mode.ASCII||n===Mode.B256?o++:n===t||n!==Mode.C40&&n!==Mode.TEXT&&n!==Mode.X12||(o+=2);break;case Mode.EDF:o+=3,n===Mode.ASCII||n===Mode.B256?o++:n!==Mode.C40&&n!==Mode.TEXT&&n!==Mode.X12||(o+=2)}this.cachedTotalSize=o}getB256Size(){let e=0,t=this;for(;null!==t&&t.mode===Mode.B256&&e<=250;)e++,t=t.previous;return e}getPreviousStartMode(){return null===this.previous?Mode.ASCII:this.previous.mode}getPreviousMode(){return null===this.previous?Mode.ASCII:this.previous.getEndMode()}getEndMode(){if(this.mode===Mode.EDF){if(this.characterLength<4)return Mode.ASCII;const e=this.getLastASCII();if(e>0&&this.getCodewordsRemaining(this.cachedTotalSize+e)<=2-e)return Mode.ASCII}if(this.mode===Mode.C40||this.mode===Mode.TEXT||this.mode===Mode.X12){if(this.fromPosition+this.characterLength>=this.input.length()&&0===this.getCodewordsRemaining(this.cachedTotalSize))return Mode.ASCII;if(1===this.getLastASCII()&&0===this.getCodewordsRemaining(this.cachedTotalSize+1))return Mode.ASCII}return this.mode}getMode(){return this.mode}getLastASCII(){const e=this.input.length(),t=this.fromPosition+this.characterLength;return e-t>4||t>=e?0:e-t==1?MinimalEncoder.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())?0:1:e-t==2?MinimalEncoder.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())||MinimalEncoder.isExtendedASCII(this.input.charAt(t+1),this.input.getFNC1Character())?0:HighLevelEncoder.isDigit(this.input.charAt(t))&&HighLevelEncoder.isDigit(this.input.charAt(t+1))?1:2:e-t==3?HighLevelEncoder.isDigit(this.input.charAt(t))&&HighLevelEncoder.isDigit(this.input.charAt(t+1))&&!MinimalEncoder.isExtendedASCII(this.input.charAt(t+2),this.input.getFNC1Character())||HighLevelEncoder.isDigit(this.input.charAt(t+1))&&HighLevelEncoder.isDigit(this.input.charAt(t+2))&&!MinimalEncoder.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())?2:0:HighLevelEncoder.isDigit(this.input.charAt(t))&&HighLevelEncoder.isDigit(this.input.charAt(t+1))&&HighLevelEncoder.isDigit(this.input.charAt(t+2))&&HighLevelEncoder.isDigit(this.input.charAt(t+3))?2:0}getMinSymbolSize(e){switch(this.input.getShapeHint()){case 1:for(const t of this.squareCodewordCapacities)if(t>=e)return t;break;case 2:for(const t of this.rectangularCodewordCapacities)if(t>=e)return t}for(const t of this.allCodewordCapacities)if(t>=e)return t;return this.allCodewordCapacities[this.allCodewordCapacities.length-1]}getCodewordsRemaining(e){return this.getMinSymbolSize(e)-e}static getBytes(e,t){const i=new Uint8Array(t?2:1);return i[0]=e,t&&(i[1]=t),i}setC40Word(e,t,i,s,r){const o=1600*(255&i)+40*(255&s)+(255&r)+1;e[t]=o/256,e[t+1]=o%256}getX12Value(e){return 13===e?0:42===e?1:62===e?2:32===e?3:e>=48&&e<=57?e-44:e>=65&&e<=90?e-51:e}getX12Words(){if(this.characterLength%3!=0)throw new Error("X12 words must be a multiple of 3");const e=new Uint8Array(this.characterLength/3*2);for(let t=0;t<e.length;t+=2)this.setC40Word(e,t,this.getX12Value(this.input.charAt(this.fromPosition+t/2*3)),this.getX12Value(this.input.charAt(this.fromPosition+t/2*3+1)),this.getX12Value(this.input.charAt(this.fromPosition+t/2*3+2)));return e}getShiftValue(e,t,i){return t&&MinimalEncoder.isInC40Shift1Set(e)||!t&&MinimalEncoder.isInTextShift1Set(e)?0:t&&MinimalEncoder.isInC40Shift2Set(e,i)||!t&&MinimalEncoder.isInTextShift2Set(e,i)?1:2}getC40Value(e,t,i,s){if(i===s){if(2!==t)throw new Error("FNC1 cannot be used in C40 shift 2");return 27}return e?i<=31?i:32===i?3:i<=47?i-33:i<=57?i-44:i<=64?i-43:i<=90?i-51:i<=95?i-69:i<=127?i-96:i:0===i?0:0===t&&i<=3?i-1:1===t&&i<=31?i:32===i?3:i>=33&&i<=47?i-33:i>=48&&i<=57?i-44:i>=58&&i<=64?i-43:i>=65&&i<=90?i-64:i>=91&&i<=95?i-69:96===i?0:i>=97&&i<=122?i-83:i>=123&&i<=127?i-96:i}getC40Words(e,t){const i=[];for(let s=0;s<this.characterLength;s++){const r=this.input.charAt(this.fromPosition+s);if(e&&HighLevelEncoder.isNativeC40(r)||!e&&HighLevelEncoder.isNativeText(r))i.push(this.getC40Value(e,0,r,t));else if(MinimalEncoder.isExtendedASCII(r,t)){const s=(255&r)-128;if(e&&HighLevelEncoder.isNativeC40(s)||!e&&HighLevelEncoder.isNativeText(s))i.push(1),i.push(30),i.push(this.getC40Value(e,0,s,t));else{i.push(1),i.push(30);const r=this.getShiftValue(s,e,t);i.push(r),i.push(this.getC40Value(e,r,s,t))}}else{const s=this.getShiftValue(r,e,t);i.push(s),i.push(this.getC40Value(e,s,r,t))}}if(i.length%3!=0){if((i.length-2)%3!=0||this.fromPosition+this.characterLength!==this.input.length())throw new Error("C40 words must be a multiple of 3");i.push(0)}const s=new Uint8Array(i.length/3*2);let r=0;for(let e=0;e<i.length;e+=3)this.setC40Word(s,r,255&i[e],255&i[e+1],255&i[e+2]),r+=2;return s}getEDFBytes(){const e=Math.ceil(this.characterLength/4),t=new Uint8Array(3*e);let i=this.fromPosition;const s=Math.min(this.fromPosition+this.characterLength-1,this.input.length()-1);for(let r=0;r<e;r+=3){const e=[];for(let t=0;t<4;t++)e[t]=i<=s?63&this.input.charAt(i++):i===s+1?31:0;let o=e[0]<<18;o|=e[1]<<12,o|=e[2]<<6,o|=e[3],t[r]=o>>16&255,t[r+1]=o>>8&255,t[r+2]=255&o}return t}getLatchBytes(){switch(this.getPreviousMode()){case Mode.ASCII:case Mode.B256:switch(this.mode){case Mode.B256:return Edge.getBytes(231);case Mode.C40:return Edge.getBytes(230);case Mode.TEXT:return Edge.getBytes(239);case Mode.X12:return Edge.getBytes(238);case Mode.EDF:return Edge.getBytes(240)}break;case Mode.C40:case Mode.TEXT:case Mode.X12:if(this.mode!==this.getPreviousMode())switch(this.mode){case Mode.ASCII:return Edge.getBytes(254);case Mode.B256:return Edge.getBytes(254,231);case Mode.C40:return Edge.getBytes(254,230);case Mode.TEXT:return Edge.getBytes(254,239);case Mode.X12:return Edge.getBytes(254,238);case Mode.EDF:return Edge.getBytes(254,240)}break;case Mode.EDF:if(this.mode!==Mode.EDF)throw new Error("Cannot switch from EDF to "+this.mode)}return new Uint8Array(0)}getDataBytes(){switch(this.mode){case Mode.ASCII:return this.input.isECI(this.fromPosition)?Edge.getBytes(241,this.input.getECIValue(this.fromPosition)+1):MinimalEncoder.isExtendedASCII(this.input.charAt(this.fromPosition),this.input.getFNC1Character())?Edge.getBytes(235,this.input.charAt(this.fromPosition)-127):2===this.characterLength?Edge.getBytes(10*this.input.charAt(this.fromPosition)+this.input.charAt(this.fromPosition+1)+130):this.input.isFNC1(this.fromPosition)?Edge.getBytes(232):Edge.getBytes(this.input.charAt(this.fromPosition)+1);case Mode.B256:return Edge.getBytes(this.input.charAt(this.fromPosition));case Mode.C40:return this.getC40Words(!0,this.input.getFNC1Character());case Mode.TEXT:return this.getC40Words(!1,this.input.getFNC1Character());case Mode.X12:return this.getX12Words();case Mode.EDF:return this.getEDFBytes()}}}class Input extends MinimalECIInput{constructor(e,t,i,s,r){super(e,t,i),this.shape=s,this.macroId=r}getMacroId(){return this.macroId}getShapeHint(){return this.shape}}
//# sourceMappingURL=/sm/23b61d856a20ef36d8e18d53be7b76bc0d426120d2ace2ef02ed9cc4216c6f0e.map