/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/datamatrix/encoder/C40Encoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import StringBuilder from"../../util/StringBuilder";import HighLevelEncoder from"./HighLevelEncoder";import{C40_ENCODATION,LATCH_TO_C40,ASCII_ENCODATION,C40_UNLATCH}from"./constants";export class C40Encoder{getEncodingMode(){return C40_ENCODATION}encodeMaximal(e){const t=new StringBuilder;let r=0,o=e.pos,n=0;for(;e.hasMoreCharacters();){const a=e.getCurrentChar();e.pos++,r=this.encodeChar(a,t),t.length()%3==0&&(o=e.pos,n=t.length())}if(n!==t.length()){const n=Math.floor(t.length()/3*2),a=Math.floor(e.getCodewordCount()+n+1);e.updateSymbolInfo(a);const d=e.getSymbolInfo().getDataCapacity()-a,h=Math.floor(t.length()%3);(2===h&&2!==d||1===h&&(r>3||1!==d))&&(e.pos=o)}t.length()>0&&e.writeCodeword(LATCH_TO_C40),this.handleEOD(e,t)}encode(e){const t=new StringBuilder;for(;e.hasMoreCharacters();){const r=e.getCurrentChar();e.pos++;let o=this.encodeChar(r,t);const n=2*Math.floor(t.length()/3),a=e.getCodewordCount()+n;e.updateSymbolInfo(a);const d=e.getSymbolInfo().getDataCapacity()-a;if(!e.hasMoreCharacters()){const r=new StringBuilder;for(t.length()%3==2&&2!==d&&(o=this.backtrackOneCharacter(e,t,r,o));t.length()%3==1&&(o>3||1!==d);)o=this.backtrackOneCharacter(e,t,r,o);break}if(t.length()%3==0){if(HighLevelEncoder.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(ASCII_ENCODATION);break}}}this.handleEOD(e,t)}backtrackOneCharacter(e,t,r,o){const n=t.length(),a=t.toString().substring(0,n-o);t.setLengthToZero(),t.append(a),e.pos--;const d=e.getCurrentChar();return o=this.encodeChar(d,r),e.resetSymbolInfo(),o}writeNextTriplet(e,t){e.writeCodewords(this.encodeToCodewords(t.toString()));const r=t.toString().substring(3);t.setLengthToZero(),t.append(r)}handleEOD(e,t){const r=Math.floor(t.length()/3*2),o=t.length()%3,n=e.getCodewordCount()+r;e.updateSymbolInfo(n);const a=e.getSymbolInfo().getDataCapacity()-n;if(2===o){for(t.append("\0");t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(C40_UNLATCH)}else if(1===a&&1===o){for(;t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(C40_UNLATCH),e.pos--}else{if(0!==o)throw new Error("Unexpected case. Please report!");for(;t.length()>=3;)this.writeNextTriplet(e,t);(a>0||e.hasMoreCharacters())&&e.writeCodeword(C40_UNLATCH)}e.signalEncoderChange(ASCII_ENCODATION)}encodeChar(e,t){if(e===" ".charCodeAt(0))return t.append(3),1;if(e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return t.append(e-48+4),1;if(e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0))return t.append(e-65+14),1;if(e<" ".charCodeAt(0))return t.append(0),t.append(e),2;if(e<="/".charCodeAt(0))return t.append(1),t.append(e-33),2;if(e<="@".charCodeAt(0))return t.append(1),t.append(e-58+15),2;if(e<="_".charCodeAt(0))return t.append(1),t.append(e-91+22),2;if(e<=127)return t.append(2),t.append(e-96),2;t.append("1");let r=2;return r+=this.encodeChar(e-128,t),r}encodeToCodewords(e){const t=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,r=t/256,o=t%256,n=new StringBuilder;return n.append(r),n.append(o),n.toString()}}
//# sourceMappingURL=/sm/98538e8a975cc826b9ab865e5da76494afb93dc3d028897815870f9f321b6186.map