/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/oned/rss/expanded/decoders/GeneralAppIdDecoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import FormatException from"../../../../FormatException";import IllegalStateException from"../../../../IllegalStateException";import StringBuilder from"../../../../util/StringBuilder";import BlockParsedResult from"./BlockParsedResult";import DecodedChar from"./DecodedChar";import DecodedInformation from"./DecodedInformation";import DecodedNumeric from"./DecodedNumeric";import FieldParser from"./FieldParser";export default class GeneralAppIdDecoder{constructor(e){this.buffer=new StringBuilder,this.information=e}decodeAllCodes(e,t){let i=t,r=null;for(;;){let t=this.decodeGeneralPurposeField(i,r),o=FieldParser.parseFieldsInGeneralPurpose(t.getNewString());if(null!=o&&e.append(o),r=t.isRemaining()?""+t.getRemainingValue():null,i===t.getNewPosition())break;i=t.getNewPosition()}return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let t=this.extractNumericValueFromBitArray(e,4);return new DecodedNumeric(this.information.getSize(),0===t?DecodedNumeric.FNC1:t-1,DecodedNumeric.FNC1)}let t=this.extractNumericValueFromBitArray(e,7);return new DecodedNumeric(e+7,(t-8)/11,(t-8)%11)}extractNumericValueFromBitArray(e,t){return GeneralAppIdDecoder.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,i){let r=0;for(let o=0;o<i;++o)e.get(t+o)&&(r|=1<<i-o-1);return r}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),null!=t&&this.buffer.append(t),this.current.setPosition(e);let i=this.parseBlocks();return null!=i&&i.isRemaining()?new DecodedInformation(this.current.getPosition(),this.buffer.toString(),i.getRemainingValue()):new DecodedInformation(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let i=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),!(i!==this.current.getPosition())&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return t=e.isSecondDigitFNC1()?new DecodedInformation(this.current.getPosition(),this.buffer.toString()):new DecodedInformation(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new BlockParsedResult(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let e=new DecodedInformation(this.current.getPosition(),this.buffer.toString());return new BlockParsedResult(!0,e)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new BlockParsedResult(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new DecodedInformation(this.current.getPosition(),this.buffer.toString());return new BlockParsedResult(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new BlockParsedResult(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let e=new DecodedInformation(this.current.getPosition(),this.buffer.toString());return new BlockParsedResult(!0,e)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new BlockParsedResult(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let i=this.extractNumericValueFromBitArray(e,7);if(i>=64&&i<116)return!0;if(e+8>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,8);return r>=232&&r<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new DecodedChar(e+5,DecodedChar.FNC1);if(t>=5&&t<15)return new DecodedChar(e+5,"0"+(t-5));let i,r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<90)return new DecodedChar(e+7,""+(r+1));if(r>=90&&r<116)return new DecodedChar(e+7,""+(r+7));switch(this.extractNumericValueFromBitArray(e,8)){case 232:i="!";break;case 233:i='"';break;case 234:i="%";break;case 235:i="&";break;case 236:i="'";break;case 237:i="(";break;case 238:i=")";break;case 239:i="*";break;case 240:i="+";break;case 241:i=",";break;case 242:i="-";break;case 243:i=".";break;case 244:i="/";break;case 245:i=":";break;case 246:i=";";break;case 247:i="<";break;case 248:i="=";break;case 249:i=">";break;case 250:i="?";break;case 251:i="_";break;case 252:i=" ";break;default:throw new FormatException}return new DecodedChar(e+8,i)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let i=this.extractNumericValueFromBitArray(e,6);return i>=16&&i<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(15===t)return new DecodedChar(e+5,DecodedChar.FNC1);if(t>=5&&t<15)return new DecodedChar(e+5,"0"+(t-5));let i,r=this.extractNumericValueFromBitArray(e,6);if(r>=32&&r<58)return new DecodedChar(e+6,""+(r+33));switch(r){case 58:i="*";break;case 59:i=",";break;case 60:i="-";break;case 61:i=".";break;case 62:i="/";break;default:throw new IllegalStateException("Decoding invalid alphanumeric value: "+r)}return new DecodedChar(e+6,i)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(2===t){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}
//# sourceMappingURL=/sm/55a81bb14eb282a6baf86dc101b13f04127f880aba6087f010eb06dc298ed9ae.map