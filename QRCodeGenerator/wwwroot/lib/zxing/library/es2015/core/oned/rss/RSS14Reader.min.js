/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/oned/rss/RSS14Reader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import AbstractRSSReader from"./AbstractRSSReader";import Pair from"./Pair";import Result from"../../Result";import DecodeHintType from"../../DecodeHintType";import NotFoundException from"../../NotFoundException";import StringBuilder from"../../util/StringBuilder";import BarcodeFormat from"../../BarcodeFormat";import ResultPoint from"../../ResultPoint";import FinderPattern from"./FinderPattern";import DataCharacter from"./DataCharacter";import MathUtils from"../../common/detector/MathUtils";import RSSUtils from"./RSSUtils";import System from"../../util/System";import OneDReader from"../OneDReader";export default class RSS14Reader extends AbstractRSSReader{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,r){const n=this.decodePair(t,!1,e,r);RSS14Reader.addOrTally(this.possibleLeftPairs,n),t.reverse();let o=this.decodePair(t,!0,e,r);RSS14Reader.addOrTally(this.possibleRightPairs,o),t.reverse();for(let e of this.possibleLeftPairs)if(e.getCount()>1)for(let t of this.possibleRightPairs)if(t.getCount()>1&&RSS14Reader.checkChecksum(e,t))return RSS14Reader.constructResult(e,t);throw new NotFoundException}static addOrTally(e,t){if(null==t)return;let r=!1;for(let n of e)if(n.getValue()===t.getValue()){n.incrementCount(),r=!0;break}r||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let r=4537077*e.getValue()+t.getValue(),n=new String(r).toString(),o=new StringBuilder;for(let e=13-n.length;e>0;e--)o.append("0");o.append(n);let i=0;for(let e=0;e<13;e++){let t=o.charAt(e).charCodeAt(0)-"0".charCodeAt(0);i+=0==(1&e)?3*t:t}i=10-i%10,10===i&&(i=0),o.append(i.toString());let a=e.getFinderPattern().getResultPoints(),s=t.getFinderPattern().getResultPoints();return new Result(o.toString(),null,0,[a[0],a[1],s[0],s[1]],BarcodeFormat.RSS_14,(new Date).getTime())}static checkChecksum(e,t){let r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,n=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n}decodePair(e,t,r,n){try{let o=this.findFinderPattern(e,t),i=this.parseFoundFinderPattern(e,r,t,o),a=null==n?null:n.get(DecodeHintType.NEED_RESULT_POINT_CALLBACK);if(null!=a){let n=(o[0]+o[1])/2;t&&(n=e.getSize()-1-n),a.foundPossibleResultPoint(new ResultPoint(n,r))}let s=this.decodeDataCharacter(e,i,!0),d=this.decodeDataCharacter(e,i,!1);return new Pair(1597*s.getValue()+d.getValue(),s.getChecksumPortion()+4*d.getChecksumPortion(),i)}catch(e){return null}}decodeDataCharacter(e,t,r){let n=this.getDataCharacterCounters();for(let e=0;e<n.length;e++)n[e]=0;if(r)OneDReader.recordPatternInReverse(e,t.getStartEnd()[0],n);else{OneDReader.recordPattern(e,t.getStartEnd()[1]+1,n);for(let e=0,t=n.length-1;e<t;e++,t--){let r=n[e];n[e]=n[t],n[t]=r}}let o=r?16:15,i=MathUtils.sum(new Int32Array(n))/o,a=this.getOddCounts(),s=this.getEvenCounts(),d=this.getOddRoundingErrors(),l=this.getEvenRoundingErrors();for(let e=0;e<n.length;e++){let t=n[e]/i,r=Math.floor(t+.5);r<1?r=1:r>8&&(r=8);let o=Math.floor(e/2);0==(1&e)?(a[o]=r,d[o]=t-r):(s[o]=r,l[o]=t-r)}this.adjustOddEvenCounts(r,o);let S=0,u=0;for(let e=a.length-1;e>=0;e--)u*=9,u+=a[e],S+=a[e];let R=0,h=0;for(let e=s.length-1;e>=0;e--)R*=9,R+=s[e],h+=s[e];let c=u+3*R;if(r){if(0!=(1&S)||S>12||S<4)throw new NotFoundException;let e=(12-S)/2,t=RSS14Reader.OUTSIDE_ODD_WIDEST[e],r=9-t,n=RSSUtils.getRSSvalue(a,t,!1),o=RSSUtils.getRSSvalue(s,r,!0),i=RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET[e],d=RSS14Reader.OUTSIDE_GSUM[e];return new DataCharacter(n*i+o+d,c)}{if(0!=(1&h)||h>10||h<4)throw new NotFoundException;let e=(10-h)/2,t=RSS14Reader.INSIDE_ODD_WIDEST[e],r=9-t,n=RSSUtils.getRSSvalue(a,t,!0),o=RSSUtils.getRSSvalue(s,r,!1),i=RSS14Reader.INSIDE_ODD_TOTAL_SUBSET[e],d=RSS14Reader.INSIDE_GSUM[e];return new DataCharacter(o*i+n+d,c)}}findFinderPattern(e,t){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let n=e.getSize(),o=!1,i=0;for(;i<n&&(o=!e.get(i),t!==o);)i++;let a=0,s=i;for(let t=i;t<n;t++)if(e.get(t)!==o)r[a]++;else{if(3===a){if(AbstractRSSReader.isFinderPattern(r))return[s,t];s+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,a--}else a++;r[a]=1,o=!o}throw new NotFoundException}parseFoundFinderPattern(e,t,r,n){let o=e.get(n[0]),i=n[0]-1;for(;i>=0&&o!==e.get(i);)i--;i++;const a=n[0]-i,s=this.getDecodeFinderCounters(),d=new Int32Array(s.length);System.arraycopy(s,0,d,1,s.length-1),d[0]=a;const l=this.parseFinderValue(d,RSS14Reader.FINDER_PATTERNS);let S=i,u=n[1];return r&&(S=e.getSize()-1-S,u=e.getSize()-1-u),new FinderPattern(l,[i,n[1]],S,u,t)}adjustOddEvenCounts(e,t){let r=MathUtils.sum(new Int32Array(this.getOddCounts())),n=MathUtils.sum(new Int32Array(this.getEvenCounts())),o=!1,i=!1,a=!1,s=!1;e?(r>12?i=!0:r<4&&(o=!0),n>12?s=!0:n<4&&(a=!0)):(r>11?i=!0:r<5&&(o=!0),n>10?s=!0:n<4&&(a=!0));let d=r+n-t,l=(1&r)==(e?1:0),S=1==(1&n);if(1===d)if(l){if(S)throw new NotFoundException;i=!0}else{if(!S)throw new NotFoundException;s=!0}else if(-1===d)if(l){if(S)throw new NotFoundException;o=!0}else{if(!S)throw new NotFoundException;a=!0}else{if(0!==d)throw new NotFoundException;if(l){if(!S)throw new NotFoundException;r<n?(o=!0,s=!0):(i=!0,a=!0)}else if(S)throw new NotFoundException}if(o){if(i)throw new NotFoundException;AbstractRSSReader.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&AbstractRSSReader.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(s)throw new NotFoundException;AbstractRSSReader.increment(this.getEvenCounts(),this.getOddRoundingErrors())}s&&AbstractRSSReader.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}RSS14Reader.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],RSS14Reader.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],RSS14Reader.OUTSIDE_GSUM=[0,161,961,2015,2715],RSS14Reader.INSIDE_GSUM=[0,336,1036,1516],RSS14Reader.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],RSS14Reader.INSIDE_ODD_WIDEST=[2,4,6,8],RSS14Reader.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];
//# sourceMappingURL=/sm/2e24043d9d175d26a54d698b1ad858ddeb533cba183751846877594da3f7c5be.map