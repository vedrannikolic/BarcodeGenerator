/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/es2015/core/pdf417/decoder/DecodedBitStreamParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import FormatException from"../../FormatException";import CharacterSetECI from"../../common/CharacterSetECI";import DecoderResult from"../../common/DecoderResult";import PDF417ResultMetadata from"../PDF417ResultMetadata";import Arrays from"../../util/Arrays";import StringBuilder from"../../util/StringBuilder";import Integer from"../../util/Integer";import Long from"../../util/Long";import ByteArrayOutputStream from"../../util/ByteArrayOutputStream";import StringEncoding from"../../util/StringEncoding";var Mode;function getBigIntConstructor(){if("undefined"!=typeof window)return window.BigInt||null;if("undefined"!=typeof global)return global.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let BigInteger;function createBigInt(e){if(void 0===BigInteger&&(BigInteger=getBigIntConstructor()),null===BigInteger)throw new Error("BigInt is not supported!");return BigInteger(e)}function getEXP900(){let e=[];e[0]=createBigInt(1);let r=createBigInt(900);e[1]=r;for(let t=2;t<16;t++)e[t]=e[t-1]*r;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(Mode||(Mode={}));export default class DecodedBitStreamParser{static decode(e,r){let t=new StringBuilder(""),a=CharacterSetECI.ISO8859_1;t.enableDecoding(a);let d=1,o=e[d++],_=new PDF417ResultMetadata;for(;d<e[0];){switch(o){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=DecodedBitStreamParser.textCompaction(e,d,t);break;case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:d=DecodedBitStreamParser.byteCompaction(o,e,a,d,t);break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:t.append(e[d++]);break;case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:d=DecodedBitStreamParser.numericCompaction(e,d,t);break;case DecodedBitStreamParser.ECI_CHARSET:CharacterSetECI.getCharacterSetECIByValue(e[d++]);break;case DecodedBitStreamParser.ECI_GENERAL_PURPOSE:d+=2;break;case DecodedBitStreamParser.ECI_USER_DEFINED:d++;break;case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:d=DecodedBitStreamParser.decodeMacroBlock(e,d,_);break;case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:throw new FormatException;default:d--,d=DecodedBitStreamParser.textCompaction(e,d,t)}if(!(d<e.length))throw FormatException.getFormatInstance();o=e[d++]}if(0===t.length())throw FormatException.getFormatInstance();let c=new DecoderResult(null,t.toString(),null,r);return c.setOther(_),c}static decodeMacroBlock(e,r,t){if(r+DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw FormatException.getFormatInstance();let a=new Int32Array(DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS);for(let t=0;t<DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS;t++,r++)a[t]=e[r];t.setSegmentIndex(Integer.parseInt(DecodedBitStreamParser.decodeBase900toBase10(a,DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS)));let d=new StringBuilder;r=DecodedBitStreamParser.textCompaction(e,r,d),t.setFileId(d.toString());let o=-1;for(e[r]===DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(o=r+1);r<e[0];)switch(e[r]){case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e[++r]){case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let a=new StringBuilder;r=DecodedBitStreamParser.textCompaction(e,r+1,a),t.setFileName(a.toString());break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let d=new StringBuilder;r=DecodedBitStreamParser.textCompaction(e,r+1,d),t.setSender(d.toString());break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let o=new StringBuilder;r=DecodedBitStreamParser.textCompaction(e,r+1,o),t.setAddressee(o.toString());break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let _=new StringBuilder;r=DecodedBitStreamParser.numericCompaction(e,r+1,_),t.setSegmentCount(Integer.parseInt(_.toString()));break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let c=new StringBuilder;r=DecodedBitStreamParser.numericCompaction(e,r+1,c),t.setTimestamp(Long.parseLong(c.toString()));break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let i=new StringBuilder;r=DecodedBitStreamParser.numericCompaction(e,r+1,i),t.setChecksum(Integer.parseInt(i.toString()));break;case DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let s=new StringBuilder;r=DecodedBitStreamParser.numericCompaction(e,r+1,s),t.setFileSize(Long.parseLong(s.toString()));break;default:throw FormatException.getFormatInstance()}break;case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:r++,t.setLastSegment(!0);break;default:throw FormatException.getFormatInstance()}if(-1!==o){let a=r-o;t.isLastSegment()&&a--,t.setOptionalData(Arrays.copyOfRange(e,o,o+a))}return r}static textCompaction(e,r,t){let a=new Int32Array(2*(e[0]-r)),d=new Int32Array(2*(e[0]-r)),o=0,_=!1;for(;r<e[0]&&!_;){let t=e[r++];if(t<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH)a[o]=t/30,a[o+1]=t%30,o+=2;else switch(t){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:a[o++]=DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH;break;case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:r--,_=!0;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a[o]=DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,t=e[r++],d[o]=t,o++}}return DecodedBitStreamParser.decodeTextCompaction(a,d,o,t),r}static decodeTextCompaction(e,r,t,a){let d=Mode.ALPHA,o=Mode.ALPHA,_=0;for(;_<t;){let t=e[_],c="";switch(d){case Mode.ALPHA:if(t<26)c=String.fromCharCode(65+t);else switch(t){case 26:c=" ";break;case DecodedBitStreamParser.LL:d=Mode.LOWER;break;case DecodedBitStreamParser.ML:d=Mode.MIXED;break;case DecodedBitStreamParser.PS:o=d,d=Mode.PUNCT_SHIFT;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(r[_]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=Mode.ALPHA}break;case Mode.LOWER:if(t<26)c=String.fromCharCode(97+t);else switch(t){case 26:c=" ";break;case DecodedBitStreamParser.AS:o=d,d=Mode.ALPHA_SHIFT;break;case DecodedBitStreamParser.ML:d=Mode.MIXED;break;case DecodedBitStreamParser.PS:o=d,d=Mode.PUNCT_SHIFT;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(r[_]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=Mode.ALPHA}break;case Mode.MIXED:if(t<DecodedBitStreamParser.PL)c=DecodedBitStreamParser.MIXED_CHARS[t];else switch(t){case DecodedBitStreamParser.PL:d=Mode.PUNCT;break;case 26:c=" ";break;case DecodedBitStreamParser.LL:d=Mode.LOWER;break;case DecodedBitStreamParser.AL:d=Mode.ALPHA;break;case DecodedBitStreamParser.PS:o=d,d=Mode.PUNCT_SHIFT;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(r[_]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=Mode.ALPHA}break;case Mode.PUNCT:if(t<DecodedBitStreamParser.PAL)c=DecodedBitStreamParser.PUNCT_CHARS[t];else switch(t){case DecodedBitStreamParser.PAL:d=Mode.ALPHA;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(r[_]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=Mode.ALPHA}break;case Mode.ALPHA_SHIFT:if(d=o,t<26)c=String.fromCharCode(65+t);else switch(t){case 26:c=" ";break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=Mode.ALPHA}break;case Mode.PUNCT_SHIFT:if(d=o,t<DecodedBitStreamParser.PAL)c=DecodedBitStreamParser.PUNCT_CHARS[t];else switch(t){case DecodedBitStreamParser.PAL:d=Mode.ALPHA;break;case DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(r[_]);break;case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:d=Mode.ALPHA}}""!==c&&a.append(c),_++}}static byteCompaction(e,r,t,a,d){let o=new ByteArrayOutputStream,_=0,c=0,i=!1;switch(e){case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:let e=new Int32Array(6),t=r[a++];for(;a<r[0]&&!i;)switch(e[_++]=t,c=900*c+t,t=r[a++],t){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:a--,i=!0;break;default:if(_%5==0&&_>0){for(let e=0;e<6;++e)o.write(Number(createBigInt(c)>>createBigInt(8*(5-e))));c=0,_=0}}a===r[0]&&t<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH&&(e[_++]=t);for(let r=0;r<_;r++)o.write(e[r]);break;case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:for(;a<r[0]&&!i;){let e=r[a++];if(e<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH)_++,c=900*c+e;else switch(e){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:a--,i=!0}if(_%5==0&&_>0){for(let e=0;e<6;++e)o.write(Number(createBigInt(c)>>createBigInt(8*(5-e))));c=0,_=0}}}return d.append(StringEncoding.decode(o.toByteArray(),t)),a}static numericCompaction(e,r,t){let a=0,d=!1,o=new Int32Array(DecodedBitStreamParser.MAX_NUMERIC_CODEWORDS);for(;r<e[0]&&!d;){let _=e[r++];if(r===e[0]&&(d=!0),_<DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH)o[a]=_,a++;else switch(_){case DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH:case DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case DecodedBitStreamParser.MACRO_PDF417_TERMINATOR:r--,d=!0}(a%DecodedBitStreamParser.MAX_NUMERIC_CODEWORDS==0||_===DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH||d)&&a>0&&(t.append(DecodedBitStreamParser.decodeBase900toBase10(o,a)),a=0)}return r}static decodeBase900toBase10(e,r){let t=createBigInt(0);for(let a=0;a<r;a++)t+=DecodedBitStreamParser.EXP900[r-a-1]*createBigInt(e[a]);let a=t.toString();if("1"!==a.charAt(0))throw new FormatException;return a.substring(1)}}DecodedBitStreamParser.TEXT_COMPACTION_MODE_LATCH=900,DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH=901,DecodedBitStreamParser.NUMERIC_COMPACTION_MODE_LATCH=902,DecodedBitStreamParser.BYTE_COMPACTION_MODE_LATCH_6=924,DecodedBitStreamParser.ECI_USER_DEFINED=925,DecodedBitStreamParser.ECI_GENERAL_PURPOSE=926,DecodedBitStreamParser.ECI_CHARSET=927,DecodedBitStreamParser.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,DecodedBitStreamParser.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,DecodedBitStreamParser.MACRO_PDF417_TERMINATOR=922,DecodedBitStreamParser.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,DecodedBitStreamParser.MAX_NUMERIC_CODEWORDS=15,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,DecodedBitStreamParser.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,DecodedBitStreamParser.PL=25,DecodedBitStreamParser.LL=27,DecodedBitStreamParser.AS=27,DecodedBitStreamParser.ML=28,DecodedBitStreamParser.AL=28,DecodedBitStreamParser.PS=29,DecodedBitStreamParser.PAL=29,DecodedBitStreamParser.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",DecodedBitStreamParser.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",DecodedBitStreamParser.EXP900=getBigIntConstructor()?getEXP900():[],DecodedBitStreamParser.NUMBER_OF_SEQUENCE_CODEWORDS=2;
//# sourceMappingURL=/sm/f6845e7d5ab32081af075451df6fe1135f64ca411ffda7642c70a0613eaddf32.map