/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/aztec/decoder/Decoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Table,DecoderResult_1=require("../../common/DecoderResult"),GenericGF_1=require("../../common/reedsolomon/GenericGF"),ReedSolomonDecoder_1=require("../../common/reedsolomon/ReedSolomonDecoder"),IllegalStateException_1=require("../../IllegalStateException"),FormatException_1=require("../../FormatException"),StringUtils_1=require("../../common/StringUtils"),Integer_1=require("../../util/Integer");!function(e){e[e.UPPER=0]="UPPER",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.DIGIT=3]="DIGIT",e[e.PUNCT=4]="PUNCT",e[e.BINARY=5]="BINARY"}(Table||(Table={}));var Decoder=function(){function e(){}return e.prototype.decode=function(t){this.ddata=t;var r=t.getBits(),a=this.extractBits(r),n=this.correctBits(a),o=e.convertBoolArrayToByteArray(n),i=e.getEncodedData(n),l=new DecoderResult_1.default(o,i,null,null);return l.setNumBits(n.length),l},e.highLevelDecode=function(e){return this.getEncodedData(e)},e.getEncodedData=function(t){for(var r=t.length,a=Table.UPPER,n=Table.UPPER,o="",i=0;i<r;)if(n===Table.BINARY){if(r-i<5)break;var l=e.readCode(t,i,5);if(i+=5,0===l){if(r-i<11)break;l=e.readCode(t,i,11)+31,i+=11}for(var c=0;c<l;c++){if(r-i<8){i=r;break}var d=e.readCode(t,i,8);o+=StringUtils_1.default.castAsNonUtf8Char(d),i+=8}n=a}else{var u=n===Table.DIGIT?4:5;if(r-i<u)break;d=e.readCode(t,i,u);i+=u;var T=e.getCharacter(n,d);T.startsWith("CTRL_")?(a=n,n=e.getTable(T.charAt(5)),"L"===T.charAt(6)&&(a=n)):(o+=T,n=a)}return o},e.getTable=function(e){switch(e){case"L":return Table.LOWER;case"P":return Table.PUNCT;case"M":return Table.MIXED;case"D":return Table.DIGIT;case"B":return Table.BINARY;default:return Table.UPPER}},e.getCharacter=function(t,r){switch(t){case Table.UPPER:return e.UPPER_TABLE[r];case Table.LOWER:return e.LOWER_TABLE[r];case Table.MIXED:return e.MIXED_TABLE[r];case Table.PUNCT:return e.PUNCT_TABLE[r];case Table.DIGIT:return e.DIGIT_TABLE[r];default:throw new IllegalStateException_1.default("Bad table")}},e.prototype.correctBits=function(t){var r,a;this.ddata.getNbLayers()<=2?(a=6,r=GenericGF_1.default.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(a=8,r=GenericGF_1.default.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(a=10,r=GenericGF_1.default.AZTEC_DATA_10):(a=12,r=GenericGF_1.default.AZTEC_DATA_12);var n=this.ddata.getNbDatablocks(),o=t.length/a;if(o<n)throw new FormatException_1.default;for(var i=t.length%a,l=new Int32Array(o),c=0;c<o;c++,i+=a)l[c]=e.readCode(t,i,a);try{new ReedSolomonDecoder_1.default(r).decode(l,o-n)}catch(e){throw new FormatException_1.default(e)}var d=(1<<a)-1,u=0;for(c=0;c<n;c++){if(0===(_=l[c])||_===d)throw new FormatException_1.default;1!==_&&_!==d-1||u++}var T=new Array(n*a-u),s=0;for(c=0;c<n;c++){var _;if(1===(_=l[c])||_===d-1)T.fill(_>1,s,s+a-1),s+=a-1;else for(var f=a-1;f>=0;--f)T[s++]=0!=(_&1<<f)}return T},e.prototype.extractBits=function(e){var t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),a=(t?11:14)+4*r,n=new Int32Array(a),o=new Array(this.totalBitsInLayer(r,t));if(t)for(var i=0;i<n.length;i++)n[i]=i;else{var l=a+1+2*Integer_1.default.truncDivision(Integer_1.default.truncDivision(a,2)-1,15),c=a/2,d=Integer_1.default.truncDivision(l,2);for(i=0;i<c;i++){var u=i+Integer_1.default.truncDivision(i,15);n[c-i-1]=d-u-1,n[c+i]=d+u+1}}i=0;for(var T=0;i<r;i++){for(var s=4*(r-i)+(t?9:12),_=2*i,f=a-1-_,L=0;L<s;L++)for(var E=2*L,R=0;R<2;R++)o[T+E+R]=e.get(n[_+R],n[_+L]),o[T+2*s+E+R]=e.get(n[_+L],n[f-R]),o[T+4*s+E+R]=e.get(n[f-R],n[f-L]),o[T+6*s+E+R]=e.get(n[f-L],n[_+R]);T+=8*s}return o},e.readCode=function(e,t,r){for(var a=0,n=t;n<t+r;n++)a<<=1,e[n]&&(a|=1);return a},e.readByte=function(t,r){var a=t.length-r;return a>=8?e.readCode(t,r,8):e.readCode(t,r,a)<<8-a},e.convertBoolArrayToByteArray=function(t){for(var r=new Uint8Array((t.length+7)/8),a=0;a<r.length;a++)r[a]=e.readByte(t,8*a);return r},e.prototype.totalBitsInLayer=function(e,t){return((t?88:112)+16*e)*e},e.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],e.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],e.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],e.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],e.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],e}();exports.default=Decoder;
//# sourceMappingURL=/sm/036bb89025d4bd670e386b34ecd128acc30296d0da9470597061e3eb5aa18d2a.map