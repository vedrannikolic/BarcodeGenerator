/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/common/HybridBinarizer.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __extends=this&&this.__extends||function(){var r=function(t,a){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,t){r.__proto__=t}||function(r,t){for(var a in t)t.hasOwnProperty(a)&&(r[a]=t[a])},r(t,a)};return function(t,a){function e(){this.constructor=t}r(t,a),t.prototype=null===a?Object.create(a):(e.prototype=a.prototype,new e)}}();Object.defineProperty(exports,"__esModule",{value:!0});var GlobalHistogramBinarizer_1=require("./GlobalHistogramBinarizer"),BitMatrix_1=require("./BitMatrix"),HybridBinarizer=function(r){function t(t){var a=r.call(this,t)||this;return a.matrix=null,a}return __extends(t,r),t.prototype.getBlackMatrix=function(){if(null!==this.matrix)return this.matrix;var a=this.getLuminanceSource(),e=a.getWidth(),i=a.getHeight();if(e>=t.MINIMUM_DIMENSION&&i>=t.MINIMUM_DIMENSION){var o=a.getMatrix(),_=e>>t.BLOCK_SIZE_POWER;0!=(e&t.BLOCK_SIZE_MASK)&&_++;var n=i>>t.BLOCK_SIZE_POWER;0!=(i&t.BLOCK_SIZE_MASK)&&n++;var c=t.calculateBlackPoints(o,_,n,e,i),I=new BitMatrix_1.default(e,i);t.calculateThresholdForBlock(o,_,n,e,i,c,I),this.matrix=I}else this.matrix=r.prototype.getBlackMatrix.call(this);return this.matrix},t.prototype.createBinarizer=function(r){return new t(r)},t.calculateThresholdForBlock=function(r,a,e,i,o,_,n){for(var c=o-t.BLOCK_SIZE,I=i-t.BLOCK_SIZE,l=0;l<e;l++){var B=l<<t.BLOCK_SIZE_POWER;B>c&&(B=c);for(var O=t.cap(l,2,e-3),u=0;u<a;u++){var E=u<<t.BLOCK_SIZE_POWER;E>I&&(E=I);for(var f=t.cap(u,2,a-3),s=0,S=-2;S<=2;S++){var v=_[O+S];s+=v[f-2]+v[f-1]+v[f]+v[f+1]+v[f+2]}var C=s/25;t.thresholdBlock(r,E,B,C,i,n)}}},t.cap=function(r,t,a){return r<t?t:r>a?a:r},t.thresholdBlock=function(r,a,e,i,o,_){for(var n=0,c=e*o+a;n<t.BLOCK_SIZE;n++,c+=o)for(var I=0;I<t.BLOCK_SIZE;I++)(255&r[c+I])<=i&&_.set(a+I,e+n)},t.calculateBlackPoints=function(r,a,e,i,o){for(var _=o-t.BLOCK_SIZE,n=i-t.BLOCK_SIZE,c=new Array(e),I=0;I<e;I++){c[I]=new Int32Array(a);var l=I<<t.BLOCK_SIZE_POWER;l>_&&(l=_);for(var B=0;B<a;B++){var O=B<<t.BLOCK_SIZE_POWER;O>n&&(O=n);for(var u=0,E=255,f=0,s=0,S=l*i+O;s<t.BLOCK_SIZE;s++,S+=i){for(var v=0;v<t.BLOCK_SIZE;v++){var C=255&r[S+v];u+=C,C<E&&(E=C),C>f&&(f=C)}if(f-E>t.MIN_DYNAMIC_RANGE)for(s++,S+=i;s<t.BLOCK_SIZE;s++,S+=i)for(v=0;v<t.BLOCK_SIZE;v++)u+=255&r[S+v]}var K=u>>2*t.BLOCK_SIZE_POWER;if(f-E<=t.MIN_DYNAMIC_RANGE&&(K=E/2,I>0&&B>0)){var M=(c[I-1][B]+2*c[I][B-1]+c[I-1][B-1])/4;E<M&&(K=M)}c[I][B]=K}}return c},t.BLOCK_SIZE_POWER=3,t.BLOCK_SIZE=1<<t.BLOCK_SIZE_POWER,t.BLOCK_SIZE_MASK=t.BLOCK_SIZE-1,t.MINIMUM_DIMENSION=5*t.BLOCK_SIZE,t.MIN_DYNAMIC_RANGE=24,t}(GlobalHistogramBinarizer_1.default);exports.default=HybridBinarizer;
//# sourceMappingURL=/sm/4746bf600859f3ef37f39b2dc00ab41e6e8aa792103b88b4a706ee85b8e5dca7.map