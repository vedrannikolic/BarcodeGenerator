/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/pdf417/decoder/PDF417ScanningDecoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var ChecksumException_1=require("../../ChecksumException"),FormatException_1=require("../../FormatException"),NotFoundException_1=require("../../NotFoundException"),MathUtils_1=require("../../common/detector/MathUtils"),PDF417Common_1=require("../PDF417Common"),ErrorCorrection_1=require("./ec/ErrorCorrection"),BoundingBox_1=require("./BoundingBox"),DetectionResultRowIndicatorColumn_1=require("./DetectionResultRowIndicatorColumn"),DetectionResult_1=require("./DetectionResult"),DetectionResultColumn_1=require("./DetectionResultColumn"),Codeword_1=require("./Codeword"),BarcodeValue_1=require("./BarcodeValue"),PDF417CodewordDecoder_1=require("./PDF417CodewordDecoder"),DecodedBitStreamParser_1=require("./DecodedBitStreamParser"),Formatter_1=require("../../util/Formatter"),PDF417ScanningDecoder=function(){function e(){}return e.decode=function(t,r,o,n,u,a,l){for(var d,i=new BoundingBox_1.default(t,r,o,n,u),c=null,g=null,f=!0;;f=!1){if(null!=r&&(c=e.getRowIndicatorColumn(t,i,r,!0,a,l)),null!=n&&(g=e.getRowIndicatorColumn(t,i,n,!1,a,l)),null==(d=e.merge(c,g)))throw NotFoundException_1.default.getNotFoundInstance();var C=d.getBoundingBox();if(!f||null==C||!(C.getMinY()<i.getMinY()||C.getMaxY()>i.getMaxY()))break;i=C}d.setBoundingBox(i);var s=d.getBarcodeColumnCount()+1;d.setDetectionResultColumn(0,c),d.setDetectionResultColumn(s,g);for(var m=null!=c,h=1;h<=s;h++){var w=m?h:s-h;if(void 0===d.getDetectionResultColumn(w)){var v=void 0;v=0===w||w===s?new DetectionResultRowIndicatorColumn_1.default(i,0===w):new DetectionResultColumn_1.default(i),d.setDetectionResultColumn(w,v);for(var _=-1,B=_,D=i.getMinY();D<=i.getMaxY();D++){if((_=e.getStartColumn(d,w,D,m))<0||_>i.getMaxX()){if(-1===B)continue;_=B}var E=e.detectCodeword(t,i.getMinX(),i.getMaxX(),m,_,D,a,l);null!=E&&(v.setCodeword(D,E),B=_,a=Math.min(a,E.getWidth()),l=Math.max(l,E.getWidth()))}}}return e.createDecoderResult(d)},e.merge=function(t,r){if(null==t&&null==r)return null;var o=e.getBarcodeMetadata(t,r);if(null==o)return null;var n=BoundingBox_1.default.merge(e.adjustBoundingBox(t),e.adjustBoundingBox(r));return new DetectionResult_1.default(o,n)},e.adjustBoundingBox=function(t){var r,o;if(null==t)return null;var n=t.getRowHeights();if(null==n)return null;var u=e.getMax(n),a=0;try{for(var l=__values(n),d=l.next();!d.done;d=l.next()){var i=d.value;if(a+=u-i,i>0)break}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}for(var c=t.getCodewords(),g=0;a>0&&null==c[g];g++)a--;var f=0;for(g=n.length-1;g>=0&&(f+=u-n[g],!(n[g]>0));g--);for(g=c.length-1;f>0&&null==c[g];g--)f--;return t.getBoundingBox().addMissingRows(a,f,t.isLeft())},e.getMax=function(e){var t,r,o=-1;try{for(var n=__values(e),u=n.next();!u.done;u=n.next()){var a=u.value;o=Math.max(o,a)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return o},e.getBarcodeMetadata=function(e,t){var r,o;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(o=t.getBarcodeMetadata())?r:r.getColumnCount()!==o.getColumnCount()&&r.getErrorCorrectionLevel()!==o.getErrorCorrectionLevel()&&r.getRowCount()!==o.getRowCount()?null:r},e.getRowIndicatorColumn=function(t,r,o,n,u,a){for(var l=new DetectionResultRowIndicatorColumn_1.default(r,n),d=0;d<2;d++)for(var i=0===d?1:-1,c=Math.trunc(Math.trunc(o.getX())),g=Math.trunc(Math.trunc(o.getY()));g<=r.getMaxY()&&g>=r.getMinY();g+=i){var f=e.detectCodeword(t,0,t.getWidth(),n,c,g,u,a);null!=f&&(l.setCodeword(g,f),c=n?f.getStartX():f.getEndX())}return l},e.adjustCodewordCount=function(t,r){var o=r[0][1],n=o.getValue(),u=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-e.getNumberOfECCodeWords(t.getBarcodeECLevel());if(0===n.length){if(u<1||u>PDF417Common_1.default.MAX_CODEWORDS_IN_BARCODE)throw NotFoundException_1.default.getNotFoundInstance();o.setValue(u)}else n[0]!==u&&o.setValue(u)},e.createDecoderResult=function(t){var r=e.createBarcodeMatrix(t);e.adjustCodewordCount(t,r);for(var o=new Array,n=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),u=[],a=new Array,l=0;l<t.getBarcodeRowCount();l++)for(var d=0;d<t.getBarcodeColumnCount();d++){var i=r[l][d+1].getValue(),c=l*t.getBarcodeColumnCount()+d;0===i.length?o.push(c):1===i.length?n[c]=i[0]:(a.push(c),u.push(i))}for(var g=new Array(u.length),f=0;f<g.length;f++)g[f]=u[f];return e.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),n,PDF417Common_1.default.toIntArray(o),PDF417Common_1.default.toIntArray(a),g)},e.createDecoderResultFromAmbiguousValues=function(t,r,o,n,u){for(var a=new Int32Array(n.length),l=100;l-- >0;){for(var d=0;d<a.length;d++)r[n[d]]=u[d][a[d]];try{return e.decodeCodewords(r,t,o)}catch(e){if(!(e instanceof ChecksumException_1.default))throw e}if(0===a.length)throw ChecksumException_1.default.getChecksumInstance();for(d=0;d<a.length;d++){if(a[d]<u[d].length-1){a[d]++;break}if(a[d]=0,d===a.length-1)throw ChecksumException_1.default.getChecksumInstance()}}throw ChecksumException_1.default.getChecksumInstance()},e.createBarcodeMatrix=function(e){for(var t,r,o,n,u=Array.from({length:e.getBarcodeRowCount()},(function(){return new Array(e.getBarcodeColumnCount()+2)})),a=0;a<u.length;a++)for(var l=0;l<u[a].length;l++)u[a][l]=new BarcodeValue_1.default;var d=0;try{for(var i=__values(e.getDetectionResultColumns()),c=i.next();!c.done;c=i.next()){var g=c.value;if(null!=g)try{for(var f=(o=void 0,__values(g.getCodewords())),C=f.next();!C.done;C=f.next()){var s=C.value;if(null!=s){var m=s.getRowNumber();if(m>=0){if(m>=u.length)continue;u[m][d].setValue(s.getValue())}}}}catch(e){o={error:e}}finally{try{C&&!C.done&&(n=f.return)&&n.call(f)}finally{if(o)throw o.error}}d++}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return u},e.isValidBarcodeColumn=function(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1},e.getStartColumn=function(t,r,o,n){var u,a,l=n?1:-1,d=null;if(e.isValidBarcodeColumn(t,r-l)&&(d=t.getDetectionResultColumn(r-l).getCodeword(o)),null!=d)return n?d.getEndX():d.getStartX();if(null!=(d=t.getDetectionResultColumn(r).getCodewordNearby(o)))return n?d.getStartX():d.getEndX();if(e.isValidBarcodeColumn(t,r-l)&&(d=t.getDetectionResultColumn(r-l).getCodewordNearby(o)),null!=d)return n?d.getEndX():d.getStartX();for(var i=0;e.isValidBarcodeColumn(t,r-l);){r-=l;try{for(var c=(u=void 0,__values(t.getDetectionResultColumn(r).getCodewords())),g=c.next();!g.done;g=c.next()){var f=g.value;if(null!=f)return(n?f.getEndX():f.getStartX())+l*i*(f.getEndX()-f.getStartX())}}catch(e){u={error:e}}finally{try{g&&!g.done&&(a=c.return)&&a.call(c)}finally{if(u)throw u.error}}i++}return n?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()},e.detectCodeword=function(t,r,o,n,u,a,l,d){u=e.adjustCodewordStartColumn(t,r,o,n,u,a);var i,c=e.getModuleBitCount(t,r,o,n,u,a);if(null==c)return null;var g=MathUtils_1.default.sum(c);if(n)i=u+g;else{for(var f=0;f<c.length/2;f++){var C=c[f];c[f]=c[c.length-1-f],c[c.length-1-f]=C}u=(i=u)-g}if(!e.checkCodewordSkew(g,l,d))return null;var s=PDF417CodewordDecoder_1.default.getDecodedValue(c),m=PDF417Common_1.default.getCodeword(s);return-1===m?null:new Codeword_1.default(u,i,e.getCodewordBucketNumber(s),m)},e.getModuleBitCount=function(e,t,r,o,n,u){for(var a=n,l=new Int32Array(8),d=0,i=o?1:-1,c=o;(o?a<r:a>=t)&&d<l.length;)e.get(a,u)===c?(l[d]++,a+=i):(d++,c=!c);return d===l.length||a===(o?r:t)&&d===l.length-1?l:null},e.getNumberOfECCodeWords=function(e){return 2<<e},e.adjustCodewordStartColumn=function(t,r,o,n,u,a){for(var l=u,d=n?-1:1,i=0;i<2;i++){for(;(n?l>=r:l<o)&&n===t.get(l,a);){if(Math.abs(u-l)>e.CODEWORD_SKEW_SIZE)return u;l+=d}d=-d,n=!n}return l},e.checkCodewordSkew=function(t,r,o){return r-e.CODEWORD_SKEW_SIZE<=t&&t<=o+e.CODEWORD_SKEW_SIZE},e.decodeCodewords=function(t,r,o){if(0===t.length)throw FormatException_1.default.getFormatInstance();var n=1<<r+1,u=e.correctErrors(t,o,n);e.verifyCodewordCount(t,n);var a=DecodedBitStreamParser_1.default.decode(t,""+r);return a.setErrorsCorrected(u),a.setErasures(o.length),a},e.correctErrors=function(t,r,o){if(null!=r&&r.length>o/2+e.MAX_ERRORS||o<0||o>e.MAX_EC_CODEWORDS)throw ChecksumException_1.default.getChecksumInstance();return e.errorCorrection.decode(t,o,r)},e.verifyCodewordCount=function(e,t){if(e.length<4)throw FormatException_1.default.getFormatInstance();var r=e[0];if(r>e.length)throw FormatException_1.default.getFormatInstance();if(0===r){if(!(t<e.length))throw FormatException_1.default.getFormatInstance();e[0]=e.length-t}},e.getBitCountForCodeword=function(e){for(var t=new Int32Array(8),r=0,o=t.length-1;!((1&e)!==r&&(r=1&e,--o<0));)t[o]++,e>>=1;return t},e.getCodewordBucketNumber=function(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)},e.getCodewordBucketNumber_number=function(t){return e.getCodewordBucketNumber(e.getBitCountForCodeword(t))},e.getCodewordBucketNumber_Int32Array=function(e){return(e[0]-e[2]+e[4]-e[6]+9)%9},e.toString=function(e){for(var t=new Formatter_1.default,r=0;r<e.length;r++){t.format("Row %2d: ",r);for(var o=0;o<e[r].length;o++){var n=e[r][o];0===n.getValue().length?t.format("        ",null):t.format("%4d(%2d)",n.getValue()[0],n.getConfidence(n.getValue()[0]))}t.format("%n")}return t.toString()},e.CODEWORD_SKEW_SIZE=2,e.MAX_ERRORS=3,e.MAX_EC_CODEWORDS=512,e.errorCorrection=new ErrorCorrection_1.default,e}();exports.default=PDF417ScanningDecoder;
//# sourceMappingURL=/sm/f0eb8f689ab7e65ee35af4af4b2a9650e39e3475a20116c009c00deb5355c548.map