/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/pdf417/detector/Detector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var ResultPoint_1=require("../../ResultPoint"),System_1=require("../../util/System"),Arrays_1=require("../../util/Arrays"),PDF417DetectorResult_1=require("./PDF417DetectorResult"),Detector=function(){function t(){}return t.detectMultiple=function(e,r,n){var a=e.getBlackMatrix(),u=t.detect(n,a);return u.length||((a=a.clone()).rotate180(),u=t.detect(n,a)),new PDF417DetectorResult_1.default(a,u)},t.detect=function(e,r){for(var n,a,u=new Array,l=0,i=0,o=!1;l<r.getHeight();){var f=t.findVertices(r,l,i);if(null!=f[0]||null!=f[3]){if(o=!0,u.push(f),!e)break;null!=f[2]?(i=Math.trunc(f[2].getX()),l=Math.trunc(f[2].getY())):(i=Math.trunc(f[4].getX()),l=Math.trunc(f[4].getY()))}else{if(!o)break;o=!1,i=0;try{for(var _=(n=void 0,__values(u)),A=_.next();!A.done;A=_.next()){var c=A.value;null!=c[1]&&(l=Math.trunc(Math.max(l,c[1].getY()))),null!=c[3]&&(l=Math.max(l,Math.trunc(c[3].getY())))}}catch(t){n={error:t}}finally{try{A&&!A.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}l+=t.ROW_STEP}}return u},t.findVertices=function(e,r,n){var a=e.getHeight(),u=e.getWidth(),l=new Array(8);return t.copyToResult(l,t.findRowsWithPattern(e,a,u,r,n,t.START_PATTERN),t.INDEXES_START_PATTERN),null!=l[4]&&(n=Math.trunc(l[4].getX()),r=Math.trunc(l[4].getY())),t.copyToResult(l,t.findRowsWithPattern(e,a,u,r,n,t.STOP_PATTERN),t.INDEXES_STOP_PATTERN),l},t.copyToResult=function(t,e,r){for(var n=0;n<r.length;n++)t[r[n]]=e[n]},t.findRowsWithPattern=function(e,r,n,a,u,l){for(var i=new Array(4),o=!1,f=new Int32Array(l.length);a<r;a+=t.ROW_STEP){if(null!=(T=t.findGuardPattern(e,u,a,n,!1,l,f))){for(;a>0;){if(null==(c=t.findGuardPattern(e,u,--a,n,!1,l,f))){a++;break}T=c}i[0]=new ResultPoint_1.default(T[0],a),i[1]=new ResultPoint_1.default(T[1],a),o=!0;break}}var _=a+1;if(o){for(var A=0,c=Int32Array.from([Math.trunc(i[0].getX()),Math.trunc(i[1].getX())]);_<r;_++){var T;if(null!=(T=t.findGuardPattern(e,c[0],_,n,!1,l,f))&&Math.abs(c[0]-T[0])<t.MAX_PATTERN_DRIFT&&Math.abs(c[1]-T[1])<t.MAX_PATTERN_DRIFT)c=T,A=0;else{if(A>t.SKIPPED_ROW_COUNT_MAX)break;A++}}_-=A+1,i[2]=new ResultPoint_1.default(c[0],_),i[3]=new ResultPoint_1.default(c[1],_)}return _-a<t.BARCODE_MIN_HEIGHT&&Arrays_1.default.fill(i,null),i},t.findGuardPattern=function(e,r,n,a,u,l,i){Arrays_1.default.fillWithin(i,0,i.length,0);for(var o=r,f=0;e.get(o,n)&&o>0&&f++<t.MAX_PIXEL_DRIFT;)o--;for(var _=o,A=0,c=l.length,T=u;_<a;_++){if(e.get(_,n)!==T)i[A]++;else{if(A===c-1){if(t.patternMatchVariance(i,l,t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE)return new Int32Array([o,_]);o+=i[0]+i[1],System_1.default.arraycopy(i,2,i,0,A-1),i[A-1]=0,i[A]=0,A--}else A++;i[A]=1,T=!T}}return A===c-1&&t.patternMatchVariance(i,l,t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE?new Int32Array([o,_-1]):null},t.patternMatchVariance=function(t,e,r){for(var n=t.length,a=0,u=0,l=0;l<n;l++)a+=t[l],u+=e[l];if(a<u)return 1/0;var i=a/u;r*=i;for(var o=0,f=0;f<n;f++){var _=t[f],A=e[f]*i,c=_>A?_-A:A-_;if(c>r)return 1/0;o+=c}return o/a},t.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),t.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),t.MAX_AVG_VARIANCE=.42,t.MAX_INDIVIDUAL_VARIANCE=.8,t.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),t.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),t.MAX_PIXEL_DRIFT=3,t.MAX_PATTERN_DRIFT=5,t.SKIPPED_ROW_COUNT_MAX=25,t.ROW_STEP=5,t.BARCODE_MIN_HEIGHT=10,t}();exports.default=Detector;
//# sourceMappingURL=/sm/6bb702405519f0eeefdd1e9003deb260712c2c04f1bb54fca195123ad4761951.map