/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/pdf417/decoder/DecodedBitStreamParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Mode,BigInteger,FormatException_1=require("../../FormatException"),CharacterSetECI_1=require("../../common/CharacterSetECI"),DecoderResult_1=require("../../common/DecoderResult"),PDF417ResultMetadata_1=require("../PDF417ResultMetadata"),Arrays_1=require("../../util/Arrays"),StringBuilder_1=require("../../util/StringBuilder"),Integer_1=require("../../util/Integer"),Long_1=require("../../util/Long"),ByteArrayOutputStream_1=require("../../util/ByteArrayOutputStream"),StringEncoding_1=require("../../util/StringEncoding");function getBigIntConstructor(){if("undefined"!=typeof window)return window.BigInt||null;if("undefined"!=typeof global)return global.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}function createBigInt(e){if(void 0===BigInteger&&(BigInteger=getBigIntConstructor()),null===BigInteger)throw new Error("BigInt is not supported!");return BigInteger(e)}function getEXP900(){var e=[];e[0]=createBigInt(1);var _=createBigInt(900);e[1]=_;for(var t=2;t<16;t++)e[t]=e[t-1]*_;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(Mode||(Mode={}));var DecodedBitStreamParser=function(){function e(){}return e.decode=function(_,t){var a=new StringBuilder_1.default(""),r=CharacterSetECI_1.default.ISO8859_1;a.enableDecoding(r);for(var O=1,C=_[O++],E=new PDF417ResultMetadata_1.default;O<_[0];){switch(C){case e.TEXT_COMPACTION_MODE_LATCH:O=e.textCompaction(_,O,a);break;case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:O=e.byteCompaction(C,_,r,O,a);break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:a.append(_[O++]);break;case e.NUMERIC_COMPACTION_MODE_LATCH:O=e.numericCompaction(_,O,a);break;case e.ECI_CHARSET:CharacterSetECI_1.default.getCharacterSetECIByValue(_[O++]);break;case e.ECI_GENERAL_PURPOSE:O+=2;break;case e.ECI_USER_DEFINED:O++;break;case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:O=e.decodeMacroBlock(_,O,E);break;case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:throw new FormatException_1.default;default:O--,O=e.textCompaction(_,O,a)}if(!(O<_.length))throw FormatException_1.default.getFormatInstance();C=_[O++]}if(0===a.length())throw FormatException_1.default.getFormatInstance();var T=new DecoderResult_1.default(null,a.toString(),null,t);return T.setOther(E),T},e.decodeMacroBlock=function(_,t,a){if(t+e.NUMBER_OF_SEQUENCE_CODEWORDS>_[0])throw FormatException_1.default.getFormatInstance();for(var r=new Int32Array(e.NUMBER_OF_SEQUENCE_CODEWORDS),O=0;O<e.NUMBER_OF_SEQUENCE_CODEWORDS;O++,t++)r[O]=_[t];a.setSegmentIndex(Integer_1.default.parseInt(e.decodeBase900toBase10(r,e.NUMBER_OF_SEQUENCE_CODEWORDS)));var C=new StringBuilder_1.default;t=e.textCompaction(_,t,C),a.setFileId(C.toString());var E=-1;for(_[t]===e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(E=t+1);t<_[0];)switch(_[t]){case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(_[++t]){case e.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:var T=new StringBuilder_1.default;t=e.textCompaction(_,t+1,T),a.setFileName(T.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_SENDER:var A=new StringBuilder_1.default;t=e.textCompaction(_,t+1,A),a.setSender(A.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:var n=new StringBuilder_1.default;t=e.textCompaction(_,t+1,n),a.setAddressee(n.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:var M=new StringBuilder_1.default;t=e.numericCompaction(_,t+1,M),a.setSegmentCount(Integer_1.default.parseInt(M.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:var I=new StringBuilder_1.default;t=e.numericCompaction(_,t+1,I),a.setTimestamp(Long_1.default.parseLong(I.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:var o=new StringBuilder_1.default;t=e.numericCompaction(_,t+1,o),a.setChecksum(Integer_1.default.parseInt(o.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:var c=new StringBuilder_1.default;t=e.numericCompaction(_,t+1,c),a.setFileSize(Long_1.default.parseLong(c.toString()));break;default:throw FormatException_1.default.getFormatInstance()}break;case e.MACRO_PDF417_TERMINATOR:t++,a.setLastSegment(!0);break;default:throw FormatException_1.default.getFormatInstance()}if(-1!==E){var i=t-E;a.isLastSegment()&&i--,a.setOptionalData(Arrays_1.default.copyOfRange(_,E,E+i))}return t},e.textCompaction=function(_,t,a){for(var r=new Int32Array(2*(_[0]-t)),O=new Int32Array(2*(_[0]-t)),C=0,E=!1;t<_[0]&&!E;){var T=_[t++];if(T<e.TEXT_COMPACTION_MODE_LATCH)r[C]=T/30,r[C+1]=T%30,C+=2;else switch(T){case e.TEXT_COMPACTION_MODE_LATCH:r[C++]=e.TEXT_COMPACTION_MODE_LATCH;break;case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:t--,E=!0;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r[C]=e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,T=_[t++],O[C]=T,C++}}return e.decodeTextCompaction(r,O,C,a),t},e.decodeTextCompaction=function(_,t,a,r){for(var O=Mode.ALPHA,C=Mode.ALPHA,E=0;E<a;){var T=_[E],A="";switch(O){case Mode.ALPHA:if(T<26)A=String.fromCharCode(65+T);else switch(T){case 26:A=" ";break;case e.LL:O=Mode.LOWER;break;case e.ML:O=Mode.MIXED;break;case e.PS:C=O,O=Mode.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:O=Mode.ALPHA}break;case Mode.LOWER:if(T<26)A=String.fromCharCode(97+T);else switch(T){case 26:A=" ";break;case e.AS:C=O,O=Mode.ALPHA_SHIFT;break;case e.ML:O=Mode.MIXED;break;case e.PS:C=O,O=Mode.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:O=Mode.ALPHA}break;case Mode.MIXED:if(T<e.PL)A=e.MIXED_CHARS[T];else switch(T){case e.PL:O=Mode.PUNCT;break;case 26:A=" ";break;case e.LL:O=Mode.LOWER;break;case e.AL:O=Mode.ALPHA;break;case e.PS:C=O,O=Mode.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:O=Mode.ALPHA}break;case Mode.PUNCT:if(T<e.PAL)A=e.PUNCT_CHARS[T];else switch(T){case e.PAL:O=Mode.ALPHA;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:O=Mode.ALPHA}break;case Mode.ALPHA_SHIFT:if(O=C,T<26)A=String.fromCharCode(65+T);else switch(T){case 26:A=" ";break;case e.TEXT_COMPACTION_MODE_LATCH:O=Mode.ALPHA}break;case Mode.PUNCT_SHIFT:if(O=C,T<e.PAL)A=e.PUNCT_CHARS[T];else switch(T){case e.PAL:O=Mode.ALPHA;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:O=Mode.ALPHA}}""!==A&&r.append(A),E++}},e.byteCompaction=function(_,t,a,r,O){var C=new ByteArrayOutputStream_1.default,E=0,T=0,A=!1;switch(_){case e.BYTE_COMPACTION_MODE_LATCH:for(var n=new Int32Array(6),M=t[r++];r<t[0]&&!A;)switch(n[E++]=M,T=900*T+M,M=t[r++]){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:r--,A=!0;break;default:if(E%5==0&&E>0){for(var I=0;I<6;++I)C.write(Number(createBigInt(T)>>createBigInt(8*(5-I))));T=0,E=0}}r===t[0]&&M<e.TEXT_COMPACTION_MODE_LATCH&&(n[E++]=M);for(var o=0;o<E;o++)C.write(n[o]);break;case e.BYTE_COMPACTION_MODE_LATCH_6:for(;r<t[0]&&!A;){var c=t[r++];if(c<e.TEXT_COMPACTION_MODE_LATCH)E++,T=900*T+c;else switch(c){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:r--,A=!0}if(E%5==0&&E>0){for(I=0;I<6;++I)C.write(Number(createBigInt(T)>>createBigInt(8*(5-I))));T=0,E=0}}}return O.append(StringEncoding_1.default.decode(C.toByteArray(),a)),r},e.numericCompaction=function(_,t,a){for(var r=0,O=!1,C=new Int32Array(e.MAX_NUMERIC_CODEWORDS);t<_[0]&&!O;){var E=_[t++];if(t===_[0]&&(O=!0),E<e.TEXT_COMPACTION_MODE_LATCH)C[r]=E,r++;else switch(E){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:t--,O=!0}(r%e.MAX_NUMERIC_CODEWORDS==0||E===e.NUMERIC_COMPACTION_MODE_LATCH||O)&&r>0&&(a.append(e.decodeBase900toBase10(C,r)),r=0)}return t},e.decodeBase900toBase10=function(_,t){for(var a=createBigInt(0),r=0;r<t;r++)a+=e.EXP900[t-r-1]*createBigInt(_[r]);var O=a.toString();if("1"!==O.charAt(0))throw new FormatException_1.default;return O.substring(1)},e.TEXT_COMPACTION_MODE_LATCH=900,e.BYTE_COMPACTION_MODE_LATCH=901,e.NUMERIC_COMPACTION_MODE_LATCH=902,e.BYTE_COMPACTION_MODE_LATCH_6=924,e.ECI_USER_DEFINED=925,e.ECI_GENERAL_PURPOSE=926,e.ECI_CHARSET=927,e.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,e.MACRO_PDF417_TERMINATOR=922,e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,e.MAX_NUMERIC_CODEWORDS=15,e.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,e.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,e.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,e.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,e.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,e.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,e.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,e.PL=25,e.LL=27,e.AS=27,e.ML=28,e.AL=28,e.PS=29,e.PAL=29,e.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",e.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",e.EXP900=getBigIntConstructor()?getEXP900():[],e.NUMBER_OF_SEQUENCE_CODEWORDS=2,e}();exports.default=DecodedBitStreamParser;
//# sourceMappingURL=/sm/6ba5e621f3e02918ac07ff8f6d8d931033a19bc2373d3ae0998c460234399535.map