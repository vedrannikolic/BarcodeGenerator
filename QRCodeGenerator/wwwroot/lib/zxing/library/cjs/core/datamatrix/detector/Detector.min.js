/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/datamatrix/detector/Detector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var WhiteRectangleDetector_1=require("../../common/detector/WhiteRectangleDetector"),DetectorResult_1=require("../../common/DetectorResult"),GridSamplerInstance_1=require("../../common/GridSamplerInstance"),NotFoundException_1=require("../../NotFoundException"),ResultPoint_1=require("../../ResultPoint"),Detector=function(){function t(t){this.image=t,this.rectangleDetector=new WhiteRectangleDetector_1.default(this.image)}return t.prototype.detect=function(){var e=this.rectangleDetector.detect(),i=this.detectSolid1(e);if((i=this.detectSolid2(i))[3]=this.correctTopRight(i),!i[3])throw new NotFoundException_1.default;var n=(i=this.shiftToModuleCenter(i))[0],s=i[1],o=i[2],r=i[3],a=this.transitionsBetween(n,r)+1,h=this.transitionsBetween(o,r)+1;1==(1&a)&&(a+=1),1==(1&h)&&(h+=1),4*a<7*h&&4*h<7*a&&(a=h=Math.max(a,h));var g=t.sampleGrid(this.image,n,s,o,r,a,h);return new DetectorResult_1.default(g,[n,s,o,r])},t.shiftPoint=function(t,e,i){var n=(e.getX()-t.getX())/(i+1),s=(e.getY()-t.getY())/(i+1);return new ResultPoint_1.default(t.getX()+n,t.getY()+s)},t.moveAway=function(t,e,i){var n=t.getX(),s=t.getY();return n<e?n-=1:n+=1,s<i?s-=1:s+=1,new ResultPoint_1.default(n,s)},t.prototype.detectSolid1=function(t){var e=t[0],i=t[1],n=t[3],s=t[2],o=this.transitionsBetween(e,i),r=this.transitionsBetween(i,n),a=this.transitionsBetween(n,s),h=this.transitionsBetween(s,e),g=o,u=[s,e,i,n];return g>r&&(g=r,u[0]=e,u[1]=i,u[2]=n,u[3]=s),g>a&&(g=a,u[0]=i,u[1]=n,u[2]=s,u[3]=e),g>h&&(u[0]=n,u[1]=s,u[2]=e,u[3]=i),u},t.prototype.detectSolid2=function(e){var i=e[0],n=e[1],s=e[2],o=e[3],r=this.transitionsBetween(i,o),a=t.shiftPoint(n,s,4*(r+1)),h=t.shiftPoint(s,n,4*(r+1));return this.transitionsBetween(a,i)<this.transitionsBetween(h,o)?(e[0]=i,e[1]=n,e[2]=s,e[3]=o):(e[0]=n,e[1]=s,e[2]=o,e[3]=i),e},t.prototype.correctTopRight=function(e){var i=e[0],n=e[1],s=e[2],o=e[3],r=this.transitionsBetween(i,o),a=this.transitionsBetween(n,o),h=t.shiftPoint(i,n,4*(a+1)),g=t.shiftPoint(s,n,4*(r+1));r=this.transitionsBetween(h,o),a=this.transitionsBetween(g,o);var u=new ResultPoint_1.default(o.getX()+(s.getX()-n.getX())/(r+1),o.getY()+(s.getY()-n.getY())/(r+1)),c=new ResultPoint_1.default(o.getX()+(i.getX()-n.getX())/(a+1),o.getY()+(i.getY()-n.getY())/(a+1));return this.isValid(u)?this.isValid(c)?this.transitionsBetween(h,u)+this.transitionsBetween(g,u)>this.transitionsBetween(h,c)+this.transitionsBetween(g,c)?u:c:u:this.isValid(c)?c:null},t.prototype.shiftToModuleCenter=function(e){var i=e[0],n=e[1],s=e[2],o=e[3],r=this.transitionsBetween(i,o)+1,a=this.transitionsBetween(s,o)+1,h=t.shiftPoint(i,n,4*a),g=t.shiftPoint(s,n,4*r);1==(1&(r=this.transitionsBetween(h,o)+1))&&(r+=1),1==(1&(a=this.transitionsBetween(g,o)+1))&&(a+=1);var u,c,f=(i.getX()+n.getX()+s.getX()+o.getX())/4,l=(i.getY()+n.getY()+s.getY()+o.getY())/4;return i=t.moveAway(i,f,l),n=t.moveAway(n,f,l),s=t.moveAway(s,f,l),o=t.moveAway(o,f,l),h=t.shiftPoint(i,n,4*a),h=t.shiftPoint(h,o,4*r),u=t.shiftPoint(n,i,4*a),u=t.shiftPoint(u,s,4*r),g=t.shiftPoint(s,o,4*a),g=t.shiftPoint(g,n,4*r),c=t.shiftPoint(o,s,4*a),[h,u,g,c=t.shiftPoint(c,i,4*r)]},t.prototype.isValid=function(t){return t.getX()>=0&&t.getX()<this.image.getWidth()&&t.getY()>0&&t.getY()<this.image.getHeight()},t.sampleGrid=function(t,e,i,n,s,o,r){return GridSamplerInstance_1.default.getInstance().sampleGrid(t,o,r,.5,.5,o-.5,.5,o-.5,r-.5,.5,r-.5,e.getX(),e.getY(),s.getX(),s.getY(),n.getX(),n.getY(),i.getX(),i.getY())},t.prototype.transitionsBetween=function(t,e){var i=Math.trunc(t.getX()),n=Math.trunc(t.getY()),s=Math.trunc(e.getX()),o=Math.trunc(e.getY()),r=Math.abs(o-n)>Math.abs(s-i);if(r){var a=i;i=n,n=a,a=s,s=o,o=a}for(var h=Math.abs(s-i),g=Math.abs(o-n),u=-h/2,c=n<o?1:-1,f=i<s?1:-1,l=0,d=this.image.get(r?n:i,r?i:n),w=i,p=n;w!==s;w+=f){var m=this.image.get(r?p:w,r?w:p);if(m!==d&&(l++,d=m),(u+=g)>0){if(p===o)break;p+=c,u-=h}}return l},t}();exports.default=Detector;
//# sourceMappingURL=/sm/66369077284a8f43fd73cb56cf6504f50c6f7893049b3844faf7be801a239f86.map