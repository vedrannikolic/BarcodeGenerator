/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/datamatrix/encoder/C40Encoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.C40Encoder=void 0;var StringBuilder_1=require("../../util/StringBuilder"),HighLevelEncoder_1=require("./HighLevelEncoder"),constants_1=require("./constants"),C40Encoder=function(){function e(){}return e.prototype.getEncodingMode=function(){return constants_1.C40_ENCODATION},e.prototype.encodeMaximal=function(e){for(var t=new StringBuilder_1.default,r=0,o=e.pos,n=0;e.hasMoreCharacters();){var a=e.getCurrentChar();e.pos++,r=this.encodeChar(a,t),t.length()%3==0&&(o=e.pos,n=t.length())}if(n!==t.length()){var d=Math.floor(t.length()/3*2),i=Math.floor(e.getCodewordCount()+d+1);e.updateSymbolInfo(i);var h=e.getSymbolInfo().getDataCapacity()-i,p=Math.floor(t.length()%3);(2===p&&2!==h||1===p&&(r>3||1!==h))&&(e.pos=o)}t.length()>0&&e.writeCodeword(constants_1.LATCH_TO_C40),this.handleEOD(e,t)},e.prototype.encode=function(e){for(var t=new StringBuilder_1.default;e.hasMoreCharacters();){var r=e.getCurrentChar();e.pos++;var o=this.encodeChar(r,t),n=2*Math.floor(t.length()/3),a=e.getCodewordCount()+n;e.updateSymbolInfo(a);var d=e.getSymbolInfo().getDataCapacity()-a;if(!e.hasMoreCharacters()){var i=new StringBuilder_1.default;for(t.length()%3==2&&2!==d&&(o=this.backtrackOneCharacter(e,t,i,o));t.length()%3==1&&(o>3||1!==d);)o=this.backtrackOneCharacter(e,t,i,o);break}if(t.length()%3==0)if(HighLevelEncoder_1.default.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(constants_1.ASCII_ENCODATION);break}}this.handleEOD(e,t)},e.prototype.backtrackOneCharacter=function(e,t,r,o){var n=t.length(),a=t.toString().substring(0,n-o);t.setLengthToZero(),t.append(a),e.pos--;var d=e.getCurrentChar();return o=this.encodeChar(d,r),e.resetSymbolInfo(),o},e.prototype.writeNextTriplet=function(e,t){e.writeCodewords(this.encodeToCodewords(t.toString()));var r=t.toString().substring(3);t.setLengthToZero(),t.append(r)},e.prototype.handleEOD=function(e,t){var r=Math.floor(t.length()/3*2),o=t.length()%3,n=e.getCodewordCount()+r;e.updateSymbolInfo(n);var a=e.getSymbolInfo().getDataCapacity()-n;if(2===o){for(t.append("\0");t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(constants_1.C40_UNLATCH)}else if(1===a&&1===o){for(;t.length()>=3;)this.writeNextTriplet(e,t);e.hasMoreCharacters()&&e.writeCodeword(constants_1.C40_UNLATCH),e.pos--}else{if(0!==o)throw new Error("Unexpected case. Please report!");for(;t.length()>=3;)this.writeNextTriplet(e,t);(a>0||e.hasMoreCharacters())&&e.writeCodeword(constants_1.C40_UNLATCH)}e.signalEncoderChange(constants_1.ASCII_ENCODATION)},e.prototype.encodeChar=function(e,t){if(e===" ".charCodeAt(0))return t.append(3),1;if(e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return t.append(e-48+4),1;if(e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0))return t.append(e-65+14),1;if(e<" ".charCodeAt(0))return t.append(0),t.append(e),2;if(e<="/".charCodeAt(0))return t.append(1),t.append(e-33),2;if(e<="@".charCodeAt(0))return t.append(1),t.append(e-58+15),2;if(e<="_".charCodeAt(0))return t.append(1),t.append(e-91+22),2;if(e<=127)return t.append(2),t.append(e-96),2;t.append("1");var r=2;return r+=this.encodeChar(e-128,t)},e.prototype.encodeToCodewords=function(e){var t=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,r=t/256,o=t%256,n=new StringBuilder_1.default;return n.append(r),n.append(o),n.toString()},e}();exports.C40Encoder=C40Encoder;
//# sourceMappingURL=/sm/916a8f3a8189225487891228292c1fdcec31eaa79cc1f40544a62e4387193477.map