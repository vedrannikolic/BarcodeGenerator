/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/qrcode/encoder/Encoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var EncodeHintType_1=require("../../EncodeHintType"),BitArray_1=require("../../common/BitArray"),CharacterSetECI_1=require("../../common/CharacterSetECI"),GenericGF_1=require("../../common/reedsolomon/GenericGF"),ReedSolomonEncoder_1=require("../../common/reedsolomon/ReedSolomonEncoder"),Mode_1=require("../decoder/Mode"),Version_1=require("../decoder/Version"),MaskUtil_1=require("./MaskUtil"),ByteMatrix_1=require("./ByteMatrix"),QRCode_1=require("./QRCode"),MatrixUtil_1=require("./MatrixUtil"),StringEncoding_1=require("../../util/StringEncoding"),BlockPair_1=require("./BlockPair"),WriterException_1=require("../../WriterException"),Encoder=function(){function e(){}return e.calculateMaskPenalty=function(e){return MaskUtil_1.default.applyMaskPenaltyRule1(e)+MaskUtil_1.default.applyMaskPenaltyRule2(e)+MaskUtil_1.default.applyMaskPenaltyRule3(e)+MaskUtil_1.default.applyMaskPenaltyRule4(e)},e.encode=function(t,r,a){void 0===a&&(a=null);var n=e.DEFAULT_BYTE_MODE_ENCODING,i=null!==a&&void 0!==a.get(EncodeHintType_1.default.CHARACTER_SET);i&&(n=a.get(EncodeHintType_1.default.CHARACTER_SET).toString());var o=this.chooseMode(t,n),d=new BitArray_1.default;if(o===Mode_1.default.BYTE&&(i||e.DEFAULT_BYTE_MODE_ENCODING!==n)){var l=CharacterSetECI_1.default.getCharacterSetECIByName(n);void 0!==l&&this.appendECI(l,d)}this.appendModeInfo(o,d);var u,s=new BitArray_1.default;if(this.appendBytes(t,o,s,n),null!==a&&void 0!==a.get(EncodeHintType_1.default.QR_VERSION)){var c=Number.parseInt(a.get(EncodeHintType_1.default.QR_VERSION).toString(),10);u=Version_1.default.getVersionForNumber(c);var f=this.calculateBitsNeeded(o,d,s,u);if(!this.willFit(f,u,r))throw new WriterException_1.default("Data too big for requested version")}else u=this.recommendVersion(r,o,d,s);var p=new BitArray_1.default;p.appendBitArray(d);var h=o===Mode_1.default.BYTE?s.getSizeInBytes():t.length;this.appendLengthInfo(h,u,o,p),p.appendBitArray(s);var _=u.getECBlocksForLevel(r),E=u.getTotalCodewords()-_.getTotalECCodewords();this.terminateBits(E,p);var g=this.interleaveWithECBytes(p,u.getTotalCodewords(),E,_.getNumBlocks()),y=new QRCode_1.default;y.setECLevel(r),y.setMode(o),y.setVersion(u);var B=u.getDimensionForVersion(),v=new ByteMatrix_1.default(B,B),C=this.chooseMaskPattern(g,r,u,v);return y.setMaskPattern(C),MatrixUtil_1.default.buildMatrix(g,r,u,C,v),y.setMatrix(v),y},e.recommendVersion=function(e,t,r,a){var n=this.calculateBitsNeeded(t,r,a,Version_1.default.getVersionForNumber(1)),i=this.chooseVersion(n,e),o=this.calculateBitsNeeded(t,r,a,i);return this.chooseVersion(o,e)},e.calculateBitsNeeded=function(e,t,r,a){return t.getSize()+e.getCharacterCountBits(a)+r.getSize()},e.getAlphanumericCode=function(t){return t<e.ALPHANUMERIC_TABLE.length?e.ALPHANUMERIC_TABLE[t]:-1},e.chooseMode=function(t,r){if(void 0===r&&(r=null),CharacterSetECI_1.default.SJIS.getName()===r&&this.isOnlyDoubleByteKanji(t))return Mode_1.default.KANJI;for(var a=!1,n=!1,i=0,o=t.length;i<o;++i){var d=t.charAt(i);if(e.isDigit(d))a=!0;else{if(-1===this.getAlphanumericCode(d.charCodeAt(0)))return Mode_1.default.BYTE;n=!0}}return n?Mode_1.default.ALPHANUMERIC:a?Mode_1.default.NUMERIC:Mode_1.default.BYTE},e.isOnlyDoubleByteKanji=function(e){var t;try{t=StringEncoding_1.default.encode(e,CharacterSetECI_1.default.SJIS)}catch(e){return!1}var r=t.length;if(r%2!=0)return!1;for(var a=0;a<r;a+=2){var n=255&t[a];if((n<129||n>159)&&(n<224||n>235))return!1}return!0},e.chooseMaskPattern=function(e,t,r,a){for(var n=Number.MAX_SAFE_INTEGER,i=-1,o=0;o<QRCode_1.default.NUM_MASK_PATTERNS;o++){MatrixUtil_1.default.buildMatrix(e,t,r,o,a);var d=this.calculateMaskPenalty(a);d<n&&(n=d,i=o)}return i},e.chooseVersion=function(t,r){for(var a=1;a<=40;a++){var n=Version_1.default.getVersionForNumber(a);if(e.willFit(t,n,r))return n}throw new WriterException_1.default("Data too big")},e.willFit=function(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8},e.terminateBits=function(e,t){var r=8*e;if(t.getSize()>r)throw new WriterException_1.default("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(var a=0;a<4&&t.getSize()<r;++a)t.appendBit(!1);var n=7&t.getSize();if(n>0)for(a=n;a<8;a++)t.appendBit(!1);var i=e-t.getSizeInBytes();for(a=0;a<i;++a)t.appendBits(0==(1&a)?236:17,8);if(t.getSize()!==r)throw new WriterException_1.default("Bits size does not equal capacity")},e.getNumDataBytesAndNumECBytesForBlockID=function(e,t,r,a,n,i){if(a>=r)throw new WriterException_1.default("Block ID too large");var o=e%r,d=r-o,l=Math.floor(e/r),u=l+1,s=Math.floor(t/r),c=s+1,f=l-s,p=u-c;if(f!==p)throw new WriterException_1.default("EC bytes mismatch");if(r!==d+o)throw new WriterException_1.default("RS blocks mismatch");if(e!==(s+f)*d+(c+p)*o)throw new WriterException_1.default("Total bytes mismatch");a<d?(n[0]=s,i[0]=f):(n[0]=c,i[0]=p)},e.interleaveWithECBytes=function(t,r,a,n){var i,o,d,l;if(t.getSizeInBytes()!==a)throw new WriterException_1.default("Number of bits and data bytes does not match");for(var u=0,s=0,c=0,f=new Array,p=0;p<n;++p){var h=new Int32Array(1),_=new Int32Array(1);e.getNumDataBytesAndNumECBytesForBlockID(r,a,n,p,h,_);var E=h[0],g=new Uint8Array(E);t.toBytes(8*u,g,0,E);var y=e.generateECBytes(g,_[0]);f.push(new BlockPair_1.default(g,y)),s=Math.max(s,E),c=Math.max(c,y.length),u+=h[0]}if(a!==u)throw new WriterException_1.default("Data bytes does not match offset");var B=new BitArray_1.default;for(p=0;p<s;++p)try{for(var v=(i=void 0,__values(f)),C=v.next();!C.done;C=v.next()){p<(g=C.value.getDataBytes()).length&&B.appendBits(g[p],8)}}catch(e){i={error:e}}finally{try{C&&!C.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}for(p=0;p<c;++p)try{for(var w=(d=void 0,__values(f)),M=w.next();!M.done;M=w.next()){p<(y=M.value.getErrorCorrectionBytes()).length&&B.appendBits(y[p],8)}}catch(e){d={error:e}}finally{try{M&&!M.done&&(l=w.return)&&l.call(w)}finally{if(d)throw d.error}}if(r!==B.getSizeInBytes())throw new WriterException_1.default("Interleaving error: "+r+" and "+B.getSizeInBytes()+" differ.");return B},e.generateECBytes=function(e,t){for(var r=e.length,a=new Int32Array(r+t),n=0;n<r;n++)a[n]=255&e[n];new ReedSolomonEncoder_1.default(GenericGF_1.default.QR_CODE_FIELD_256).encode(a,t);var i=new Uint8Array(t);for(n=0;n<t;n++)i[n]=a[r+n];return i},e.appendModeInfo=function(e,t){t.appendBits(e.getBits(),4)},e.appendLengthInfo=function(e,t,r,a){var n=r.getCharacterCountBits(t);if(e>=1<<n)throw new WriterException_1.default(e+" is bigger than "+((1<<n)-1));a.appendBits(e,n)},e.appendBytes=function(t,r,a,n){switch(r){case Mode_1.default.NUMERIC:e.appendNumericBytes(t,a);break;case Mode_1.default.ALPHANUMERIC:e.appendAlphanumericBytes(t,a);break;case Mode_1.default.BYTE:e.append8BitBytes(t,a,n);break;case Mode_1.default.KANJI:e.appendKanjiBytes(t,a);break;default:throw new WriterException_1.default("Invalid mode: "+r)}},e.getDigit=function(e){return e.charCodeAt(0)-48},e.isDigit=function(t){var r=e.getDigit(t);return r>=0&&r<=9},e.appendNumericBytes=function(t,r){for(var a=t.length,n=0;n<a;){var i=e.getDigit(t.charAt(n));if(n+2<a){var o=e.getDigit(t.charAt(n+1)),d=e.getDigit(t.charAt(n+2));r.appendBits(100*i+10*o+d,10),n+=3}else if(n+1<a){o=e.getDigit(t.charAt(n+1));r.appendBits(10*i+o,7),n+=2}else r.appendBits(i,4),n++}},e.appendAlphanumericBytes=function(t,r){for(var a=t.length,n=0;n<a;){var i=e.getAlphanumericCode(t.charCodeAt(n));if(-1===i)throw new WriterException_1.default;if(n+1<a){var o=e.getAlphanumericCode(t.charCodeAt(n+1));if(-1===o)throw new WriterException_1.default;r.appendBits(45*i+o,11),n+=2}else r.appendBits(i,6),n++}},e.append8BitBytes=function(e,t,r){var a;try{a=StringEncoding_1.default.encode(e,r)}catch(e){throw new WriterException_1.default(e)}for(var n=0,i=a.length;n!==i;n++){var o=a[n];t.appendBits(o,8)}},e.appendKanjiBytes=function(e,t){var r;try{r=StringEncoding_1.default.encode(e,CharacterSetECI_1.default.SJIS)}catch(e){throw new WriterException_1.default(e)}for(var a=r.length,n=0;n<a;n+=2){var i=(255&r[n])<<8&4294967295|255&r[n+1],o=-1;if(i>=33088&&i<=40956?o=i-33088:i>=57408&&i<=60351&&(o=i-49472),-1===o)throw new WriterException_1.default("Invalid byte sequence");var d=192*(o>>8)+(255&o);t.appendBits(d,13)}},e.appendECI=function(e,t){t.appendBits(Mode_1.default.ECI.getBits(),4),t.appendBits(e.getValue(),8)},e.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),e.DEFAULT_BYTE_MODE_ENCODING=CharacterSetECI_1.default.UTF8.getName(),e}();exports.default=Encoder;
//# sourceMappingURL=/sm/42869cb676358200f410020f372f3720507d6fe3e2ecb1c906b9018cc314e3a6.map