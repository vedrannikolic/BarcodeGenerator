/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/qrcode/detector/Detector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MathUtils_1=require("../../common/detector/MathUtils"),DetectorResult_1=require("../../common/DetectorResult"),GridSamplerInstance_1=require("../../common/GridSamplerInstance"),PerspectiveTransform_1=require("../../common/PerspectiveTransform"),DecodeHintType_1=require("../../DecodeHintType"),NotFoundException_1=require("../../NotFoundException"),ResultPoint_1=require("../../ResultPoint"),Version_1=require("../decoder/Version"),AlignmentPatternFinder_1=require("./AlignmentPatternFinder"),FinderPatternFinder_1=require("./FinderPatternFinder"),Detector=function(){function e(e){this.image=e}return e.prototype.getImage=function(){return this.image},e.prototype.getResultPointCallback=function(){return this.resultPointCallback},e.prototype.detect=function(e){this.resultPointCallback=null==e?null:e.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);var t=new FinderPatternFinder_1.default(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(t)},e.prototype.processFinderPatternInfo=function(t){var i=t.getTopLeft(),n=t.getTopRight(),r=t.getBottomLeft(),a=this.calculateModuleSize(i,n,r);if(a<1)throw new NotFoundException_1.default("No pattern found in proccess finder.");var o=e.computeDimension(i,n,r,a),l=Version_1.default.getProvisionalVersionForDimension(o),s=l.getDimensionForVersion()-7,u=null;if(l.getAlignmentPatternCenters().length>0)for(var c=n.getX()-i.getX()+r.getX(),f=n.getY()-i.getY()+r.getY(),d=1-3/s,g=Math.floor(i.getX()+d*(c-i.getX())),h=Math.floor(i.getY()+d*(f-i.getY())),m=4;m<=16;m<<=1)try{u=this.findAlignmentInRegion(a,g,h,m);break}catch(e){if(!(e instanceof NotFoundException_1.default))throw e}var p,M=e.createTransform(i,n,r,u,o),_=e.sampleGrid(this.image,M,o);return p=null===u?[r,i,n]:[r,i,n,u],new DetectorResult_1.default(_,p)},e.createTransform=function(e,t,i,n,r){var a,o,l,s,u=r-3.5;return null!==n?(a=n.getX(),o=n.getY(),s=l=u-3):(a=t.getX()-e.getX()+i.getX(),o=t.getY()-e.getY()+i.getY(),l=u,s=u),PerspectiveTransform_1.default.quadrilateralToQuadrilateral(3.5,3.5,u,3.5,l,s,3.5,u,e.getX(),e.getY(),t.getX(),t.getY(),a,o,i.getX(),i.getY())},e.sampleGrid=function(e,t,i){return GridSamplerInstance_1.default.getInstance().sampleGridWithTransform(e,i,i,t)},e.computeDimension=function(e,t,i,n){var r=MathUtils_1.default.round(ResultPoint_1.default.distance(e,t)/n),a=MathUtils_1.default.round(ResultPoint_1.default.distance(e,i)/n),o=Math.floor((r+a)/2)+7;switch(3&o){case 0:o++;break;case 2:o--;break;case 3:throw new NotFoundException_1.default("Dimensions could be not found.")}return o},e.prototype.calculateModuleSize=function(e,t,i){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,i))/2},e.prototype.calculateModuleSizeOneWay=function(e,t){var i=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(i)?n/7:isNaN(n)?i/7:(i+n)/14},e.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,t,i,n){var r=this.sizeOfBlackWhiteBlackRun(e,t,i,n),a=1,o=e-(i-e);o<0?(a=e/(e-o),o=0):o>=this.image.getWidth()&&(a=(this.image.getWidth()-1-e)/(o-e),o=this.image.getWidth()-1);var l=Math.floor(t-(n-t)*a);return a=1,l<0?(a=t/(t-l),l=0):l>=this.image.getHeight()&&(a=(this.image.getHeight()-1-t)/(l-t),l=this.image.getHeight()-1),o=Math.floor(e+(o-e)*a),(r+=this.sizeOfBlackWhiteBlackRun(e,t,o,l))-1},e.prototype.sizeOfBlackWhiteBlackRun=function(e,t,i,n){var r=Math.abs(n-t)>Math.abs(i-e);if(r){var a=e;e=t,t=a,a=i,i=n,n=a}for(var o=Math.abs(i-e),l=Math.abs(n-t),s=-o/2,u=e<i?1:-1,c=t<n?1:-1,f=0,d=i+u,g=e,h=t;g!==d;g+=u){var m=r?h:g,p=r?g:h;if(1===f===this.image.get(m,p)){if(2===f)return MathUtils_1.default.distance(g,h,e,t);f++}if((s+=l)>0){if(h===n)break;h+=c,s-=o}}return 2===f?MathUtils_1.default.distance(i+u,n,e,t):NaN},e.prototype.findAlignmentInRegion=function(e,t,i,n){var r=Math.floor(n*e),a=Math.max(0,t-r),o=Math.min(this.image.getWidth()-1,t+r);if(o-a<3*e)throw new NotFoundException_1.default("Alignment top exceeds estimated module size.");var l=Math.max(0,i-r),s=Math.min(this.image.getHeight()-1,i+r);if(s-l<3*e)throw new NotFoundException_1.default("Alignment bottom exceeds estimated module size.");return new AlignmentPatternFinder_1.default(this.image,a,l,o-a,s-l,e,this.resultPointCallback).find()},e}();exports.default=Detector;
//# sourceMappingURL=/sm/9fa525c22e9603a2c1d7581044a535e0de3da42caf0d479836eaba9f8edcc041.map