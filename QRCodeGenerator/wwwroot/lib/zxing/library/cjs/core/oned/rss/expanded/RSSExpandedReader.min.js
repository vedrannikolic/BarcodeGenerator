/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/oned/rss/expanded/RSSExpandedReader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __extends=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},t(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var BarcodeFormat_1=require("../../../BarcodeFormat"),MathUtils_1=require("../../../common/detector/MathUtils"),NotFoundException_1=require("../../../NotFoundException"),Result_1=require("../../../Result"),System_1=require("../../../util/System"),AbstractRSSReader_1=require("../../rss/AbstractRSSReader"),DataCharacter_1=require("../../rss/DataCharacter"),FinderPattern_1=require("../../rss/FinderPattern"),RSSUtils_1=require("../../rss/RSSUtils"),BitArrayBuilder_1=require("./BitArrayBuilder"),AbstractExpandedDecoderComplement_1=require("./decoders/AbstractExpandedDecoderComplement"),ExpandedPair_1=require("./ExpandedPair"),ExpandedRow_1=require("./ExpandedRow"),RSSExpandedReader=function(t){function e(){var r=null!==t&&t.apply(this,arguments)||this;return r.pairs=new Array(e.MAX_PAIRS),r.rows=new Array,r.startEnd=[2],r}return __extends(e,t),e.prototype.decodeRow=function(t,r,n){this.pairs.length=0,this.startFromEven=!1;try{return e.constructResult(this.decodeRow2pairs(t,r))}catch(t){}return this.pairs.length=0,this.startFromEven=!0,e.constructResult(this.decodeRow2pairs(t,r))},e.prototype.reset=function(){this.pairs.length=0,this.rows.length=0},e.prototype.decodeRow2pairs=function(t,e){for(var r,n=!1;!n;)try{this.pairs.push(this.retrieveNextPair(e,this.pairs,t))}catch(t){if(t instanceof NotFoundException_1.default){if(!this.pairs.length)throw new NotFoundException_1.default;n=!0}}if(this.checkChecksum())return this.pairs;if(r=!!this.rows.length,this.storeRow(t,!1),r){var o=this.checkRowsBoolean(!1);if(null!=o)return o;if(null!=(o=this.checkRowsBoolean(!0)))return o}throw new NotFoundException_1.default},e.prototype.checkRowsBoolean=function(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());var e=null;try{e=this.checkRows(new Array,0)}catch(t){console.log(t)}return t&&(this.rows=this.rows.reverse()),e},e.prototype.checkRows=function(t,r){for(var n,o,a=r;a<this.rows.length;a++){var i=this.rows[a];this.pairs.length=0;try{for(var s=(n=void 0,__values(t)),u=s.next();!u.done;u=s.next()){var _=u.value;this.pairs.push(_.getPairs())}}catch(t){n={error:t}}finally{try{u&&!u.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}if(this.pairs.push(i.getPairs()),e.isValidSequence(this.pairs)){if(this.checkChecksum())return this.pairs;var l=new Array(t);l.push(i);try{return this.checkRows(l,a+1)}catch(t){console.log(t)}}}throw new NotFoundException_1.default},e.isValidSequence=function(t){var r,n;try{for(var o=__values(e.FINDER_PATTERN_SEQUENCES),a=o.next();!a.done;a=o.next()){var i=a.value;if(!(t.length>i.length)){for(var s=!0,u=0;u<t.length;u++)if(t[u].getFinderPattern().getValue()!==i[u]){s=!1;break}if(s)return!0}}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e.prototype.storeRow=function(t,r){for(var n=0,o=!1,a=!1;n<this.rows.length;){var i=this.rows[n];if(i.getRowNumber()>t){a=i.isEquivalent(this.pairs);break}o=i.isEquivalent(this.pairs),n++}a||o||e.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new ExpandedRow_1.default(this.pairs,t,r)),this.removePartialRows(this.pairs,this.rows))},e.prototype.removePartialRows=function(t,e){var r,n,o,a,i,s;try{for(var u=__values(e),_=u.next();!_.done;_=u.next()){var l=_.value;if(l.getPairs().length!==t.length){try{for(var d=(o=void 0,__values(l.getPairs())),h=d.next();!h.done;h=d.next()){var f=h.value,E=!1;try{for(var c=(i=void 0,__values(t)),R=c.next();!R.done;R=c.next()){var F=R.value;if(ExpandedPair_1.default.equals(f,F)){E=!0;break}}}catch(t){i={error:t}}finally{try{R&&!R.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}E||!1}}catch(t){o={error:t}}finally{try{h&&!h.done&&(a=d.return)&&a.call(d)}finally{if(o)throw o.error}}}}}catch(t){r={error:t}}finally{try{_&&!_.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}},e.isPartialRow=function(t,e){var r,n,o,a,i,s;try{for(var u=__values(e),_=u.next();!_.done;_=u.next()){var l=_.value,d=!0;try{for(var h=(o=void 0,__values(t)),f=h.next();!f.done;f=h.next()){var E=f.value,c=!1;try{for(var R=(i=void 0,__values(l.getPairs())),F=R.next();!F.done;F=R.next()){var A=F.value;if(E.equals(A)){c=!0;break}}}catch(t){i={error:t}}finally{try{F&&!F.done&&(s=R.return)&&s.call(R)}finally{if(i)throw i.error}}if(!c){d=!1;break}}}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}if(d)return!0}}catch(t){r={error:t}}finally{try{_&&!_.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return!1},e.prototype.getRows=function(){return this.rows},e.constructResult=function(t){var e=BitArrayBuilder_1.default.buildBitArray(t),r=AbstractExpandedDecoderComplement_1.createDecoder(e).parseInformation(),n=t[0].getFinderPattern().getResultPoints(),o=t[t.length-1].getFinderPattern().getResultPoints(),a=[n[0],n[1],o[0],o[1]];return new Result_1.default(r,null,null,a,BarcodeFormat_1.default.RSS_EXPANDED,null)},e.prototype.checkChecksum=function(){var t=this.pairs.get(0),e=t.getLeftChar(),r=t.getRightChar();if(null===r)return!1;for(var n=r.getChecksumPortion(),o=2,a=1;a<this.pairs.size();++a){var i=this.pairs.get(a);n+=i.getLeftChar().getChecksumPortion(),o++;var s=i.getRightChar();null!=s&&(n+=s.getChecksumPortion(),o++)}return 211*(o-4)+(n%=211)===e.getValue()},e.getNextSecondBar=function(t,e){var r;return t.get(e)?(r=t.getNextUnset(e),r=t.getNextSet(r)):(r=t.getNextSet(e),r=t.getNextUnset(r)),r},e.prototype.retrieveNextPair=function(t,r,n){var o,a=r.length%2==0;this.startFromEven&&(a=!a);var i=!0,s=-1;do{this.findNextPair(t,r,s),null===(o=this.parseFoundFinderPattern(t,n,a))?s=e.getNextSecondBar(t,this.startEnd[0]):i=!1}while(i);var u,_=this.decodeDataCharacter(t,o,a,!0);if(!this.isEmptyPair(r)&&r[r.length-1].mustBeLast())throw new NotFoundException_1.default;try{u=this.decodeDataCharacter(t,o,a,!1)}catch(t){u=null,console.log(t)}return new ExpandedPair_1.default(_,u,o,!0)},e.prototype.isEmptyPair=function(t){return 0===t.length},e.prototype.findNextPair=function(t,r,n){var o=this.getDecodeFinderCounters();o[0]=0,o[1]=0,o[2]=0,o[3]=0;var a,i=t.getSize();if(n>=0)a=n;else if(this.isEmptyPair(r))a=0;else{a=r[r.length-1].getFinderPattern().getStartEnd()[1]}var s=r.length%2!=0;this.startFromEven&&(s=!s);for(var u=!1;a<i&&(u=!t.get(a));)a++;for(var _=0,l=a,d=a;d<i;d++)if(t.get(d)!==u)o[_]++;else{if(3===_){if(s&&e.reverseCounters(o),e.isFinderPattern(o))return this.startEnd[0]=l,void(this.startEnd[1]=d);s&&e.reverseCounters(o),l+=o[0]+o[1],o[0]=o[2],o[1]=o[3],o[2]=0,o[3]=0,_--}else _++;o[_]=1,u=!u}throw new NotFoundException_1.default},e.reverseCounters=function(t){for(var e=t.length,r=0;r<e/2;++r){var n=t[r];t[r]=t[e-r-1],t[e-r-1]=n}},e.prototype.parseFoundFinderPattern=function(t,r,n){var o,a,i;if(n){for(var s=this.startEnd[0]-1;s>=0&&!t.get(s);)s--;s++,o=this.startEnd[0]-s,a=s,i=this.startEnd[1]}else a=this.startEnd[0],o=(i=t.getNextUnset(this.startEnd[1]+1))-this.startEnd[1];var u,_=this.getDecodeFinderCounters();System_1.default.arraycopy(_,0,_,1,_.length-1),_[0]=o;try{u=this.parseFinderValue(_,e.FINDER_PATTERNS)}catch(t){return null}return new FinderPattern_1.default(u,[a,i],a,i,r)},e.prototype.decodeDataCharacter=function(t,r,n,o){for(var a=this.getDataCharacterCounters(),i=0;i<a.length;i++)a[i]=0;if(o)e.recordPatternInReverse(t,r.getStartEnd()[0],a);else{e.recordPattern(t,r.getStartEnd()[1],a);for(var s=0,u=a.length-1;s<u;s++,u--){var _=a[s];a[s]=a[u],a[u]=_}}var l=MathUtils_1.default.sum(new Int32Array(a))/17,d=(r.getStartEnd()[1]-r.getStartEnd()[0])/15;if(Math.abs(l-d)/d>.3)throw new NotFoundException_1.default;var h=this.getOddCounts(),f=this.getEvenCounts(),E=this.getOddRoundingErrors(),c=this.getEvenRoundingErrors();for(s=0;s<a.length;s++){var R=1*a[s]/l,F=R+.5;if(F<1){if(R<.3)throw new NotFoundException_1.default;F=1}else if(F>8){if(R>8.7)throw new NotFoundException_1.default;F=8}var A=s/2;0==(1&s)?(h[A]=F,E[A]=R-F):(f[A]=F,c[A]=R-F)}this.adjustOddEvenCounts(17);var p=4*r.getValue()+(n?0:2)+(o?0:1)-1,v=0,N=0;for(s=h.length-1;s>=0;s--){if(e.isNotA1left(r,n,o)){var P=e.WEIGHTS[p][2*s];N+=h[s]*P}v+=h[s]}var g=0;for(s=f.length-1;s>=0;s--)if(e.isNotA1left(r,n,o)){P=e.WEIGHTS[p][2*s+1];g+=f[s]*P}var D=N+g;if(0!=(1&v)||v>13||v<4)throw new NotFoundException_1.default;var w=(13-v)/2,I=e.SYMBOL_WIDEST[w],y=9-I,T=RSSUtils_1.default.getRSSvalue(h,I,!0),x=RSSUtils_1.default.getRSSvalue(f,y,!1),S=T*e.EVEN_TOTAL_SUBSET[w]+x+e.GSUM[w];return new DataCharacter_1.default(S,D)},e.isNotA1left=function(t,e,r){return!(0===t.getValue()&&e&&r)},e.prototype.adjustOddEvenCounts=function(t){var r=MathUtils_1.default.sum(new Int32Array(this.getOddCounts())),n=MathUtils_1.default.sum(new Int32Array(this.getEvenCounts())),o=!1,a=!1;r>13?a=!0:r<4&&(o=!0);var i=!1,s=!1;n>13?s=!0:n<4&&(i=!0);var u=r+n-t,_=1==(1&r),l=0==(1&n);if(1===u)if(_){if(l)throw new NotFoundException_1.default;a=!0}else{if(!l)throw new NotFoundException_1.default;s=!0}else if(-1===u)if(_){if(l)throw new NotFoundException_1.default;o=!0}else{if(!l)throw new NotFoundException_1.default;i=!0}else{if(0!==u)throw new NotFoundException_1.default;if(_){if(!l)throw new NotFoundException_1.default;r<n?(o=!0,s=!0):(a=!0,i=!0)}else if(l)throw new NotFoundException_1.default}if(o){if(a)throw new NotFoundException_1.default;e.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(a&&e.decrement(this.getOddCounts(),this.getOddRoundingErrors()),i){if(s)throw new NotFoundException_1.default;e.increment(this.getEvenCounts(),this.getOddRoundingErrors())}s&&e.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.SYMBOL_WIDEST=[7,5,4,3,1],e.EVEN_TOTAL_SUBSET=[4,20,52,104,204],e.GSUM=[0,348,1388,2948,3988],e.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],e.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],e.FINDER_PAT_A=0,e.FINDER_PAT_B=1,e.FINDER_PAT_C=2,e.FINDER_PAT_D=3,e.FINDER_PAT_E=4,e.FINDER_PAT_F=5,e.FINDER_PATTERN_SEQUENCES=[[e.FINDER_PAT_A,e.FINDER_PAT_A],[e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B],[e.FINDER_PAT_A,e.FINDER_PAT_C,e.FINDER_PAT_B,e.FINDER_PAT_D],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_C],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F]],e.MAX_PAIRS=11,e}(AbstractRSSReader_1.default);exports.default=RSSExpandedReader;
//# sourceMappingURL=/sm/6b126a7abcf7ab5fc6324360bd7240f2cc35580f461de4e6f54d34de2e02945d.map