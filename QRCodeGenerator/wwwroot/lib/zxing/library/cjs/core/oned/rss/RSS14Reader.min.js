/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/cjs/core/oned/rss/RSS14Reader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __extends=this&&this.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(exports,"__esModule",{value:!0});var AbstractRSSReader_1=require("./AbstractRSSReader"),Pair_1=require("./Pair"),Result_1=require("../../Result"),DecodeHintType_1=require("../../DecodeHintType"),NotFoundException_1=require("../../NotFoundException"),StringBuilder_1=require("../../util/StringBuilder"),BarcodeFormat_1=require("../../BarcodeFormat"),ResultPoint_1=require("../../ResultPoint"),FinderPattern_1=require("./FinderPattern"),DataCharacter_1=require("./DataCharacter"),MathUtils_1=require("../../common/detector/MathUtils"),RSSUtils_1=require("./RSSUtils"),System_1=require("../../util/System"),OneDReader_1=require("../OneDReader"),RSS14Reader=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.possibleLeftPairs=[],t.possibleRightPairs=[],t}return __extends(t,e),t.prototype.decodeRow=function(e,r,n){var a,o,i,u,d=this.decodePair(r,!1,e,n);t.addOrTally(this.possibleLeftPairs,d),r.reverse();var l=this.decodePair(r,!0,e,n);t.addOrTally(this.possibleRightPairs,l),r.reverse();try{for(var s=__values(this.possibleLeftPairs),f=s.next();!f.done;f=s.next()){var c=f.value;if(c.getCount()>1)try{for(var _=(i=void 0,__values(this.possibleRightPairs)),h=_.next();!h.done;h=_.next()){var S=h.value;if(S.getCount()>1&&t.checkChecksum(c,S))return t.constructResult(c,S)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(u=_.return)&&u.call(_)}finally{if(i)throw i.error}}}}catch(e){a={error:e}}finally{try{f&&!f.done&&(o=s.return)&&o.call(s)}finally{if(a)throw a.error}}throw new NotFoundException_1.default},t.addOrTally=function(e,t){var r,n;if(null!=t){var a=!1;try{for(var o=__values(e),i=o.next();!i.done;i=o.next()){var u=i.value;if(u.getValue()===t.getValue()){u.incrementCount(),a=!0;break}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}a||e.push(t)}},t.prototype.reset=function(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0},t.constructResult=function(e,t){for(var r=4537077*e.getValue()+t.getValue(),n=new String(r).toString(),a=new StringBuilder_1.default,o=13-n.length;o>0;o--)a.append("0");a.append(n);var i=0;for(o=0;o<13;o++){var u=a.charAt(o).charCodeAt(0)-"0".charCodeAt(0);i+=0==(1&o)?3*u:u}10===(i=10-i%10)&&(i=0),a.append(i.toString());var d=e.getFinderPattern().getResultPoints(),l=t.getFinderPattern().getResultPoints();return new Result_1.default(a.toString(),null,0,[d[0],d[1],l[0],l[1]],BarcodeFormat_1.default.RSS_14,(new Date).getTime())},t.checkChecksum=function(e,t){var r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,n=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n},t.prototype.decodePair=function(e,t,r,n){try{var a=this.findFinderPattern(e,t),o=this.parseFoundFinderPattern(e,r,t,a),i=null==n?null:n.get(DecodeHintType_1.default.NEED_RESULT_POINT_CALLBACK);if(null!=i){var u=(a[0]+a[1])/2;t&&(u=e.getSize()-1-u),i.foundPossibleResultPoint(new ResultPoint_1.default(u,r))}var d=this.decodeDataCharacter(e,o,!0),l=this.decodeDataCharacter(e,o,!1);return new Pair_1.default(1597*d.getValue()+l.getValue(),d.getChecksumPortion()+4*l.getChecksumPortion(),o)}catch(e){return null}},t.prototype.decodeDataCharacter=function(e,r,n){for(var a=this.getDataCharacterCounters(),o=0;o<a.length;o++)a[o]=0;if(n)OneDReader_1.default.recordPatternInReverse(e,r.getStartEnd()[0],a);else{OneDReader_1.default.recordPattern(e,r.getStartEnd()[1]+1,a);for(var i=0,u=a.length-1;i<u;i++,u--){var d=a[i];a[i]=a[u],a[u]=d}}var l=n?16:15,s=MathUtils_1.default.sum(new Int32Array(a))/l,f=this.getOddCounts(),c=this.getEvenCounts(),_=this.getOddRoundingErrors(),h=this.getEvenRoundingErrors();for(i=0;i<a.length;i++){var S=a[i]/s,g=Math.floor(S+.5);g<1?g=1:g>8&&(g=8);var v=Math.floor(i/2);0==(1&i)?(f[v]=g,_[v]=S-g):(c[v]=g,h[v]=S-g)}this.adjustOddEvenCounts(n,l);var p=0,E=0;for(i=f.length-1;i>=0;i--)E*=9,E+=f[i],p+=f[i];var R=0,y=0;for(i=c.length-1;i>=0;i--)R*=9,R+=c[i],y+=c[i];var D=E+3*R;if(n){if(0!=(1&p)||p>12||p<4)throw new NotFoundException_1.default;var w=(12-p)/2,P=9-(T=t.OUTSIDE_ODD_WIDEST[w]),O=RSSUtils_1.default.getRSSvalue(f,T,!1),I=RSSUtils_1.default.getRSSvalue(c,P,!0),F=t.OUTSIDE_EVEN_TOTAL_SUBSET[w],m=t.OUTSIDE_GSUM[w];return new DataCharacter_1.default(O*F+I+m,D)}if(0!=(1&y)||y>10||y<4)throw new NotFoundException_1.default;w=(10-y)/2,P=9-(T=t.INSIDE_ODD_WIDEST[w]),O=RSSUtils_1.default.getRSSvalue(f,T,!0),I=RSSUtils_1.default.getRSSvalue(c,P,!1);var T,C=t.INSIDE_ODD_TOTAL_SUBSET[w];m=t.INSIDE_GSUM[w];return new DataCharacter_1.default(I*C+O+m,D)},t.prototype.findFinderPattern=function(e,t){var r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;for(var n=e.getSize(),a=!1,o=0;o<n&&t!==(a=!e.get(o));)o++;for(var i=0,u=o,d=o;d<n;d++)if(e.get(d)!==a)r[i]++;else{if(3===i){if(AbstractRSSReader_1.default.isFinderPattern(r))return[u,d];u+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,i--}else i++;r[i]=1,a=!a}throw new NotFoundException_1.default},t.prototype.parseFoundFinderPattern=function(e,r,n,a){for(var o=e.get(a[0]),i=a[0]-1;i>=0&&o!==e.get(i);)i--;i++;var u=a[0]-i,d=this.getDecodeFinderCounters(),l=new Int32Array(d.length);System_1.default.arraycopy(d,0,l,1,d.length-1),l[0]=u;var s=this.parseFinderValue(l,t.FINDER_PATTERNS),f=i,c=a[1];return n&&(f=e.getSize()-1-f,c=e.getSize()-1-c),new FinderPattern_1.default(s,[i,a[1]],f,c,r)},t.prototype.adjustOddEvenCounts=function(e,t){var r=MathUtils_1.default.sum(new Int32Array(this.getOddCounts())),n=MathUtils_1.default.sum(new Int32Array(this.getEvenCounts())),a=!1,o=!1,i=!1,u=!1;e?(r>12?o=!0:r<4&&(a=!0),n>12?u=!0:n<4&&(i=!0)):(r>11?o=!0:r<5&&(a=!0),n>10?u=!0:n<4&&(i=!0));var d=r+n-t,l=(1&r)==(e?1:0),s=1==(1&n);if(1===d)if(l){if(s)throw new NotFoundException_1.default;o=!0}else{if(!s)throw new NotFoundException_1.default;u=!0}else if(-1===d)if(l){if(s)throw new NotFoundException_1.default;a=!0}else{if(!s)throw new NotFoundException_1.default;i=!0}else{if(0!==d)throw new NotFoundException_1.default;if(l){if(!s)throw new NotFoundException_1.default;r<n?(a=!0,u=!0):(o=!0,i=!0)}else if(s)throw new NotFoundException_1.default}if(a){if(o)throw new NotFoundException_1.default;AbstractRSSReader_1.default.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(o&&AbstractRSSReader_1.default.decrement(this.getOddCounts(),this.getOddRoundingErrors()),i){if(u)throw new NotFoundException_1.default;AbstractRSSReader_1.default.increment(this.getEvenCounts(),this.getOddRoundingErrors())}u&&AbstractRSSReader_1.default.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},t.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],t.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],t.OUTSIDE_GSUM=[0,161,961,2015,2715],t.INSIDE_GSUM=[0,336,1036,1516],t.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],t.INSIDE_ODD_WIDEST=[2,4,6,8],t.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])],t}(AbstractRSSReader_1.default);exports.default=RSS14Reader;
//# sourceMappingURL=/sm/2d8ec55d63b36687a2e915146b53791e97e02c700b1f31b4b20424f3749a35da.map