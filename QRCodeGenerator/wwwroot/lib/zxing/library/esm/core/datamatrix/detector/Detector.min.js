/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/datamatrix/detector/Detector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import WhiteRectangleDetector from"../../common/detector/WhiteRectangleDetector";import DetectorResult from"../../common/DetectorResult";import GridSamplerInstance from"../../common/GridSamplerInstance";import NotFoundException from"../../NotFoundException";import ResultPoint from"../../ResultPoint";var Detector=function(){function t(t){this.image=t,this.rectangleDetector=new WhiteRectangleDetector(this.image)}return t.prototype.detect=function(){var e=this.rectangleDetector.detect(),i=this.detectSolid1(e);if((i=this.detectSolid2(i))[3]=this.correctTopRight(i),!i[3])throw new NotFoundException;var n=(i=this.shiftToModuleCenter(i))[0],o=i[1],s=i[2],r=i[3],a=this.transitionsBetween(n,r)+1,h=this.transitionsBetween(s,r)+1;1==(1&a)&&(a+=1),1==(1&h)&&(h+=1),4*a<7*h&&4*h<7*a&&(a=h=Math.max(a,h));var g=t.sampleGrid(this.image,n,o,s,r,a,h);return new DetectorResult(g,[n,o,s,r])},t.shiftPoint=function(t,e,i){var n=(e.getX()-t.getX())/(i+1),o=(e.getY()-t.getY())/(i+1);return new ResultPoint(t.getX()+n,t.getY()+o)},t.moveAway=function(t,e,i){var n=t.getX(),o=t.getY();return n<e?n-=1:n+=1,o<i?o-=1:o+=1,new ResultPoint(n,o)},t.prototype.detectSolid1=function(t){var e=t[0],i=t[1],n=t[3],o=t[2],s=this.transitionsBetween(e,i),r=this.transitionsBetween(i,n),a=this.transitionsBetween(n,o),h=this.transitionsBetween(o,e),g=s,c=[o,e,i,n];return g>r&&(g=r,c[0]=e,c[1]=i,c[2]=n,c[3]=o),g>a&&(g=a,c[0]=i,c[1]=n,c[2]=o,c[3]=e),g>h&&(c[0]=n,c[1]=o,c[2]=e,c[3]=i),c},t.prototype.detectSolid2=function(e){var i=e[0],n=e[1],o=e[2],s=e[3],r=this.transitionsBetween(i,s),a=t.shiftPoint(n,o,4*(r+1)),h=t.shiftPoint(o,n,4*(r+1));return this.transitionsBetween(a,i)<this.transitionsBetween(h,s)?(e[0]=i,e[1]=n,e[2]=o,e[3]=s):(e[0]=n,e[1]=o,e[2]=s,e[3]=i),e},t.prototype.correctTopRight=function(e){var i=e[0],n=e[1],o=e[2],s=e[3],r=this.transitionsBetween(i,s),a=this.transitionsBetween(n,s),h=t.shiftPoint(i,n,4*(a+1)),g=t.shiftPoint(o,n,4*(r+1));r=this.transitionsBetween(h,s),a=this.transitionsBetween(g,s);var c=new ResultPoint(s.getX()+(o.getX()-n.getX())/(r+1),s.getY()+(o.getY()-n.getY())/(r+1)),u=new ResultPoint(s.getX()+(i.getX()-n.getX())/(a+1),s.getY()+(i.getY()-n.getY())/(a+1));return this.isValid(c)?this.isValid(u)?this.transitionsBetween(h,c)+this.transitionsBetween(g,c)>this.transitionsBetween(h,u)+this.transitionsBetween(g,u)?c:u:c:this.isValid(u)?u:null},t.prototype.shiftToModuleCenter=function(e){var i=e[0],n=e[1],o=e[2],s=e[3],r=this.transitionsBetween(i,s)+1,a=this.transitionsBetween(o,s)+1,h=t.shiftPoint(i,n,4*a),g=t.shiftPoint(o,n,4*r);1==(1&(r=this.transitionsBetween(h,s)+1))&&(r+=1),1==(1&(a=this.transitionsBetween(g,s)+1))&&(a+=1);var c,u,f=(i.getX()+n.getX()+o.getX()+s.getX())/4,m=(i.getY()+n.getY()+o.getY()+s.getY())/4;return i=t.moveAway(i,f,m),n=t.moveAway(n,f,m),o=t.moveAway(o,f,m),s=t.moveAway(s,f,m),h=t.shiftPoint(i,n,4*a),h=t.shiftPoint(h,s,4*r),c=t.shiftPoint(n,i,4*a),c=t.shiftPoint(c,o,4*r),g=t.shiftPoint(o,s,4*a),g=t.shiftPoint(g,n,4*r),u=t.shiftPoint(s,o,4*a),[h,c,g,u=t.shiftPoint(u,i,4*r)]},t.prototype.isValid=function(t){return t.getX()>=0&&t.getX()<this.image.getWidth()&&t.getY()>0&&t.getY()<this.image.getHeight()},t.sampleGrid=function(t,e,i,n,o,s,r){return GridSamplerInstance.getInstance().sampleGrid(t,s,r,.5,.5,s-.5,.5,s-.5,r-.5,.5,r-.5,e.getX(),e.getY(),o.getX(),o.getY(),n.getX(),n.getY(),i.getX(),i.getY())},t.prototype.transitionsBetween=function(t,e){var i=Math.trunc(t.getX()),n=Math.trunc(t.getY()),o=Math.trunc(e.getX()),s=Math.trunc(e.getY()),r=Math.abs(s-n)>Math.abs(o-i);if(r){var a=i;i=n,n=a,a=o,o=s,s=a}for(var h=Math.abs(o-i),g=Math.abs(s-n),c=-h/2,u=n<s?1:-1,f=i<o?1:-1,m=0,w=this.image.get(r?n:i,r?i:n),l=i,p=n;l!==o;l+=f){var d=this.image.get(r?p:l,r?l:p);if(d!==w&&(m++,w=d),(c+=g)>0){if(p===s)break;p+=u,c-=h}}return m},t}();export default Detector;
//# sourceMappingURL=/sm/053481eebe7cd295bbd37d02afdb764d39d04b19d493e1b0bc0c31f57f16fa51.map