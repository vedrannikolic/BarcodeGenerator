/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/datamatrix/encoder/C40Encoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import StringBuilder from"../../util/StringBuilder";import HighLevelEncoder from"./HighLevelEncoder";import{C40_ENCODATION,LATCH_TO_C40,ASCII_ENCODATION,C40_UNLATCH}from"./constants";var C40Encoder=function(){function e(){}return e.prototype.getEncodingMode=function(){return C40_ENCODATION},e.prototype.encodeMaximal=function(e){for(var r=new StringBuilder,t=0,o=e.pos,n=0;e.hasMoreCharacters();){var a=e.getCurrentChar();e.pos++,t=this.encodeChar(a,r),r.length()%3==0&&(o=e.pos,n=r.length())}if(n!==r.length()){var d=Math.floor(r.length()/3*2),i=Math.floor(e.getCodewordCount()+d+1);e.updateSymbolInfo(i);var h=e.getSymbolInfo().getDataCapacity()-i,p=Math.floor(r.length()%3);(2===p&&2!==h||1===p&&(t>3||1!==h))&&(e.pos=o)}r.length()>0&&e.writeCodeword(LATCH_TO_C40),this.handleEOD(e,r)},e.prototype.encode=function(e){for(var r=new StringBuilder;e.hasMoreCharacters();){var t=e.getCurrentChar();e.pos++;var o=this.encodeChar(t,r),n=2*Math.floor(r.length()/3),a=e.getCodewordCount()+n;e.updateSymbolInfo(a);var d=e.getSymbolInfo().getDataCapacity()-a;if(!e.hasMoreCharacters()){var i=new StringBuilder;for(r.length()%3==2&&2!==d&&(o=this.backtrackOneCharacter(e,r,i,o));r.length()%3==1&&(o>3||1!==d);)o=this.backtrackOneCharacter(e,r,i,o);break}if(r.length()%3==0)if(HighLevelEncoder.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode())!==this.getEncodingMode()){e.signalEncoderChange(ASCII_ENCODATION);break}}this.handleEOD(e,r)},e.prototype.backtrackOneCharacter=function(e,r,t,o){var n=r.length(),a=r.toString().substring(0,n-o);r.setLengthToZero(),r.append(a),e.pos--;var d=e.getCurrentChar();return o=this.encodeChar(d,t),e.resetSymbolInfo(),o},e.prototype.writeNextTriplet=function(e,r){e.writeCodewords(this.encodeToCodewords(r.toString()));var t=r.toString().substring(3);r.setLengthToZero(),r.append(t)},e.prototype.handleEOD=function(e,r){var t=Math.floor(r.length()/3*2),o=r.length()%3,n=e.getCodewordCount()+t;e.updateSymbolInfo(n);var a=e.getSymbolInfo().getDataCapacity()-n;if(2===o){for(r.append("\0");r.length()>=3;)this.writeNextTriplet(e,r);e.hasMoreCharacters()&&e.writeCodeword(C40_UNLATCH)}else if(1===a&&1===o){for(;r.length()>=3;)this.writeNextTriplet(e,r);e.hasMoreCharacters()&&e.writeCodeword(C40_UNLATCH),e.pos--}else{if(0!==o)throw new Error("Unexpected case. Please report!");for(;r.length()>=3;)this.writeNextTriplet(e,r);(a>0||e.hasMoreCharacters())&&e.writeCodeword(C40_UNLATCH)}e.signalEncoderChange(ASCII_ENCODATION)},e.prototype.encodeChar=function(e,r){if(e===" ".charCodeAt(0))return r.append(3),1;if(e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return r.append(e-48+4),1;if(e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0))return r.append(e-65+14),1;if(e<" ".charCodeAt(0))return r.append(0),r.append(e),2;if(e<="/".charCodeAt(0))return r.append(1),r.append(e-33),2;if(e<="@".charCodeAt(0))return r.append(1),r.append(e-58+15),2;if(e<="_".charCodeAt(0))return r.append(1),r.append(e-91+22),2;if(e<=127)return r.append(2),r.append(e-96),2;r.append("1");var t=2;return t+=this.encodeChar(e-128,r)},e.prototype.encodeToCodewords=function(e){var r=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,t=r/256,o=r%256,n=new StringBuilder;return n.append(t),n.append(o),n.toString()},e}();export{C40Encoder};
//# sourceMappingURL=/sm/2f9b03318b916cd8ba1cc7ddf146feac67cb7f400598e20d5b5b05dd5c97eaa3.map