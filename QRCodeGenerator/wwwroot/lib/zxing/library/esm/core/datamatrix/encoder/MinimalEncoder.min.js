/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/datamatrix/encoder/MinimalEncoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var Mode,__extends=this&&this.__extends||function(){var e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},e(t,i)};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),__values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=this&&this.__read||function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,n,o=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){n={error:e}}finally{try{r&&!r.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return s},__spread=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e};import{MACRO_05_HEADER,MACRO_06_HEADER,MACRO_TRAILER}from"./constants";import HighLevelEncoder from"./HighLevelEncoder";import{MinimalECIInput}from"../../common/MinimalECIInput";import Integer from"../../util/Integer";!function(e){e[e.ASCII=0]="ASCII",e[e.C40=1]="C40",e[e.TEXT=2]="TEXT",e[e.X12=3]="X12",e[e.EDF=4]="EDF",e[e.B256=5]="B256"}(Mode||(Mode={}));var C40_SHIFT2_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],MinimalEncoder=function(){function e(){}return e.isExtendedASCII=function(e,t){return e!==t&&e>=128&&e<=255},e.isInC40Shift1Set=function(e){return e<=31},e.isInC40Shift2Set=function(e,t){var i,r;try{for(var n=__values(C40_SHIFT2_CHARS),o=n.next();!o.done;o=n.next()){if(o.value.charCodeAt(0)===e)return!0}}catch(e){i={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return e===t},e.isInTextShift1Set=function(e){return this.isInC40Shift1Set(e)},e.isInTextShift2Set=function(e,t){return this.isInC40Shift2Set(e,t)},e.encodeHighLevel=function(e,t,i,r){void 0===t&&(t=null),void 0===i&&(i=-1),void 0===r&&(r=0);var n=0;return e.startsWith(MACRO_05_HEADER)&&e.endsWith(MACRO_TRAILER)?(n=5,e=e.substring(MACRO_05_HEADER.length,e.length-2)):e.startsWith(MACRO_06_HEADER)&&e.endsWith(MACRO_TRAILER)&&(n=6,e=e.substring(MACRO_06_HEADER.length,e.length-2)),decodeURIComponent(escape(String.fromCharCode.apply(String,__spread(this.encode(e,t,i,r,n)))))},e.encode=function(e,t,i,r,n){return this.encodeMinimally(new Input(e,t,i,r,n)).getBytes()},e.addEdge=function(e,t){var i=t.fromPosition+t.characterLength;(null===e[i][t.getEndMode()]||e[i][t.getEndMode()].cachedTotalSize>t.cachedTotalSize)&&(e[i][t.getEndMode()]=t)},e.getNumberOfC40Words=function(t,i,r,n){for(var o=0,s=i;s<t.length();s++){if(t.isECI(s))return n[0]=0,0;var a=t.charAt(s);if(r&&HighLevelEncoder.isNativeC40(a)||!r&&HighLevelEncoder.isNativeText(a))o++;else if(e.isExtendedASCII(a,t.getFNC1Character())){var h=255&a;h>=128&&(r&&HighLevelEncoder.isNativeC40(h-128)||!r&&HighLevelEncoder.isNativeText(h-128))?o+=3:o+=4}else o+=2;if(o%3==0||(o-2)%3==0&&s+1===t.length())return n[0]=s-i+1,Math.ceil(o/3)}return n[0]=0,0},e.addEdges=function(t,i,r,n){var o,s;if(t.isECI(r))this.addEdge(i,new Edge(t,Mode.ASCII,r,1,n));else{var a,h=t.charAt(r);if(null===n||n.getEndMode()!==Mode.EDF){HighLevelEncoder.isDigit(h)&&t.haveNCharacters(r,2)&&HighLevelEncoder.isDigit(t.charAt(r+1))?this.addEdge(i,new Edge(t,Mode.ASCII,r,2,n)):this.addEdge(i,new Edge(t,Mode.ASCII,r,1,n));var d=[Mode.C40,Mode.TEXT];try{for(var c=__values(d),u=c.next();!u.done;u=c.next()){var l=u.value,g=[];e.getNumberOfC40Words(t,r,l===Mode.C40,g)>0&&this.addEdge(i,new Edge(t,l,r,g[0],n))}}catch(e){o={error:e}}finally{try{u&&!u.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}t.haveNCharacters(r,3)&&HighLevelEncoder.isNativeX12(t.charAt(r))&&HighLevelEncoder.isNativeX12(t.charAt(r+1))&&HighLevelEncoder.isNativeX12(t.charAt(r+2))&&this.addEdge(i,new Edge(t,Mode.X12,r,3,n)),this.addEdge(i,new Edge(t,Mode.B256,r,1,n))}for(a=0;a<3;a++){var f=r+a;if(!t.haveNCharacters(f,1)||!HighLevelEncoder.isNativeEDIFACT(t.charAt(f)))break;this.addEdge(i,new Edge(t,Mode.EDF,r,a+1,n))}3===a&&t.haveNCharacters(r,4)&&HighLevelEncoder.isNativeEDIFACT(t.charAt(r+3))&&this.addEdge(i,new Edge(t,Mode.EDF,r,4,n))}},e.encodeMinimally=function(e){var t=e.length(),i=Array(t+1).fill(null).map((function(){return Array(6).fill(0)}));this.addEdges(e,i,0,null);for(var r=1;r<=t;r++){for(var n=0;n<6;n++)null!==i[r][n]&&r<t&&this.addEdges(e,i,r,i[r][n]);for(n=0;n<6;n++)i[r-1][n]=null}var o=-1,s=Integer.MAX_VALUE;for(n=0;n<6;n++)if(null!==i[t][n]){var a=i[t][n],h=n>=1&&n<=3?a.cachedTotalSize+1:a.cachedTotalSize;h<s&&(s=h,o=n)}if(o<0)throw new Error('Failed to encode "'+e+'"');return new Result(i[t][o])},e}();export{MinimalEncoder};var Result=function(){function e(e){var t=e.input,i=0,r=[],n=[],o=[];e.mode!==Mode.C40&&e.mode!==Mode.TEXT&&e.mode!==Mode.X12||e.getEndMode()===Mode.ASCII||(i+=this.prepend(Edge.getBytes(254),r));for(var s=e;null!==s;)i+=this.prepend(s.getDataBytes(),r),null!==s.previous&&s.getPreviousStartMode()===s.getMode()||(s.getMode()===Mode.B256&&(i<=249?(r.unshift(i),i++):(r.unshift(i%250),r.unshift(i/250+249),i+=2),n.push(r.length),o.push(i)),this.prepend(s.getLatchBytes(),r),i=0),s=s.previous;5===t.getMacroId()?i+=this.prepend(Edge.getBytes(236),r):6===t.getMacroId()&&(i+=this.prepend(Edge.getBytes(237),r)),t.getFNC1Character()>0&&(i+=this.prepend(Edge.getBytes(232),r));for(var a=0;a<n.length;a++)this.applyRandomPattern(r,r.length-n[a],o[a]);var h=e.getMinSymbolSize(r.length);for(r.length<h&&r.push(129);r.length<h;)r.push(this.randomize253State(r.length+1));this.bytes=new Uint8Array(r.length);for(a=0;a<this.bytes.length;a++)this.bytes[a]=r[a]}return e.prototype.prepend=function(e,t){for(var i=e.length-1;i>=0;i--)t.unshift(e[i]);return e.length},e.prototype.randomize253State=function(e){var t=129+(149*e%253+1);return t<=254?t:t-254},e.prototype.applyRandomPattern=function(e,t,i){for(var r=0;r<i;r++){var n=t+r,o=(255&e[n])+(149*(n+1)%255+1);e[n]=o<=255?o:o-256}},e.prototype.getBytes=function(){return this.bytes},e}(),Edge=function(){function e(e,t,i,r,n){if(this.input=e,this.mode=t,this.fromPosition=i,this.characterLength=r,this.previous=n,this.allCodewordCapacities=[3,5,8,10,12,16,18,22,30,32,36,44,49,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.squareCodewordCapacities=[3,5,8,12,18,22,30,36,44,62,86,114,144,174,204,280,368,456,576,696,816,1050,1304,1558],this.rectangularCodewordCapacities=[5,10,16,33,32,49],!(i+r<=e.length()))throw new Error("Invalid edge");var o=null!==n?n.cachedTotalSize:0,s=this.getPreviousMode();switch(t){case Mode.ASCII:o++,(e.isECI(i)||MinimalEncoder.isExtendedASCII(e.charAt(i),e.getFNC1Character()))&&o++,s!==Mode.C40&&s!==Mode.TEXT&&s!==Mode.X12||o++;break;case Mode.B256:o++,(s!==Mode.B256||250===this.getB256Size())&&o++,s===Mode.ASCII?o++:s!==Mode.C40&&s!==Mode.TEXT&&s!==Mode.X12||(o+=2);break;case Mode.C40:case Mode.TEXT:case Mode.X12:if(t===Mode.X12)o+=2;else{o+=2*MinimalEncoder.getNumberOfC40Words(e,i,t===Mode.C40,[])}s===Mode.ASCII||s===Mode.B256?o++:s===t||s!==Mode.C40&&s!==Mode.TEXT&&s!==Mode.X12||(o+=2);break;case Mode.EDF:o+=3,s===Mode.ASCII||s===Mode.B256?o++:s!==Mode.C40&&s!==Mode.TEXT&&s!==Mode.X12||(o+=2)}this.cachedTotalSize=o}return e.prototype.getB256Size=function(){for(var e=0,t=this;null!==t&&t.mode===Mode.B256&&e<=250;)e++,t=t.previous;return e},e.prototype.getPreviousStartMode=function(){return null===this.previous?Mode.ASCII:this.previous.mode},e.prototype.getPreviousMode=function(){return null===this.previous?Mode.ASCII:this.previous.getEndMode()},e.prototype.getEndMode=function(){if(this.mode===Mode.EDF){if(this.characterLength<4)return Mode.ASCII;if((e=this.getLastASCII())>0&&this.getCodewordsRemaining(this.cachedTotalSize+e)<=2-e)return Mode.ASCII}if(this.mode===Mode.C40||this.mode===Mode.TEXT||this.mode===Mode.X12){if(this.fromPosition+this.characterLength>=this.input.length()&&0===this.getCodewordsRemaining(this.cachedTotalSize))return Mode.ASCII;var e;if(1===(e=this.getLastASCII())&&0===this.getCodewordsRemaining(this.cachedTotalSize+1))return Mode.ASCII}return this.mode},e.prototype.getMode=function(){return this.mode},e.prototype.getLastASCII=function(){var e=this.input.length(),t=this.fromPosition+this.characterLength;return e-t>4||t>=e?0:e-t==1?MinimalEncoder.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())?0:1:e-t==2?MinimalEncoder.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())||MinimalEncoder.isExtendedASCII(this.input.charAt(t+1),this.input.getFNC1Character())?0:HighLevelEncoder.isDigit(this.input.charAt(t))&&HighLevelEncoder.isDigit(this.input.charAt(t+1))?1:2:e-t==3?HighLevelEncoder.isDigit(this.input.charAt(t))&&HighLevelEncoder.isDigit(this.input.charAt(t+1))&&!MinimalEncoder.isExtendedASCII(this.input.charAt(t+2),this.input.getFNC1Character())||HighLevelEncoder.isDigit(this.input.charAt(t+1))&&HighLevelEncoder.isDigit(this.input.charAt(t+2))&&!MinimalEncoder.isExtendedASCII(this.input.charAt(t),this.input.getFNC1Character())?2:0:HighLevelEncoder.isDigit(this.input.charAt(t))&&HighLevelEncoder.isDigit(this.input.charAt(t+1))&&HighLevelEncoder.isDigit(this.input.charAt(t+2))&&HighLevelEncoder.isDigit(this.input.charAt(t+3))?2:0},e.prototype.getMinSymbolSize=function(e){var t,i,r,n,o,s;switch(this.input.getShapeHint()){case 1:try{for(var a=__values(this.squareCodewordCapacities),h=a.next();!h.done;h=a.next()){if((g=h.value)>=e)return g}}catch(e){t={error:e}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(t)throw t.error}}break;case 2:try{for(var d=__values(this.rectangularCodewordCapacities),c=d.next();!c.done;c=d.next()){if((g=c.value)>=e)return g}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}}try{for(var u=__values(this.allCodewordCapacities),l=u.next();!l.done;l=u.next()){var g;if((g=l.value)>=e)return g}}catch(e){o={error:e}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(o)throw o.error}}return this.allCodewordCapacities[this.allCodewordCapacities.length-1]},e.prototype.getCodewordsRemaining=function(e){return this.getMinSymbolSize(e)-e},e.getBytes=function(e,t){var i=new Uint8Array(t?2:1);return i[0]=e,t&&(i[1]=t),i},e.prototype.setC40Word=function(e,t,i,r,n){var o=1600*(255&i)+40*(255&r)+(255&n)+1;e[t]=o/256,e[t+1]=o%256},e.prototype.getX12Value=function(e){return 13===e?0:42===e?1:62===e?2:32===e?3:e>=48&&e<=57?e-44:e>=65&&e<=90?e-51:e},e.prototype.getX12Words=function(){if(this.characterLength%3!=0)throw new Error("X12 words must be a multiple of 3");for(var e=new Uint8Array(this.characterLength/3*2),t=0;t<e.length;t+=2)this.setC40Word(e,t,this.getX12Value(this.input.charAt(this.fromPosition+t/2*3)),this.getX12Value(this.input.charAt(this.fromPosition+t/2*3+1)),this.getX12Value(this.input.charAt(this.fromPosition+t/2*3+2)));return e},e.prototype.getShiftValue=function(e,t,i){return t&&MinimalEncoder.isInC40Shift1Set(e)||!t&&MinimalEncoder.isInTextShift1Set(e)?0:t&&MinimalEncoder.isInC40Shift2Set(e,i)||!t&&MinimalEncoder.isInTextShift2Set(e,i)?1:2},e.prototype.getC40Value=function(e,t,i,r){if(i===r){if(2!==t)throw new Error("FNC1 cannot be used in C40 shift 2");return 27}return e?i<=31?i:32===i?3:i<=47?i-33:i<=57?i-44:i<=64?i-43:i<=90?i-51:i<=95?i-69:i<=127?i-96:i:0===i?0:0===t&&i<=3?i-1:1===t&&i<=31?i:32===i?3:i>=33&&i<=47?i-33:i>=48&&i<=57?i-44:i>=58&&i<=64?i-43:i>=65&&i<=90?i-64:i>=91&&i<=95?i-69:96===i?0:i>=97&&i<=122?i-83:i>=123&&i<=127?i-96:i},e.prototype.getC40Words=function(e,t){for(var i=[],r=0;r<this.characterLength;r++){var n=this.input.charAt(this.fromPosition+r);if(e&&HighLevelEncoder.isNativeC40(n)||!e&&HighLevelEncoder.isNativeText(n))i.push(this.getC40Value(e,0,n,t));else if(MinimalEncoder.isExtendedASCII(n,t)){var o=(255&n)-128;if(e&&HighLevelEncoder.isNativeC40(o)||!e&&HighLevelEncoder.isNativeText(o))i.push(1),i.push(30),i.push(this.getC40Value(e,0,o,t));else{i.push(1),i.push(30);s=this.getShiftValue(o,e,t);i.push(s),i.push(this.getC40Value(e,s,o,t))}}else{var s=this.getShiftValue(n,e,t);i.push(s),i.push(this.getC40Value(e,s,n,t))}}if(i.length%3!=0){if((i.length-2)%3!=0||this.fromPosition+this.characterLength!==this.input.length())throw new Error("C40 words must be a multiple of 3");i.push(0)}var a=new Uint8Array(i.length/3*2),h=0;for(r=0;r<i.length;r+=3)this.setC40Word(a,h,255&i[r],255&i[r+1],255&i[r+2]),h+=2;return a},e.prototype.getEDFBytes=function(){for(var e=Math.ceil(this.characterLength/4),t=new Uint8Array(3*e),i=this.fromPosition,r=Math.min(this.fromPosition+this.characterLength-1,this.input.length()-1),n=0;n<e;n+=3){for(var o=[],s=0;s<4;s++)o[s]=i<=r?63&this.input.charAt(i++):i===r+1?31:0;var a=o[0]<<18;a|=o[1]<<12,a|=o[2]<<6,a|=o[3],t[n]=a>>16&255,t[n+1]=a>>8&255,t[n+2]=255&a}return t},e.prototype.getLatchBytes=function(){switch(this.getPreviousMode()){case Mode.ASCII:case Mode.B256:switch(this.mode){case Mode.B256:return e.getBytes(231);case Mode.C40:return e.getBytes(230);case Mode.TEXT:return e.getBytes(239);case Mode.X12:return e.getBytes(238);case Mode.EDF:return e.getBytes(240)}break;case Mode.C40:case Mode.TEXT:case Mode.X12:if(this.mode!==this.getPreviousMode())switch(this.mode){case Mode.ASCII:return e.getBytes(254);case Mode.B256:return e.getBytes(254,231);case Mode.C40:return e.getBytes(254,230);case Mode.TEXT:return e.getBytes(254,239);case Mode.X12:return e.getBytes(254,238);case Mode.EDF:return e.getBytes(254,240)}break;case Mode.EDF:if(this.mode!==Mode.EDF)throw new Error("Cannot switch from EDF to "+this.mode)}return new Uint8Array(0)},e.prototype.getDataBytes=function(){switch(this.mode){case Mode.ASCII:return this.input.isECI(this.fromPosition)?e.getBytes(241,this.input.getECIValue(this.fromPosition)+1):MinimalEncoder.isExtendedASCII(this.input.charAt(this.fromPosition),this.input.getFNC1Character())?e.getBytes(235,this.input.charAt(this.fromPosition)-127):2===this.characterLength?e.getBytes(10*this.input.charAt(this.fromPosition)+this.input.charAt(this.fromPosition+1)+130):this.input.isFNC1(this.fromPosition)?e.getBytes(232):e.getBytes(this.input.charAt(this.fromPosition)+1);case Mode.B256:return e.getBytes(this.input.charAt(this.fromPosition));case Mode.C40:return this.getC40Words(!0,this.input.getFNC1Character());case Mode.TEXT:return this.getC40Words(!1,this.input.getFNC1Character());case Mode.X12:return this.getX12Words();case Mode.EDF:return this.getEDFBytes()}},e}(),Input=function(e){function t(t,i,r,n,o){var s=e.call(this,t,i,r)||this;return s.shape=n,s.macroId=o,s}return __extends(t,e),t.prototype.getMacroId=function(){return this.macroId},t.prototype.getShapeHint=function(){return this.shape},t}(MinimalECIInput);
//# sourceMappingURL=/sm/aef3f5495cc60d3b7c78c3c17d6490bcc152b1bb5d6edddb378df479c88a51d0.map