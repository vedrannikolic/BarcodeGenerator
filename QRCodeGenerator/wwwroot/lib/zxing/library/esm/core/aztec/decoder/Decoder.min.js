/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/aztec/decoder/Decoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import DecoderResult from"../../common/DecoderResult";import GenericGF from"../../common/reedsolomon/GenericGF";import ReedSolomonDecoder from"../../common/reedsolomon/ReedSolomonDecoder";import IllegalStateException from"../../IllegalStateException";import FormatException from"../../FormatException";import StringUtils from"../../common/StringUtils";import Integer from"../../util/Integer";var Table;!function(e){e[e.UPPER=0]="UPPER",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.DIGIT=3]="DIGIT",e[e.PUNCT=4]="PUNCT",e[e.BINARY=5]="BINARY"}(Table||(Table={}));var Decoder=function(){function e(){}return e.prototype.decode=function(r){this.ddata=r;var t=r.getBits(),a=this.extractBits(t),o=this.correctBits(a),n=e.convertBoolArrayToByteArray(o),i=e.getEncodedData(o),c=new DecoderResult(n,i,null,null);return c.setNumBits(o.length),c},e.highLevelDecode=function(e){return this.getEncodedData(e)},e.getEncodedData=function(r){for(var t=r.length,a=Table.UPPER,o=Table.UPPER,n="",i=0;i<t;)if(o===Table.BINARY){if(t-i<5)break;var c=e.readCode(r,i,5);if(i+=5,0===c){if(t-i<11)break;c=e.readCode(r,i,11)+31,i+=11}for(var T=0;T<c;T++){if(t-i<8){i=t;break}var l=e.readCode(r,i,8);n+=StringUtils.castAsNonUtf8Char(l),i+=8}o=a}else{var d=o===Table.DIGIT?4:5;if(t-i<d)break;l=e.readCode(r,i,d);i+=d;var s=e.getCharacter(o,l);s.startsWith("CTRL_")?(a=o,o=e.getTable(s.charAt(5)),"L"===s.charAt(6)&&(a=o)):(n+=s,o=a)}return n},e.getTable=function(e){switch(e){case"L":return Table.LOWER;case"P":return Table.PUNCT;case"M":return Table.MIXED;case"D":return Table.DIGIT;case"B":return Table.BINARY;default:return Table.UPPER}},e.getCharacter=function(r,t){switch(r){case Table.UPPER:return e.UPPER_TABLE[t];case Table.LOWER:return e.LOWER_TABLE[t];case Table.MIXED:return e.MIXED_TABLE[t];case Table.PUNCT:return e.PUNCT_TABLE[t];case Table.DIGIT:return e.DIGIT_TABLE[t];default:throw new IllegalStateException("Bad table")}},e.prototype.correctBits=function(r){var t,a;this.ddata.getNbLayers()<=2?(a=6,t=GenericGF.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(a=8,t=GenericGF.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(a=10,t=GenericGF.AZTEC_DATA_10):(a=12,t=GenericGF.AZTEC_DATA_12);var o=this.ddata.getNbDatablocks(),n=r.length/a;if(n<o)throw new FormatException;for(var i=r.length%a,c=new Int32Array(n),T=0;T<n;T++,i+=a)c[T]=e.readCode(r,i,a);try{new ReedSolomonDecoder(t).decode(c,n-o)}catch(e){throw new FormatException(e)}var l=(1<<a)-1,d=0;for(T=0;T<o;T++){if(0===(f=c[T])||f===l)throw new FormatException;1!==f&&f!==l-1||d++}var s=new Array(o*a-d),L=0;for(T=0;T<o;T++){var f;if(1===(f=c[T])||f===l-1)s.fill(f>1,L,L+a-1),L+=a-1;else for(var u=a-1;u>=0;--u)s[L++]=0!=(f&1<<u)}return s},e.prototype.extractBits=function(e){var r=this.ddata.isCompact(),t=this.ddata.getNbLayers(),a=(r?11:14)+4*t,o=new Int32Array(a),n=new Array(this.totalBitsInLayer(t,r));if(r)for(var i=0;i<o.length;i++)o[i]=i;else{var c=a+1+2*Integer.truncDivision(Integer.truncDivision(a,2)-1,15),T=a/2,l=Integer.truncDivision(c,2);for(i=0;i<T;i++){var d=i+Integer.truncDivision(i,15);o[T-i-1]=l-d-1,o[T+i]=l+d+1}}i=0;for(var s=0;i<t;i++){for(var L=4*(t-i)+(r?9:12),f=2*i,u=a-1-f,E=0;E<L;E++)for(var R=2*E,C=0;C<2;C++)n[s+R+C]=e.get(o[f+C],o[f+E]),n[s+2*L+R+C]=e.get(o[f+E],o[u-C]),n[s+4*L+R+C]=e.get(o[u-C],o[u-E]),n[s+6*L+R+C]=e.get(o[u-E],o[f+C]);s+=8*L}return n},e.readCode=function(e,r,t){for(var a=0,o=r;o<r+t;o++)a<<=1,e[o]&&(a|=1);return a},e.readByte=function(r,t){var a=r.length-t;return a>=8?e.readCode(r,t,8):e.readCode(r,t,a)<<8-a},e.convertBoolArrayToByteArray=function(r){for(var t=new Uint8Array((r.length+7)/8),a=0;a<t.length;a++)t[a]=e.readByte(r,8*a);return t},e.prototype.totalBitsInLayer=function(e,r){return((r?88:112)+16*e)*e},e.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],e.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],e.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],e.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],e.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],e}();export default Decoder;
//# sourceMappingURL=/sm/d30d78cfd3db4ea7d5aaaa265f72f59010b200bcf5213d97e9878b9ef5665695.map