/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/qrcode/encoder/Encoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};import EncodeHintType from"../../EncodeHintType";import BitArray from"../../common/BitArray";import CharacterSetECI from"../../common/CharacterSetECI";import GenericGF from"../../common/reedsolomon/GenericGF";import ReedSolomonEncoder from"../../common/reedsolomon/ReedSolomonEncoder";import Mode from"../decoder/Mode";import Version from"../decoder/Version";import MaskUtil from"./MaskUtil";import ByteMatrix from"./ByteMatrix";import QRCode from"./QRCode";import MatrixUtil from"./MatrixUtil";import StringEncoding from"../../util/StringEncoding";import BlockPair from"./BlockPair";import WriterException from"../../WriterException";var Encoder=function(){function e(){}return e.calculateMaskPenalty=function(e){return MaskUtil.applyMaskPenaltyRule1(e)+MaskUtil.applyMaskPenaltyRule2(e)+MaskUtil.applyMaskPenaltyRule3(e)+MaskUtil.applyMaskPenaltyRule4(e)},e.encode=function(t,r,n){void 0===n&&(n=null);var i=e.DEFAULT_BYTE_MODE_ENCODING,o=null!==n&&void 0!==n.get(EncodeHintType.CHARACTER_SET);o&&(i=n.get(EncodeHintType.CHARACTER_SET).toString());var a=this.chooseMode(t,i),c=new BitArray;if(a===Mode.BYTE&&(o||e.DEFAULT_BYTE_MODE_ENCODING!==i)){var s=CharacterSetECI.getCharacterSetECIByName(i);void 0!==s&&this.appendECI(s,c)}this.appendModeInfo(a,c);var d,l=new BitArray;if(this.appendBytes(t,a,l,i),null!==n&&void 0!==n.get(EncodeHintType.QR_VERSION)){var p=Number.parseInt(n.get(EncodeHintType.QR_VERSION).toString(),10);d=Version.getVersionForNumber(p);var f=this.calculateBitsNeeded(a,c,l,d);if(!this.willFit(f,d,r))throw new WriterException("Data too big for requested version")}else d=this.recommendVersion(r,a,c,l);var h=new BitArray;h.appendBitArray(c);var u=a===Mode.BYTE?l.getSizeInBytes():t.length;this.appendLengthInfo(u,d,a,h),h.appendBitArray(l);var E=d.getECBlocksForLevel(r),g=d.getTotalCodewords()-E.getTotalECCodewords();this.terminateBits(g,h);var B=this.interleaveWithECBytes(h,d.getTotalCodewords(),g,E.getNumBlocks()),y=new QRCode;y.setECLevel(r),y.setMode(a),y.setVersion(d);var m=d.getDimensionForVersion(),v=new ByteMatrix(m,m),C=this.chooseMaskPattern(B,r,d,v);return y.setMaskPattern(C),MatrixUtil.buildMatrix(B,r,d,C,v),y.setMatrix(v),y},e.recommendVersion=function(e,t,r,n){var i=this.calculateBitsNeeded(t,r,n,Version.getVersionForNumber(1)),o=this.chooseVersion(i,e),a=this.calculateBitsNeeded(t,r,n,o);return this.chooseVersion(a,e)},e.calculateBitsNeeded=function(e,t,r,n){return t.getSize()+e.getCharacterCountBits(n)+r.getSize()},e.getAlphanumericCode=function(t){return t<e.ALPHANUMERIC_TABLE.length?e.ALPHANUMERIC_TABLE[t]:-1},e.chooseMode=function(t,r){if(void 0===r&&(r=null),CharacterSetECI.SJIS.getName()===r&&this.isOnlyDoubleByteKanji(t))return Mode.KANJI;for(var n=!1,i=!1,o=0,a=t.length;o<a;++o){var c=t.charAt(o);if(e.isDigit(c))n=!0;else{if(-1===this.getAlphanumericCode(c.charCodeAt(0)))return Mode.BYTE;i=!0}}return i?Mode.ALPHANUMERIC:n?Mode.NUMERIC:Mode.BYTE},e.isOnlyDoubleByteKanji=function(e){var t;try{t=StringEncoding.encode(e,CharacterSetECI.SJIS)}catch(e){return!1}var r=t.length;if(r%2!=0)return!1;for(var n=0;n<r;n+=2){var i=255&t[n];if((i<129||i>159)&&(i<224||i>235))return!1}return!0},e.chooseMaskPattern=function(e,t,r,n){for(var i=Number.MAX_SAFE_INTEGER,o=-1,a=0;a<QRCode.NUM_MASK_PATTERNS;a++){MatrixUtil.buildMatrix(e,t,r,a,n);var c=this.calculateMaskPenalty(n);c<i&&(i=c,o=a)}return o},e.chooseVersion=function(t,r){for(var n=1;n<=40;n++){var i=Version.getVersionForNumber(n);if(e.willFit(t,i,r))return i}throw new WriterException("Data too big")},e.willFit=function(e,t,r){return t.getTotalCodewords()-t.getECBlocksForLevel(r).getTotalECCodewords()>=(e+7)/8},e.terminateBits=function(e,t){var r=8*e;if(t.getSize()>r)throw new WriterException("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(var n=0;n<4&&t.getSize()<r;++n)t.appendBit(!1);var i=7&t.getSize();if(i>0)for(n=i;n<8;n++)t.appendBit(!1);var o=e-t.getSizeInBytes();for(n=0;n<o;++n)t.appendBits(0==(1&n)?236:17,8);if(t.getSize()!==r)throw new WriterException("Bits size does not equal capacity")},e.getNumDataBytesAndNumECBytesForBlockID=function(e,t,r,n,i,o){if(n>=r)throw new WriterException("Block ID too large");var a=e%r,c=r-a,s=Math.floor(e/r),d=s+1,l=Math.floor(t/r),p=l+1,f=s-l,h=d-p;if(f!==h)throw new WriterException("EC bytes mismatch");if(r!==c+a)throw new WriterException("RS blocks mismatch");if(e!==(l+f)*c+(p+h)*a)throw new WriterException("Total bytes mismatch");n<c?(i[0]=l,o[0]=f):(i[0]=p,o[0]=h)},e.interleaveWithECBytes=function(t,r,n,i){var o,a,c,s;if(t.getSizeInBytes()!==n)throw new WriterException("Number of bits and data bytes does not match");for(var d=0,l=0,p=0,f=new Array,h=0;h<i;++h){var u=new Int32Array(1),E=new Int32Array(1);e.getNumDataBytesAndNumECBytesForBlockID(r,n,i,h,u,E);var g=u[0],B=new Uint8Array(g);t.toBytes(8*d,B,0,g);var y=e.generateECBytes(B,E[0]);f.push(new BlockPair(B,y)),l=Math.max(l,g),p=Math.max(p,y.length),d+=u[0]}if(n!==d)throw new WriterException("Data bytes does not match offset");var m=new BitArray;for(h=0;h<l;++h)try{for(var v=(o=void 0,__values(f)),C=v.next();!C.done;C=v.next()){h<(B=C.value.getDataBytes()).length&&m.appendBits(B[h],8)}}catch(e){o={error:e}}finally{try{C&&!C.done&&(a=v.return)&&a.call(v)}finally{if(o)throw o.error}}for(h=0;h<p;++h)try{for(var w=(c=void 0,__values(f)),M=w.next();!M.done;M=w.next()){h<(y=M.value.getErrorCorrectionBytes()).length&&m.appendBits(y[h],8)}}catch(e){c={error:e}}finally{try{M&&!M.done&&(s=w.return)&&s.call(w)}finally{if(c)throw c.error}}if(r!==m.getSizeInBytes())throw new WriterException("Interleaving error: "+r+" and "+m.getSizeInBytes()+" differ.");return m},e.generateECBytes=function(e,t){for(var r=e.length,n=new Int32Array(r+t),i=0;i<r;i++)n[i]=255&e[i];new ReedSolomonEncoder(GenericGF.QR_CODE_FIELD_256).encode(n,t);var o=new Uint8Array(t);for(i=0;i<t;i++)o[i]=n[r+i];return o},e.appendModeInfo=function(e,t){t.appendBits(e.getBits(),4)},e.appendLengthInfo=function(e,t,r,n){var i=r.getCharacterCountBits(t);if(e>=1<<i)throw new WriterException(e+" is bigger than "+((1<<i)-1));n.appendBits(e,i)},e.appendBytes=function(t,r,n,i){switch(r){case Mode.NUMERIC:e.appendNumericBytes(t,n);break;case Mode.ALPHANUMERIC:e.appendAlphanumericBytes(t,n);break;case Mode.BYTE:e.append8BitBytes(t,n,i);break;case Mode.KANJI:e.appendKanjiBytes(t,n);break;default:throw new WriterException("Invalid mode: "+r)}},e.getDigit=function(e){return e.charCodeAt(0)-48},e.isDigit=function(t){var r=e.getDigit(t);return r>=0&&r<=9},e.appendNumericBytes=function(t,r){for(var n=t.length,i=0;i<n;){var o=e.getDigit(t.charAt(i));if(i+2<n){var a=e.getDigit(t.charAt(i+1)),c=e.getDigit(t.charAt(i+2));r.appendBits(100*o+10*a+c,10),i+=3}else if(i+1<n){a=e.getDigit(t.charAt(i+1));r.appendBits(10*o+a,7),i+=2}else r.appendBits(o,4),i++}},e.appendAlphanumericBytes=function(t,r){for(var n=t.length,i=0;i<n;){var o=e.getAlphanumericCode(t.charCodeAt(i));if(-1===o)throw new WriterException;if(i+1<n){var a=e.getAlphanumericCode(t.charCodeAt(i+1));if(-1===a)throw new WriterException;r.appendBits(45*o+a,11),i+=2}else r.appendBits(o,6),i++}},e.append8BitBytes=function(e,t,r){var n;try{n=StringEncoding.encode(e,r)}catch(e){throw new WriterException(e)}for(var i=0,o=n.length;i!==o;i++){var a=n[i];t.appendBits(a,8)}},e.appendKanjiBytes=function(e,t){var r;try{r=StringEncoding.encode(e,CharacterSetECI.SJIS)}catch(e){throw new WriterException(e)}for(var n=r.length,i=0;i<n;i+=2){var o=(255&r[i])<<8&4294967295|255&r[i+1],a=-1;if(o>=33088&&o<=40956?a=o-33088:o>=57408&&o<=60351&&(a=o-49472),-1===a)throw new WriterException("Invalid byte sequence");var c=192*(a>>8)+(255&a);t.appendBits(c,13)}},e.appendECI=function(e,t){t.appendBits(Mode.ECI.getBits(),4),t.appendBits(e.getValue(),8)},e.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),e.DEFAULT_BYTE_MODE_ENCODING=CharacterSetECI.UTF8.getName(),e}();export default Encoder;
//# sourceMappingURL=/sm/93dbef7b54cf9f578993cd076c474042dbb70d0caa68b2f4782ba92a9402b129.map