/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/qrcode/decoder/DecodedBitStreamParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import BitSource from"../../common/BitSource";import CharacterSetECI from"../../common/CharacterSetECI";import DecoderResult from"../../common/DecoderResult";import StringUtils from"../../common/StringUtils";import FormatException from"../../FormatException";import StringBuilder from"../../util/StringBuilder";import StringEncoding from"../../util/StringEncoding";import Mode from"./Mode";var DecodedBitStreamParser=function(){function e(){}return e.decode=function(r,t,a,o){var i=new BitSource(r),n=new StringBuilder,c=new Array,d=-1,l=-1;try{var m=null,h=!1,p=void 0;do{if(i.available()<4)p=Mode.TERMINATOR;else{var u=i.readBits(4);p=Mode.forBits(u)}switch(p){case Mode.TERMINATOR:break;case Mode.FNC1_FIRST_POSITION:case Mode.FNC1_SECOND_POSITION:h=!0;break;case Mode.STRUCTURED_APPEND:if(i.available()<16)throw new FormatException;d=i.readBits(8),l=i.readBits(8);break;case Mode.ECI:var f=e.parseECIValue(i);if(null===(m=CharacterSetECI.getCharacterSetECIByValue(f)))throw new FormatException;break;case Mode.HANZI:var s=i.readBits(4),w=i.readBits(p.getCharacterCountBits(t));s===e.GB2312_SUBSET&&e.decodeHanziSegment(i,n,w);break;default:var E=i.readBits(p.getCharacterCountBits(t));switch(p){case Mode.NUMERIC:e.decodeNumericSegment(i,n,E);break;case Mode.ALPHANUMERIC:e.decodeAlphanumericSegment(i,n,E,h);break;case Mode.BYTE:e.decodeByteSegment(i,n,E,m,c,o);break;case Mode.KANJI:e.decodeKanjiSegment(i,n,E);break;default:throw new FormatException}}}while(p!==Mode.TERMINATOR)}catch(e){throw new FormatException}return new DecoderResult(r,n.toString(),0===c.length?null:c,null===a?null:a.toString(),d,l)},e.decodeHanziSegment=function(e,r,t){if(13*t>e.available())throw new FormatException;for(var a=new Uint8Array(2*t),o=0;t>0;){var i=e.readBits(13),n=i/96<<8&4294967295|i%96;n+=n<959?41377:42657,a[o]=n>>8&255,a[o+1]=255&n,o+=2,t--}try{r.append(StringEncoding.decode(a,StringUtils.GB2312))}catch(e){throw new FormatException(e)}},e.decodeKanjiSegment=function(e,r,t){if(13*t>e.available())throw new FormatException;for(var a=new Uint8Array(2*t),o=0;t>0;){var i=e.readBits(13),n=i/192<<8&4294967295|i%192;n+=n<7936?33088:49472,a[o]=n>>8,a[o+1]=n,o+=2,t--}try{r.append(StringEncoding.decode(a,StringUtils.SHIFT_JIS))}catch(e){throw new FormatException(e)}},e.decodeByteSegment=function(e,r,t,a,o,i){if(8*t>e.available())throw new FormatException;for(var n,c=new Uint8Array(t),d=0;d<t;d++)c[d]=e.readBits(8);n=null===a?StringUtils.guessEncoding(c,i):a.getName();try{r.append(StringEncoding.decode(c,n))}catch(e){throw new FormatException(e)}o.push(c)},e.toAlphaNumericChar=function(r){if(r>=e.ALPHANUMERIC_CHARS.length)throw new FormatException;return e.ALPHANUMERIC_CHARS[r]},e.decodeAlphanumericSegment=function(r,t,a,o){for(var i=t.length();a>1;){if(r.available()<11)throw new FormatException;var n=r.readBits(11);t.append(e.toAlphaNumericChar(Math.floor(n/45))),t.append(e.toAlphaNumericChar(n%45)),a-=2}if(1===a){if(r.available()<6)throw new FormatException;t.append(e.toAlphaNumericChar(r.readBits(6)))}if(o)for(var c=i;c<t.length();c++)"%"===t.charAt(c)&&(c<t.length()-1&&"%"===t.charAt(c+1)?t.deleteCharAt(c+1):t.setCharAt(c,String.fromCharCode(29)))},e.decodeNumericSegment=function(r,t,a){for(;a>=3;){if(r.available()<10)throw new FormatException;var o=r.readBits(10);if(o>=1e3)throw new FormatException;t.append(e.toAlphaNumericChar(Math.floor(o/100))),t.append(e.toAlphaNumericChar(Math.floor(o/10)%10)),t.append(e.toAlphaNumericChar(o%10)),a-=3}if(2===a){if(r.available()<7)throw new FormatException;var i=r.readBits(7);if(i>=100)throw new FormatException;t.append(e.toAlphaNumericChar(Math.floor(i/10))),t.append(e.toAlphaNumericChar(i%10))}else if(1===a){if(r.available()<4)throw new FormatException;var n=r.readBits(4);if(n>=10)throw new FormatException;t.append(e.toAlphaNumericChar(n))}},e.parseECIValue=function(e){var r=e.readBits(8);if(0==(128&r))return 127&r;if(128==(192&r))return(63&r)<<8&4294967295|e.readBits(8);if(192==(224&r))return(31&r)<<16&4294967295|e.readBits(16);throw new FormatException},e.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",e.GB2312_SUBSET=1,e}();export default DecodedBitStreamParser;
//# sourceMappingURL=/sm/4a19d0b92e5ed5cae5b061b9f6c991adbe48373d96feef180fa9b53745d18cb0.map