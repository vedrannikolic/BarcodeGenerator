/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/qrcode/detector/Detector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import MathUtils from"../../common/detector/MathUtils";import DetectorResult from"../../common/DetectorResult";import GridSamplerInstance from"../../common/GridSamplerInstance";import PerspectiveTransform from"../../common/PerspectiveTransform";import DecodeHintType from"../../DecodeHintType";import NotFoundException from"../../NotFoundException";import ResultPoint from"../../ResultPoint";import Version from"../decoder/Version";import AlignmentPatternFinder from"./AlignmentPatternFinder";import FinderPatternFinder from"./FinderPatternFinder";var Detector=function(){function t(t){this.image=t}return t.prototype.getImage=function(){return this.image},t.prototype.getResultPointCallback=function(){return this.resultPointCallback},t.prototype.detect=function(t){this.resultPointCallback=null==t?null:t.get(DecodeHintType.NEED_RESULT_POINT_CALLBACK);var e=new FinderPatternFinder(this.image,this.resultPointCallback).find(t);return this.processFinderPatternInfo(e)},t.prototype.processFinderPatternInfo=function(e){var i=e.getTopLeft(),o=e.getTopRight(),n=e.getBottomLeft(),r=this.calculateModuleSize(i,o,n);if(r<1)throw new NotFoundException("No pattern found in proccess finder.");var a=t.computeDimension(i,o,n,r),s=Version.getProvisionalVersionForDimension(a),l=s.getDimensionForVersion()-7,c=null;if(s.getAlignmentPatternCenters().length>0)for(var g=o.getX()-i.getX()+n.getX(),h=o.getY()-i.getY()+n.getY(),m=1-3/l,u=Math.floor(i.getX()+m*(g-i.getX())),f=Math.floor(i.getY()+m*(h-i.getY())),d=4;d<=16;d<<=1)try{c=this.findAlignmentInRegion(r,u,f,d);break}catch(t){if(!(t instanceof NotFoundException))throw t}var p=t.createTransform(i,o,n,c,a),M=t.sampleGrid(this.image,p,a);return new DetectorResult(M,null===c?[n,i,o]:[n,i,o,c])},t.createTransform=function(t,e,i,o,n){var r,a,s,l,c=n-3.5;return null!==o?(r=o.getX(),a=o.getY(),l=s=c-3):(r=e.getX()-t.getX()+i.getX(),a=e.getY()-t.getY()+i.getY(),s=c,l=c),PerspectiveTransform.quadrilateralToQuadrilateral(3.5,3.5,c,3.5,s,l,3.5,c,t.getX(),t.getY(),e.getX(),e.getY(),r,a,i.getX(),i.getY())},t.sampleGrid=function(t,e,i){return GridSamplerInstance.getInstance().sampleGridWithTransform(t,i,i,e)},t.computeDimension=function(t,e,i,o){var n=MathUtils.round(ResultPoint.distance(t,e)/o),r=MathUtils.round(ResultPoint.distance(t,i)/o),a=Math.floor((n+r)/2)+7;switch(3&a){case 0:a++;break;case 2:a--;break;case 3:throw new NotFoundException("Dimensions could be not found.")}return a},t.prototype.calculateModuleSize=function(t,e,i){return(this.calculateModuleSizeOneWay(t,e)+this.calculateModuleSizeOneWay(t,i))/2},t.prototype.calculateModuleSizeOneWay=function(t,e){var i=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY())),o=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY()));return isNaN(i)?o/7:isNaN(o)?i/7:(i+o)/14},t.prototype.sizeOfBlackWhiteBlackRunBothWays=function(t,e,i,o){var n=this.sizeOfBlackWhiteBlackRun(t,e,i,o),r=1,a=t-(i-t);a<0?(r=t/(t-a),a=0):a>=this.image.getWidth()&&(r=(this.image.getWidth()-1-t)/(a-t),a=this.image.getWidth()-1);var s=Math.floor(e-(o-e)*r);return r=1,s<0?(r=e/(e-s),s=0):s>=this.image.getHeight()&&(r=(this.image.getHeight()-1-e)/(s-e),s=this.image.getHeight()-1),a=Math.floor(t+(a-t)*r),(n+=this.sizeOfBlackWhiteBlackRun(t,e,a,s))-1},t.prototype.sizeOfBlackWhiteBlackRun=function(t,e,i,o){var n=Math.abs(o-e)>Math.abs(i-t);if(n){var r=t;t=e,e=r,r=i,i=o,o=r}for(var a=Math.abs(i-t),s=Math.abs(o-e),l=-a/2,c=t<i?1:-1,g=e<o?1:-1,h=0,m=i+c,u=t,f=e;u!==m;u+=c){var d=n?f:u,p=n?u:f;if(1===h===this.image.get(d,p)){if(2===h)return MathUtils.distance(u,f,t,e);h++}if((l+=s)>0){if(f===o)break;f+=g,l-=a}}return 2===h?MathUtils.distance(i+c,o,t,e):NaN},t.prototype.findAlignmentInRegion=function(t,e,i,o){var n=Math.floor(o*t),r=Math.max(0,e-n),a=Math.min(this.image.getWidth()-1,e+n);if(a-r<3*t)throw new NotFoundException("Alignment top exceeds estimated module size.");var s=Math.max(0,i-n),l=Math.min(this.image.getHeight()-1,i+n);if(l-s<3*t)throw new NotFoundException("Alignment bottom exceeds estimated module size.");return new AlignmentPatternFinder(this.image,r,s,a-r,l-s,t,this.resultPointCallback).find()},t}();export default Detector;
//# sourceMappingURL=/sm/1b6ae138d1a0d76dad40d0902b5c2318838ca1079f8e3664a52e363a0cc6665b.map