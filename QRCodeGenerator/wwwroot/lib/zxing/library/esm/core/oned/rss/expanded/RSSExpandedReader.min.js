/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/oned/rss/expanded/RSSExpandedReader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(r,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e])},t(r,e)};return function(r,e){function n(){this.constructor=r}t(r,e),r.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),__values=this&&this.__values||function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};import BarcodeFormat from"../../../BarcodeFormat";import MathUtils from"../../../common/detector/MathUtils";import NotFoundException from"../../../NotFoundException";import Result from"../../../Result";import System from"../../../util/System";import AbstractRSSReader from"../../rss/AbstractRSSReader";import DataCharacter from"../../rss/DataCharacter";import FinderPattern from"../../rss/FinderPattern";import RSSUtils from"../../rss/RSSUtils";import BitArrayBuilder from"./BitArrayBuilder";import{createDecoder}from"./decoders/AbstractExpandedDecoderComplement";import ExpandedPair from"./ExpandedPair";import ExpandedRow from"./ExpandedRow";var RSSExpandedReader=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.pairs=new Array(r.MAX_PAIRS),e.rows=new Array,e.startEnd=[2],e}return __extends(r,t),r.prototype.decodeRow=function(t,e,n){this.pairs.length=0,this.startFromEven=!1;try{return r.constructResult(this.decodeRow2pairs(t,e))}catch(t){}return this.pairs.length=0,this.startFromEven=!0,r.constructResult(this.decodeRow2pairs(t,e))},r.prototype.reset=function(){this.pairs.length=0,this.rows.length=0},r.prototype.decodeRow2pairs=function(t,r){for(var e,n=!1;!n;)try{this.pairs.push(this.retrieveNextPair(r,this.pairs,t))}catch(t){if(t instanceof NotFoundException){if(!this.pairs.length)throw new NotFoundException;n=!0}}if(this.checkChecksum())return this.pairs;if(e=!!this.rows.length,this.storeRow(t,!1),e){var o=this.checkRowsBoolean(!1);if(null!=o)return o;if(null!=(o=this.checkRowsBoolean(!0)))return o}throw new NotFoundException},r.prototype.checkRowsBoolean=function(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());var r=null;try{r=this.checkRows(new Array,0)}catch(t){console.log(t)}return t&&(this.rows=this.rows.reverse()),r},r.prototype.checkRows=function(t,e){for(var n,o,i=e;i<this.rows.length;i++){var a=this.rows[i];this.pairs.length=0;try{for(var s=(n=void 0,__values(t)),h=s.next();!h.done;h=s.next()){var l=h.value;this.pairs.push(l.getPairs())}}catch(t){n={error:t}}finally{try{h&&!h.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}if(this.pairs.push(a.getPairs()),r.isValidSequence(this.pairs)){if(this.checkChecksum())return this.pairs;var u=new Array(t);u.push(a);try{return this.checkRows(u,i+1)}catch(t){console.log(t)}}}throw new NotFoundException},r.isValidSequence=function(t){var e,n;try{for(var o=__values(r.FINDER_PATTERN_SEQUENCES),i=o.next();!i.done;i=o.next()){var a=i.value;if(!(t.length>a.length)){for(var s=!0,h=0;h<t.length;h++)if(t[h].getFinderPattern().getValue()!==a[h]){s=!1;break}if(s)return!0}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return!1},r.prototype.storeRow=function(t,e){for(var n=0,o=!1,i=!1;n<this.rows.length;){var a=this.rows[n];if(a.getRowNumber()>t){i=a.isEquivalent(this.pairs);break}o=a.isEquivalent(this.pairs),n++}i||o||r.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new ExpandedRow(this.pairs,t,e)),this.removePartialRows(this.pairs,this.rows))},r.prototype.removePartialRows=function(t,r){var e,n,o,i,a,s;try{for(var h=__values(r),l=h.next();!l.done;l=h.next()){var u=l.value;if(u.getPairs().length!==t.length){try{for(var _=(o=void 0,__values(u.getPairs())),E=_.next();!E.done;E=_.next()){var d=E.value,c=!1;try{for(var f=(a=void 0,__values(t)),R=f.next();!R.done;R=f.next()){var p=R.value;if(ExpandedPair.equals(d,p)){c=!0;break}}}catch(t){a={error:t}}finally{try{R&&!R.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}c||!1}}catch(t){o={error:t}}finally{try{E&&!E.done&&(i=_.return)&&i.call(_)}finally{if(o)throw o.error}}}}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}},r.isPartialRow=function(t,r){var e,n,o,i,a,s;try{for(var h=__values(r),l=h.next();!l.done;l=h.next()){var u=l.value,_=!0;try{for(var E=(o=void 0,__values(t)),d=E.next();!d.done;d=E.next()){var c=d.value,f=!1;try{for(var R=(a=void 0,__values(u.getPairs())),p=R.next();!p.done;p=R.next()){var F=p.value;if(c.equals(F)){f=!0;break}}}catch(t){a={error:t}}finally{try{p&&!p.done&&(s=R.return)&&s.call(R)}finally{if(a)throw a.error}}if(!f){_=!1;break}}}catch(t){o={error:t}}finally{try{d&&!d.done&&(i=E.return)&&i.call(E)}finally{if(o)throw o.error}}if(_)return!0}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=h.return)&&n.call(h)}finally{if(e)throw e.error}}return!1},r.prototype.getRows=function(){return this.rows},r.constructResult=function(t){var r=BitArrayBuilder.buildBitArray(t),e=createDecoder(r).parseInformation(),n=t[0].getFinderPattern().getResultPoints(),o=t[t.length-1].getFinderPattern().getResultPoints(),i=[n[0],n[1],o[0],o[1]];return new Result(e,null,null,i,BarcodeFormat.RSS_EXPANDED,null)},r.prototype.checkChecksum=function(){var t=this.pairs.get(0),r=t.getLeftChar(),e=t.getRightChar();if(null===e)return!1;for(var n=e.getChecksumPortion(),o=2,i=1;i<this.pairs.size();++i){var a=this.pairs.get(i);n+=a.getLeftChar().getChecksumPortion(),o++;var s=a.getRightChar();null!=s&&(n+=s.getChecksumPortion(),o++)}return 211*(o-4)+(n%=211)===r.getValue()},r.getNextSecondBar=function(t,r){var e;return t.get(r)?(e=t.getNextUnset(r),e=t.getNextSet(e)):(e=t.getNextSet(r),e=t.getNextUnset(e)),e},r.prototype.retrieveNextPair=function(t,e,n){var o,i=e.length%2==0;this.startFromEven&&(i=!i);var a=!0,s=-1;do{this.findNextPair(t,e,s),null===(o=this.parseFoundFinderPattern(t,n,i))?s=r.getNextSecondBar(t,this.startEnd[0]):a=!1}while(a);var h,l=this.decodeDataCharacter(t,o,i,!0);if(!this.isEmptyPair(e)&&e[e.length-1].mustBeLast())throw new NotFoundException;try{h=this.decodeDataCharacter(t,o,i,!1)}catch(t){h=null,console.log(t)}return new ExpandedPair(l,h,o,!0)},r.prototype.isEmptyPair=function(t){return 0===t.length},r.prototype.findNextPair=function(t,e,n){var o=this.getDecodeFinderCounters();o[0]=0,o[1]=0,o[2]=0,o[3]=0;var i,a=t.getSize();if(n>=0)i=n;else if(this.isEmptyPair(e))i=0;else{i=e[e.length-1].getFinderPattern().getStartEnd()[1]}var s=e.length%2!=0;this.startFromEven&&(s=!s);for(var h=!1;i<a&&(h=!t.get(i));)i++;for(var l=0,u=i,_=i;_<a;_++)if(t.get(_)!==h)o[l]++;else{if(3===l){if(s&&r.reverseCounters(o),r.isFinderPattern(o))return this.startEnd[0]=u,void(this.startEnd[1]=_);s&&r.reverseCounters(o),u+=o[0]+o[1],o[0]=o[2],o[1]=o[3],o[2]=0,o[3]=0,l--}else l++;o[l]=1,h=!h}throw new NotFoundException},r.reverseCounters=function(t){for(var r=t.length,e=0;e<r/2;++e){var n=t[e];t[e]=t[r-e-1],t[r-e-1]=n}},r.prototype.parseFoundFinderPattern=function(t,e,n){var o,i,a;if(n){for(var s=this.startEnd[0]-1;s>=0&&!t.get(s);)s--;s++,o=this.startEnd[0]-s,i=s,a=this.startEnd[1]}else i=this.startEnd[0],o=(a=t.getNextUnset(this.startEnd[1]+1))-this.startEnd[1];var h,l=this.getDecodeFinderCounters();System.arraycopy(l,0,l,1,l.length-1),l[0]=o;try{h=this.parseFinderValue(l,r.FINDER_PATTERNS)}catch(t){return null}return new FinderPattern(h,[i,a],i,a,e)},r.prototype.decodeDataCharacter=function(t,e,n,o){for(var i=this.getDataCharacterCounters(),a=0;a<i.length;a++)i[a]=0;if(o)r.recordPatternInReverse(t,e.getStartEnd()[0],i);else{r.recordPattern(t,e.getStartEnd()[1],i);for(var s=0,h=i.length-1;s<h;s++,h--){var l=i[s];i[s]=i[h],i[h]=l}}var u=MathUtils.sum(new Int32Array(i))/17,_=(e.getStartEnd()[1]-e.getStartEnd()[0])/15;if(Math.abs(u-_)/_>.3)throw new NotFoundException;var E=this.getOddCounts(),d=this.getEvenCounts(),c=this.getOddRoundingErrors(),f=this.getEvenRoundingErrors();for(s=0;s<i.length;s++){var R=1*i[s]/u,p=R+.5;if(p<1){if(R<.3)throw new NotFoundException;p=1}else if(p>8){if(R>8.7)throw new NotFoundException;p=8}var F=s/2;0==(1&s)?(E[F]=p,c[F]=R-p):(d[F]=p,f[F]=R-p)}this.adjustOddEvenCounts(17);var A=4*e.getValue()+(n?0:2)+(o?0:1)-1,v=0,N=0;for(s=E.length-1;s>=0;s--){if(r.isNotA1left(e,n,o)){var P=r.WEIGHTS[A][2*s];N+=E[s]*P}v+=E[s]}var g=0;for(s=d.length-1;s>=0;s--)if(r.isNotA1left(e,n,o)){P=r.WEIGHTS[A][2*s+1];g+=d[s]*P}var D=N+g;if(0!=(1&v)||v>13||v<4)throw new NotFoundException;var w=(13-v)/2,I=r.SYMBOL_WIDEST[w],y=9-I,T=RSSUtils.getRSSvalue(E,I,!0),m=RSSUtils.getRSSvalue(d,y,!1),x=r.EVEN_TOTAL_SUBSET[w],S=r.GSUM[w];return new DataCharacter(T*x+m+S,D)},r.isNotA1left=function(t,r,e){return!(0===t.getValue()&&r&&e)},r.prototype.adjustOddEvenCounts=function(t){var e=MathUtils.sum(new Int32Array(this.getOddCounts())),n=MathUtils.sum(new Int32Array(this.getEvenCounts())),o=!1,i=!1;e>13?i=!0:e<4&&(o=!0);var a=!1,s=!1;n>13?s=!0:n<4&&(a=!0);var h=e+n-t,l=1==(1&e),u=0==(1&n);if(1===h)if(l){if(u)throw new NotFoundException;i=!0}else{if(!u)throw new NotFoundException;s=!0}else if(-1===h)if(l){if(u)throw new NotFoundException;o=!0}else{if(!u)throw new NotFoundException;a=!0}else{if(0!==h)throw new NotFoundException;if(l){if(!u)throw new NotFoundException;e<n?(o=!0,s=!0):(i=!0,a=!0)}else if(u)throw new NotFoundException}if(o){if(i)throw new NotFoundException;r.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&r.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(s)throw new NotFoundException;r.increment(this.getEvenCounts(),this.getOddRoundingErrors())}s&&r.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},r.SYMBOL_WIDEST=[7,5,4,3,1],r.EVEN_TOTAL_SUBSET=[4,20,52,104,204],r.GSUM=[0,348,1388,2948,3988],r.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],r.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],r.FINDER_PAT_A=0,r.FINDER_PAT_B=1,r.FINDER_PAT_C=2,r.FINDER_PAT_D=3,r.FINDER_PAT_E=4,r.FINDER_PAT_F=5,r.FINDER_PATTERN_SEQUENCES=[[r.FINDER_PAT_A,r.FINDER_PAT_A],[r.FINDER_PAT_A,r.FINDER_PAT_B,r.FINDER_PAT_B],[r.FINDER_PAT_A,r.FINDER_PAT_C,r.FINDER_PAT_B,r.FINDER_PAT_D],[r.FINDER_PAT_A,r.FINDER_PAT_E,r.FINDER_PAT_B,r.FINDER_PAT_D,r.FINDER_PAT_C],[r.FINDER_PAT_A,r.FINDER_PAT_E,r.FINDER_PAT_B,r.FINDER_PAT_D,r.FINDER_PAT_D,r.FINDER_PAT_F],[r.FINDER_PAT_A,r.FINDER_PAT_E,r.FINDER_PAT_B,r.FINDER_PAT_D,r.FINDER_PAT_E,r.FINDER_PAT_F,r.FINDER_PAT_F],[r.FINDER_PAT_A,r.FINDER_PAT_A,r.FINDER_PAT_B,r.FINDER_PAT_B,r.FINDER_PAT_C,r.FINDER_PAT_C,r.FINDER_PAT_D,r.FINDER_PAT_D],[r.FINDER_PAT_A,r.FINDER_PAT_A,r.FINDER_PAT_B,r.FINDER_PAT_B,r.FINDER_PAT_C,r.FINDER_PAT_C,r.FINDER_PAT_D,r.FINDER_PAT_E,r.FINDER_PAT_E],[r.FINDER_PAT_A,r.FINDER_PAT_A,r.FINDER_PAT_B,r.FINDER_PAT_B,r.FINDER_PAT_C,r.FINDER_PAT_C,r.FINDER_PAT_D,r.FINDER_PAT_E,r.FINDER_PAT_F,r.FINDER_PAT_F],[r.FINDER_PAT_A,r.FINDER_PAT_A,r.FINDER_PAT_B,r.FINDER_PAT_B,r.FINDER_PAT_C,r.FINDER_PAT_D,r.FINDER_PAT_D,r.FINDER_PAT_E,r.FINDER_PAT_E,r.FINDER_PAT_F,r.FINDER_PAT_F]],r.MAX_PAIRS=11,r}(AbstractRSSReader);export default RSSExpandedReader;
//# sourceMappingURL=/sm/cf99d19565233784c3d96e18288b9437643f951af21b7c75b4c9597e8af04978.map