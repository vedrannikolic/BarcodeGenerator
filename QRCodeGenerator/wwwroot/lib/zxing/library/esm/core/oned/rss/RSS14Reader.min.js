/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/oned/rss/RSS14Reader.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __extends=this&&this.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},t(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};import AbstractRSSReader from"./AbstractRSSReader";import Pair from"./Pair";import Result from"../../Result";import DecodeHintType from"../../DecodeHintType";import NotFoundException from"../../NotFoundException";import StringBuilder from"../../util/StringBuilder";import BarcodeFormat from"../../BarcodeFormat";import ResultPoint from"../../ResultPoint";import FinderPattern from"./FinderPattern";import DataCharacter from"./DataCharacter";import MathUtils from"../../common/detector/MathUtils";import RSSUtils from"./RSSUtils";import System from"../../util/System";import OneDReader from"../OneDReader";var RSS14Reader=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.possibleLeftPairs=[],e.possibleRightPairs=[],e}return __extends(e,t),e.prototype.decodeRow=function(t,r,n){var o,i,a,s,u=this.decodePair(r,!1,t,n);e.addOrTally(this.possibleLeftPairs,u),r.reverse();var d=this.decodePair(r,!0,t,n);e.addOrTally(this.possibleRightPairs,d),r.reverse();try{for(var l=__values(this.possibleLeftPairs),c=l.next();!c.done;c=l.next()){var f=c.value;if(f.getCount()>1)try{for(var h=(a=void 0,__values(this.possibleRightPairs)),S=h.next();!S.done;S=h.next()){var g=S.value;if(g.getCount()>1&&e.checkChecksum(f,g))return e.constructResult(f,g)}}catch(t){a={error:t}}finally{try{S&&!S.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}}}catch(t){o={error:t}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}throw new NotFoundException},e.addOrTally=function(t,e){var r,n;if(null!=e){var o=!1;try{for(var i=__values(t),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.getValue()===e.getValue()){s.incrementCount(),o=!0;break}}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}o||t.push(e)}},e.prototype.reset=function(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0},e.constructResult=function(t,e){for(var r=4537077*t.getValue()+e.getValue(),n=new String(r).toString(),o=new StringBuilder,i=13-n.length;i>0;i--)o.append("0");o.append(n);var a=0;for(i=0;i<13;i++){var s=o.charAt(i).charCodeAt(0)-"0".charCodeAt(0);a+=0==(1&i)?3*s:s}10===(a=10-a%10)&&(a=0),o.append(a.toString());var u=t.getFinderPattern().getResultPoints(),d=e.getFinderPattern().getResultPoints();return new Result(o.toString(),null,0,[u[0],u[1],d[0],d[1]],BarcodeFormat.RSS_14,(new Date).getTime())},e.checkChecksum=function(t,e){var r=(t.getChecksumPortion()+16*e.getChecksumPortion())%79,n=9*t.getFinderPattern().getValue()+e.getFinderPattern().getValue();return n>72&&n--,n>8&&n--,r===n},e.prototype.decodePair=function(t,e,r,n){try{var o=this.findFinderPattern(t,e),i=this.parseFoundFinderPattern(t,r,e,o),a=null==n?null:n.get(DecodeHintType.NEED_RESULT_POINT_CALLBACK);if(null!=a){var s=(o[0]+o[1])/2;e&&(s=t.getSize()-1-s),a.foundPossibleResultPoint(new ResultPoint(s,r))}var u=this.decodeDataCharacter(t,i,!0),d=this.decodeDataCharacter(t,i,!1);return new Pair(1597*u.getValue()+d.getValue(),u.getChecksumPortion()+4*d.getChecksumPortion(),i)}catch(t){return null}},e.prototype.decodeDataCharacter=function(t,r,n){for(var o=this.getDataCharacterCounters(),i=0;i<o.length;i++)o[i]=0;if(n)OneDReader.recordPatternInReverse(t,r.getStartEnd()[0],o);else{OneDReader.recordPattern(t,r.getStartEnd()[1]+1,o);for(var a=0,s=o.length-1;a<s;a++,s--){var u=o[a];o[a]=o[s],o[s]=u}}var d=n?16:15,l=MathUtils.sum(new Int32Array(o))/d,c=this.getOddCounts(),f=this.getEvenCounts(),h=this.getOddRoundingErrors(),S=this.getEvenRoundingErrors();for(a=0;a<o.length;a++){var g=o[a]/l,p=Math.floor(g+.5);p<1?p=1:p>8&&(p=8);var v=Math.floor(a/2);0==(1&a)?(c[v]=p,h[v]=g-p):(f[v]=p,S[v]=g-p)}this.adjustOddEvenCounts(n,d);var m=0,E=0;for(a=c.length-1;a>=0;a--)E*=9,E+=c[a],m+=c[a];var R=0,y=0;for(a=f.length-1;a>=0;a--)R*=9,R+=f[a],y+=f[a];var _=E+3*R;if(n){if(0!=(1&m)||m>12||m<4)throw new NotFoundException;var D=(12-m)/2,w=9-(T=e.OUTSIDE_ODD_WIDEST[D]),P=RSSUtils.getRSSvalue(c,T,!1),I=RSSUtils.getRSSvalue(f,w,!0),O=e.OUTSIDE_EVEN_TOTAL_SUBSET[D],F=e.OUTSIDE_GSUM[D];return new DataCharacter(P*O+I+F,_)}if(0!=(1&y)||y>10||y<4)throw new NotFoundException;D=(10-y)/2,w=9-(T=e.INSIDE_ODD_WIDEST[D]),P=RSSUtils.getRSSvalue(c,T,!0),I=RSSUtils.getRSSvalue(f,w,!1);var T,C=e.INSIDE_ODD_TOTAL_SUBSET[D];F=e.INSIDE_GSUM[D];return new DataCharacter(I*C+P+F,_)},e.prototype.findFinderPattern=function(t,e){var r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;for(var n=t.getSize(),o=!1,i=0;i<n&&e!==(o=!t.get(i));)i++;for(var a=0,s=i,u=i;u<n;u++)if(t.get(u)!==o)r[a]++;else{if(3===a){if(AbstractRSSReader.isFinderPattern(r))return[s,u];s+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,a--}else a++;r[a]=1,o=!o}throw new NotFoundException},e.prototype.parseFoundFinderPattern=function(t,r,n,o){for(var i=t.get(o[0]),a=o[0]-1;a>=0&&i!==t.get(a);)a--;a++;var s=o[0]-a,u=this.getDecodeFinderCounters(),d=new Int32Array(u.length);System.arraycopy(u,0,d,1,u.length-1),d[0]=s;var l=this.parseFinderValue(d,e.FINDER_PATTERNS),c=a,f=o[1];return n&&(c=t.getSize()-1-c,f=t.getSize()-1-f),new FinderPattern(l,[a,o[1]],c,f,r)},e.prototype.adjustOddEvenCounts=function(t,e){var r=MathUtils.sum(new Int32Array(this.getOddCounts())),n=MathUtils.sum(new Int32Array(this.getEvenCounts())),o=!1,i=!1,a=!1,s=!1;t?(r>12?i=!0:r<4&&(o=!0),n>12?s=!0:n<4&&(a=!0)):(r>11?i=!0:r<5&&(o=!0),n>10?s=!0:n<4&&(a=!0));var u=r+n-e,d=(1&r)==(t?1:0),l=1==(1&n);if(1===u)if(d){if(l)throw new NotFoundException;i=!0}else{if(!l)throw new NotFoundException;s=!0}else if(-1===u)if(d){if(l)throw new NotFoundException;o=!0}else{if(!l)throw new NotFoundException;a=!0}else{if(0!==u)throw new NotFoundException;if(d){if(!l)throw new NotFoundException;r<n?(o=!0,s=!0):(i=!0,a=!0)}else if(l)throw new NotFoundException}if(o){if(i)throw new NotFoundException;AbstractRSSReader.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&AbstractRSSReader.decrement(this.getOddCounts(),this.getOddRoundingErrors()),a){if(s)throw new NotFoundException;AbstractRSSReader.increment(this.getEvenCounts(),this.getOddRoundingErrors())}s&&AbstractRSSReader.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],e.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],e.OUTSIDE_GSUM=[0,161,961,2015,2715],e.INSIDE_GSUM=[0,336,1036,1516],e.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],e.INSIDE_ODD_WIDEST=[2,4,6,8],e.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])],e}(AbstractRSSReader);export default RSS14Reader;
//# sourceMappingURL=/sm/3c8b62baf92c5acf047994954f327d5e00a0ac8e02befe632530af5e3c1f62f8.map