/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/pdf417/detector/Detector.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __values=this&&this.__values||function(t){var r="function"==typeof Symbol&&Symbol.iterator,e=r&&t[r],n=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")};import ResultPoint from"../../ResultPoint";import System from"../../util/System";import Arrays from"../../util/Arrays";import PDF417DetectorResult from"./PDF417DetectorResult";var Detector=function(){function t(){}return t.detectMultiple=function(r,e,n){var a=r.getBlackMatrix(),i=t.detect(n,a);return i.length||((a=a.clone()).rotate180(),i=t.detect(n,a)),new PDF417DetectorResult(a,i)},t.detect=function(r,e){for(var n,a,i=new Array,o=0,l=0,u=!1;o<e.getHeight();){var f=t.findVertices(e,o,l);if(null!=f[0]||null!=f[3]){if(u=!0,i.push(f),!r)break;null!=f[2]?(l=Math.trunc(f[2].getX()),o=Math.trunc(f[2].getY())):(l=Math.trunc(f[4].getX()),o=Math.trunc(f[4].getY()))}else{if(!u)break;u=!1,l=0;try{for(var A=(n=void 0,__values(i)),_=A.next();!_.done;_=A.next()){var c=_.value;null!=c[1]&&(o=Math.trunc(Math.max(o,c[1].getY()))),null!=c[3]&&(o=Math.max(o,Math.trunc(c[3].getY())))}}catch(t){n={error:t}}finally{try{_&&!_.done&&(a=A.return)&&a.call(A)}finally{if(n)throw n.error}}o+=t.ROW_STEP}}return i},t.findVertices=function(r,e,n){var a=r.getHeight(),i=r.getWidth(),o=new Array(8);return t.copyToResult(o,t.findRowsWithPattern(r,a,i,e,n,t.START_PATTERN),t.INDEXES_START_PATTERN),null!=o[4]&&(n=Math.trunc(o[4].getX()),e=Math.trunc(o[4].getY())),t.copyToResult(o,t.findRowsWithPattern(r,a,i,e,n,t.STOP_PATTERN),t.INDEXES_STOP_PATTERN),o},t.copyToResult=function(t,r,e){for(var n=0;n<e.length;n++)t[e[n]]=r[n]},t.findRowsWithPattern=function(r,e,n,a,i,o){for(var l=new Array(4),u=!1,f=new Int32Array(o.length);a<e;a+=t.ROW_STEP){if(null!=(T=t.findGuardPattern(r,i,a,n,!1,o,f))){for(;a>0;){if(null==(c=t.findGuardPattern(r,i,--a,n,!1,o,f))){a++;break}T=c}l[0]=new ResultPoint(T[0],a),l[1]=new ResultPoint(T[1],a),u=!0;break}}var A=a+1;if(u){for(var _=0,c=Int32Array.from([Math.trunc(l[0].getX()),Math.trunc(l[1].getX())]);A<e;A++){var T;if(null!=(T=t.findGuardPattern(r,c[0],A,n,!1,o,f))&&Math.abs(c[0]-T[0])<t.MAX_PATTERN_DRIFT&&Math.abs(c[1]-T[1])<t.MAX_PATTERN_DRIFT)c=T,_=0;else{if(_>t.SKIPPED_ROW_COUNT_MAX)break;_++}}A-=_+1,l[2]=new ResultPoint(c[0],A),l[3]=new ResultPoint(c[1],A)}return A-a<t.BARCODE_MIN_HEIGHT&&Arrays.fill(l,null),l},t.findGuardPattern=function(r,e,n,a,i,o,l){Arrays.fillWithin(l,0,l.length,0);for(var u=e,f=0;r.get(u,n)&&u>0&&f++<t.MAX_PIXEL_DRIFT;)u--;for(var A=u,_=0,c=o.length,T=i;A<a;A++){if(r.get(A,n)!==T)l[_]++;else{if(_===c-1){if(t.patternMatchVariance(l,o,t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE)return new Int32Array([u,A]);u+=l[0]+l[1],System.arraycopy(l,2,l,0,_-1),l[_-1]=0,l[_]=0,_--}else _++;l[_]=1,T=!T}}return _===c-1&&t.patternMatchVariance(l,o,t.MAX_INDIVIDUAL_VARIANCE)<t.MAX_AVG_VARIANCE?new Int32Array([u,A-1]):null},t.patternMatchVariance=function(t,r,e){for(var n=t.length,a=0,i=0,o=0;o<n;o++)a+=t[o],i+=r[o];if(a<i)return 1/0;var l=a/i;e*=l;for(var u=0,f=0;f<n;f++){var A=t[f],_=r[f]*l,c=A>_?A-_:_-A;if(c>e)return 1/0;u+=c}return u/a},t.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),t.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),t.MAX_AVG_VARIANCE=.42,t.MAX_INDIVIDUAL_VARIANCE=.8,t.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),t.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),t.MAX_PIXEL_DRIFT=3,t.MAX_PATTERN_DRIFT=5,t.SKIPPED_ROW_COUNT_MAX=25,t.ROW_STEP=5,t.BARCODE_MIN_HEIGHT=10,t}();export default Detector;
//# sourceMappingURL=/sm/82a1523b4239aadfc19c593c219d73b3f60da3e50829d7a2a8c2c2d0faaeaa7c.map