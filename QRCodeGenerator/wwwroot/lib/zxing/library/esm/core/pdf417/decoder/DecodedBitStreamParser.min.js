/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/pdf417/decoder/DecodedBitStreamParser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import FormatException from"../../FormatException";import CharacterSetECI from"../../common/CharacterSetECI";import DecoderResult from"../../common/DecoderResult";import PDF417ResultMetadata from"../PDF417ResultMetadata";import Arrays from"../../util/Arrays";import StringBuilder from"../../util/StringBuilder";import Integer from"../../util/Integer";import Long from"../../util/Long";import ByteArrayOutputStream from"../../util/ByteArrayOutputStream";import StringEncoding from"../../util/StringEncoding";var Mode,BigInteger;function getBigIntConstructor(){if("undefined"!=typeof window)return window.BigInt||null;if("undefined"!=typeof global)return global.BigInt||null;if("undefined"!=typeof self)return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}function createBigInt(e){if(void 0===BigInteger&&(BigInteger=getBigIntConstructor()),null===BigInteger)throw new Error("BigInt is not supported!");return BigInteger(e)}function getEXP900(){var e=[];e[0]=createBigInt(1);var _=createBigInt(900);e[1]=_;for(var t=2;t<16;t++)e[t]=e[t-1]*_;return e}!function(e){e[e.ALPHA=0]="ALPHA",e[e.LOWER=1]="LOWER",e[e.MIXED=2]="MIXED",e[e.PUNCT=3]="PUNCT",e[e.ALPHA_SHIFT=4]="ALPHA_SHIFT",e[e.PUNCT_SHIFT=5]="PUNCT_SHIFT"}(Mode||(Mode={}));var DecodedBitStreamParser=function(){function e(){}return e.decode=function(_,t){var r=new StringBuilder(""),O=CharacterSetECI.ISO8859_1;r.enableDecoding(O);for(var a=1,C=_[a++],E=new PDF417ResultMetadata;a<_[0];){switch(C){case e.TEXT_COMPACTION_MODE_LATCH:a=e.textCompaction(_,a,r);break;case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:a=e.byteCompaction(C,_,O,a,r);break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(_[a++]);break;case e.NUMERIC_COMPACTION_MODE_LATCH:a=e.numericCompaction(_,a,r);break;case e.ECI_CHARSET:CharacterSetECI.getCharacterSetECIByValue(_[a++]);break;case e.ECI_GENERAL_PURPOSE:a+=2;break;case e.ECI_USER_DEFINED:a++;break;case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:a=e.decodeMacroBlock(_,a,E);break;case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:throw new FormatException;default:a--,a=e.textCompaction(_,a,r)}if(!(a<_.length))throw FormatException.getFormatInstance();C=_[a++]}if(0===r.length())throw FormatException.getFormatInstance();var T=new DecoderResult(null,r.toString(),null,t);return T.setOther(E),T},e.decodeMacroBlock=function(_,t,r){if(t+e.NUMBER_OF_SEQUENCE_CODEWORDS>_[0])throw FormatException.getFormatInstance();for(var O=new Int32Array(e.NUMBER_OF_SEQUENCE_CODEWORDS),a=0;a<e.NUMBER_OF_SEQUENCE_CODEWORDS;a++,t++)O[a]=_[t];r.setSegmentIndex(Integer.parseInt(e.decodeBase900toBase10(O,e.NUMBER_OF_SEQUENCE_CODEWORDS)));var C=new StringBuilder;t=e.textCompaction(_,t,C),r.setFileId(C.toString());var E=-1;for(_[t]===e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(E=t+1);t<_[0];)switch(_[t]){case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(_[++t]){case e.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:var T=new StringBuilder;t=e.textCompaction(_,t+1,T),r.setFileName(T.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_SENDER:var A=new StringBuilder;t=e.textCompaction(_,t+1,A),r.setSender(A.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:var n=new StringBuilder;t=e.textCompaction(_,t+1,n),r.setAddressee(n.toString());break;case e.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:var o=new StringBuilder;t=e.numericCompaction(_,t+1,o),r.setSegmentCount(Integer.parseInt(o.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:var M=new StringBuilder;t=e.numericCompaction(_,t+1,M),r.setTimestamp(Long.parseLong(M.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:var I=new StringBuilder;t=e.numericCompaction(_,t+1,I),r.setChecksum(Integer.parseInt(I.toString()));break;case e.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:var c=new StringBuilder;t=e.numericCompaction(_,t+1,c),r.setFileSize(Long.parseLong(c.toString()));break;default:throw FormatException.getFormatInstance()}break;case e.MACRO_PDF417_TERMINATOR:t++,r.setLastSegment(!0);break;default:throw FormatException.getFormatInstance()}if(-1!==E){var i=t-E;r.isLastSegment()&&i--,r.setOptionalData(Arrays.copyOfRange(_,E,E+i))}return t},e.textCompaction=function(_,t,r){for(var O=new Int32Array(2*(_[0]-t)),a=new Int32Array(2*(_[0]-t)),C=0,E=!1;t<_[0]&&!E;){var T=_[t++];if(T<e.TEXT_COMPACTION_MODE_LATCH)O[C]=T/30,O[C+1]=T%30,C+=2;else switch(T){case e.TEXT_COMPACTION_MODE_LATCH:O[C++]=e.TEXT_COMPACTION_MODE_LATCH;break;case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:t--,E=!0;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:O[C]=e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,T=_[t++],a[C]=T,C++}}return e.decodeTextCompaction(O,a,C,r),t},e.decodeTextCompaction=function(_,t,r,O){for(var a=Mode.ALPHA,C=Mode.ALPHA,E=0;E<r;){var T=_[E],A="";switch(a){case Mode.ALPHA:if(T<26)A=String.fromCharCode(65+T);else switch(T){case 26:A=" ";break;case e.LL:a=Mode.LOWER;break;case e.ML:a=Mode.MIXED;break;case e.PS:C=a,a=Mode.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:O.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:a=Mode.ALPHA}break;case Mode.LOWER:if(T<26)A=String.fromCharCode(97+T);else switch(T){case 26:A=" ";break;case e.AS:C=a,a=Mode.ALPHA_SHIFT;break;case e.ML:a=Mode.MIXED;break;case e.PS:C=a,a=Mode.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:O.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:a=Mode.ALPHA}break;case Mode.MIXED:if(T<e.PL)A=e.MIXED_CHARS[T];else switch(T){case e.PL:a=Mode.PUNCT;break;case 26:A=" ";break;case e.LL:a=Mode.LOWER;break;case e.AL:a=Mode.ALPHA;break;case e.PS:C=a,a=Mode.PUNCT_SHIFT;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:O.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:a=Mode.ALPHA}break;case Mode.PUNCT:if(T<e.PAL)A=e.PUNCT_CHARS[T];else switch(T){case e.PAL:a=Mode.ALPHA;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:O.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:a=Mode.ALPHA}break;case Mode.ALPHA_SHIFT:if(a=C,T<26)A=String.fromCharCode(65+T);else switch(T){case 26:A=" ";break;case e.TEXT_COMPACTION_MODE_LATCH:a=Mode.ALPHA}break;case Mode.PUNCT_SHIFT:if(a=C,T<e.PAL)A=e.PUNCT_CHARS[T];else switch(T){case e.PAL:a=Mode.ALPHA;break;case e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:O.append(t[E]);break;case e.TEXT_COMPACTION_MODE_LATCH:a=Mode.ALPHA}}""!==A&&O.append(A),E++}},e.byteCompaction=function(_,t,r,O,a){var C=new ByteArrayOutputStream,E=0,T=0,A=!1;switch(_){case e.BYTE_COMPACTION_MODE_LATCH:for(var n=new Int32Array(6),o=t[O++];O<t[0]&&!A;)switch(n[E++]=o,T=900*T+o,o=t[O++]){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:O--,A=!0;break;default:if(E%5==0&&E>0){for(var M=0;M<6;++M)C.write(Number(createBigInt(T)>>createBigInt(8*(5-M))));T=0,E=0}}O===t[0]&&o<e.TEXT_COMPACTION_MODE_LATCH&&(n[E++]=o);for(var I=0;I<E;I++)C.write(n[I]);break;case e.BYTE_COMPACTION_MODE_LATCH_6:for(;O<t[0]&&!A;){var c=t[O++];if(c<e.TEXT_COMPACTION_MODE_LATCH)E++,T=900*T+c;else switch(c){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.NUMERIC_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:O--,A=!0}if(E%5==0&&E>0){for(M=0;M<6;++M)C.write(Number(createBigInt(T)>>createBigInt(8*(5-M))));T=0,E=0}}}return a.append(StringEncoding.decode(C.toByteArray(),r)),O},e.numericCompaction=function(_,t,r){for(var O=0,a=!1,C=new Int32Array(e.MAX_NUMERIC_CODEWORDS);t<_[0]&&!a;){var E=_[t++];if(t===_[0]&&(a=!0),E<e.TEXT_COMPACTION_MODE_LATCH)C[O]=E,O++;else switch(E){case e.TEXT_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH:case e.BYTE_COMPACTION_MODE_LATCH_6:case e.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case e.MACRO_PDF417_TERMINATOR:t--,a=!0}(O%e.MAX_NUMERIC_CODEWORDS==0||E===e.NUMERIC_COMPACTION_MODE_LATCH||a)&&O>0&&(r.append(e.decodeBase900toBase10(C,O)),O=0)}return t},e.decodeBase900toBase10=function(_,t){for(var r=createBigInt(0),O=0;O<t;O++)r+=e.EXP900[t-O-1]*createBigInt(_[O]);var a=r.toString();if("1"!==a.charAt(0))throw new FormatException;return a.substring(1)},e.TEXT_COMPACTION_MODE_LATCH=900,e.BYTE_COMPACTION_MODE_LATCH=901,e.NUMERIC_COMPACTION_MODE_LATCH=902,e.BYTE_COMPACTION_MODE_LATCH_6=924,e.ECI_USER_DEFINED=925,e.ECI_GENERAL_PURPOSE=926,e.ECI_CHARSET=927,e.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,e.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,e.MACRO_PDF417_TERMINATOR=922,e.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,e.MAX_NUMERIC_CODEWORDS=15,e.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,e.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,e.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,e.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,e.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,e.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,e.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,e.PL=25,e.LL=27,e.AS=27,e.ML=28,e.AL=28,e.PS=29,e.PAL=29,e.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",e.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",e.EXP900=getBigIntConstructor()?getEXP900():[],e.NUMBER_OF_SEQUENCE_CODEWORDS=2,e}();export default DecodedBitStreamParser;
//# sourceMappingURL=/sm/9d6f54f311955afe03472ae30b8d33a09961f3532a82b1172bb2ac9c6d0910c3.map