/**
 * Minified by jsDelivr using Terser v5.19.2.
 * Original file: /npm/@zxing/library@0.21.0/esm/core/pdf417/decoder/PDF417ScanningDecoder.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __values=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};import ChecksumException from"../../ChecksumException";import FormatException from"../../FormatException";import NotFoundException from"../../NotFoundException";import MathUtils from"../../common/detector/MathUtils";import PDF417Common from"../PDF417Common";import ErrorCorrection from"./ec/ErrorCorrection";import BoundingBox from"./BoundingBox";import DetectionResultRowIndicatorColumn from"./DetectionResultRowIndicatorColumn";import DetectionResult from"./DetectionResult";import DetectionResultColumn from"./DetectionResultColumn";import Codeword from"./Codeword";import BarcodeValue from"./BarcodeValue";import PDF417CodewordDecoder from"./PDF417CodewordDecoder";import DecodedBitStreamParser from"./DecodedBitStreamParser";import Formatter from"../../util/Formatter";var PDF417ScanningDecoder=function(){function e(){}return e.decode=function(t,r,o,n,u,a,l){for(var i,d=new BoundingBox(t,r,o,n,u),c=null,g=null,f=!0;;f=!1){if(null!=r&&(c=e.getRowIndicatorColumn(t,d,r,!0,a,l)),null!=n&&(g=e.getRowIndicatorColumn(t,d,n,!1,a,l)),null==(i=e.merge(c,g)))throw NotFoundException.getNotFoundInstance();var m=i.getBoundingBox();if(!f||null==m||!(m.getMinY()<d.getMinY()||m.getMaxY()>d.getMaxY()))break;d=m}i.setBoundingBox(d);var C=i.getBarcodeColumnCount()+1;i.setDetectionResultColumn(0,c),i.setDetectionResultColumn(C,g);for(var s=null!=c,h=1;h<=C;h++){var w=s?h:C-h;if(void 0===i.getDetectionResultColumn(w)){var v=void 0;v=0===w||w===C?new DetectionResultRowIndicatorColumn(d,0===w):new DetectionResultColumn(d),i.setDetectionResultColumn(w,v);for(var B=-1,D=B,E=d.getMinY();E<=d.getMaxY();E++){if((B=e.getStartColumn(i,w,E,s))<0||B>d.getMaxX()){if(-1===D)continue;B=D}var x=e.detectCodeword(t,d.getMinX(),d.getMaxX(),s,B,E,a,l);null!=x&&(v.setCodeword(E,x),D=B,a=Math.min(a,x.getWidth()),l=Math.max(l,x.getWidth()))}}}return e.createDecoderResult(i)},e.merge=function(t,r){if(null==t&&null==r)return null;var o=e.getBarcodeMetadata(t,r);if(null==o)return null;var n=BoundingBox.merge(e.adjustBoundingBox(t),e.adjustBoundingBox(r));return new DetectionResult(o,n)},e.adjustBoundingBox=function(t){var r,o;if(null==t)return null;var n=t.getRowHeights();if(null==n)return null;var u=e.getMax(n),a=0;try{for(var l=__values(n),i=l.next();!i.done;i=l.next()){var d=i.value;if(a+=u-d,d>0)break}}catch(e){r={error:e}}finally{try{i&&!i.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}for(var c=t.getCodewords(),g=0;a>0&&null==c[g];g++)a--;var f=0;for(g=n.length-1;g>=0&&(f+=u-n[g],!(n[g]>0));g--);for(g=c.length-1;f>0&&null==c[g];g--)f--;return t.getBoundingBox().addMissingRows(a,f,t.isLeft())},e.getMax=function(e){var t,r,o=-1;try{for(var n=__values(e),u=n.next();!u.done;u=n.next()){var a=u.value;o=Math.max(o,a)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return o},e.getBarcodeMetadata=function(e,t){var r,o;return null==e||null==(r=e.getBarcodeMetadata())?null==t?null:t.getBarcodeMetadata():null==t||null==(o=t.getBarcodeMetadata())?r:r.getColumnCount()!==o.getColumnCount()&&r.getErrorCorrectionLevel()!==o.getErrorCorrectionLevel()&&r.getRowCount()!==o.getRowCount()?null:r},e.getRowIndicatorColumn=function(t,r,o,n,u,a){for(var l=new DetectionResultRowIndicatorColumn(r,n),i=0;i<2;i++)for(var d=0===i?1:-1,c=Math.trunc(Math.trunc(o.getX())),g=Math.trunc(Math.trunc(o.getY()));g<=r.getMaxY()&&g>=r.getMinY();g+=d){var f=e.detectCodeword(t,0,t.getWidth(),n,c,g,u,a);null!=f&&(l.setCodeword(g,f),c=n?f.getStartX():f.getEndX())}return l},e.adjustCodewordCount=function(t,r){var o=r[0][1],n=o.getValue(),u=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-e.getNumberOfECCodeWords(t.getBarcodeECLevel());if(0===n.length){if(u<1||u>PDF417Common.MAX_CODEWORDS_IN_BARCODE)throw NotFoundException.getNotFoundInstance();o.setValue(u)}else n[0]!==u&&o.setValue(u)},e.createDecoderResult=function(t){var r=e.createBarcodeMatrix(t);e.adjustCodewordCount(t,r);for(var o=new Array,n=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),u=[],a=new Array,l=0;l<t.getBarcodeRowCount();l++)for(var i=0;i<t.getBarcodeColumnCount();i++){var d=r[l][i+1].getValue(),c=l*t.getBarcodeColumnCount()+i;0===d.length?o.push(c):1===d.length?n[c]=d[0]:(a.push(c),u.push(d))}for(var g=new Array(u.length),f=0;f<g.length;f++)g[f]=u[f];return e.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),n,PDF417Common.toIntArray(o),PDF417Common.toIntArray(a),g)},e.createDecoderResultFromAmbiguousValues=function(t,r,o,n,u){for(var a=new Int32Array(n.length),l=100;l-- >0;){for(var i=0;i<a.length;i++)r[n[i]]=u[i][a[i]];try{return e.decodeCodewords(r,t,o)}catch(e){if(!(e instanceof ChecksumException))throw e}if(0===a.length)throw ChecksumException.getChecksumInstance();for(i=0;i<a.length;i++){if(a[i]<u[i].length-1){a[i]++;break}if(a[i]=0,i===a.length-1)throw ChecksumException.getChecksumInstance()}}throw ChecksumException.getChecksumInstance()},e.createBarcodeMatrix=function(e){for(var t,r,o,n,u=Array.from({length:e.getBarcodeRowCount()},(function(){return new Array(e.getBarcodeColumnCount()+2)})),a=0;a<u.length;a++)for(var l=0;l<u[a].length;l++)u[a][l]=new BarcodeValue;var i=0;try{for(var d=__values(e.getDetectionResultColumns()),c=d.next();!c.done;c=d.next()){var g=c.value;if(null!=g)try{for(var f=(o=void 0,__values(g.getCodewords())),m=f.next();!m.done;m=f.next()){var C=m.value;if(null!=C){var s=C.getRowNumber();if(s>=0){if(s>=u.length)continue;u[s][i].setValue(C.getValue())}}}}catch(e){o={error:e}}finally{try{m&&!m.done&&(n=f.return)&&n.call(f)}finally{if(o)throw o.error}}i++}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}return u},e.isValidBarcodeColumn=function(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1},e.getStartColumn=function(t,r,o,n){var u,a,l=n?1:-1,i=null;if(e.isValidBarcodeColumn(t,r-l)&&(i=t.getDetectionResultColumn(r-l).getCodeword(o)),null!=i)return n?i.getEndX():i.getStartX();if(null!=(i=t.getDetectionResultColumn(r).getCodewordNearby(o)))return n?i.getStartX():i.getEndX();if(e.isValidBarcodeColumn(t,r-l)&&(i=t.getDetectionResultColumn(r-l).getCodewordNearby(o)),null!=i)return n?i.getEndX():i.getStartX();for(var d=0;e.isValidBarcodeColumn(t,r-l);){r-=l;try{for(var c=(u=void 0,__values(t.getDetectionResultColumn(r).getCodewords())),g=c.next();!g.done;g=c.next()){var f=g.value;if(null!=f)return(n?f.getEndX():f.getStartX())+l*d*(f.getEndX()-f.getStartX())}}catch(e){u={error:e}}finally{try{g&&!g.done&&(a=c.return)&&a.call(c)}finally{if(u)throw u.error}}d++}return n?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()},e.detectCodeword=function(t,r,o,n,u,a,l,i){u=e.adjustCodewordStartColumn(t,r,o,n,u,a);var d,c=e.getModuleBitCount(t,r,o,n,u,a);if(null==c)return null;var g=MathUtils.sum(c);if(n)d=u+g;else{for(var f=0;f<c.length/2;f++){var m=c[f];c[f]=c[c.length-1-f],c[c.length-1-f]=m}u=(d=u)-g}if(!e.checkCodewordSkew(g,l,i))return null;var C=PDF417CodewordDecoder.getDecodedValue(c),s=PDF417Common.getCodeword(C);return-1===s?null:new Codeword(u,d,e.getCodewordBucketNumber(C),s)},e.getModuleBitCount=function(e,t,r,o,n,u){for(var a=n,l=new Int32Array(8),i=0,d=o?1:-1,c=o;(o?a<r:a>=t)&&i<l.length;)e.get(a,u)===c?(l[i]++,a+=d):(i++,c=!c);return i===l.length||a===(o?r:t)&&i===l.length-1?l:null},e.getNumberOfECCodeWords=function(e){return 2<<e},e.adjustCodewordStartColumn=function(t,r,o,n,u,a){for(var l=u,i=n?-1:1,d=0;d<2;d++){for(;(n?l>=r:l<o)&&n===t.get(l,a);){if(Math.abs(u-l)>e.CODEWORD_SKEW_SIZE)return u;l+=i}i=-i,n=!n}return l},e.checkCodewordSkew=function(t,r,o){return r-e.CODEWORD_SKEW_SIZE<=t&&t<=o+e.CODEWORD_SKEW_SIZE},e.decodeCodewords=function(t,r,o){if(0===t.length)throw FormatException.getFormatInstance();var n=1<<r+1,u=e.correctErrors(t,o,n);e.verifyCodewordCount(t,n);var a=DecodedBitStreamParser.decode(t,""+r);return a.setErrorsCorrected(u),a.setErasures(o.length),a},e.correctErrors=function(t,r,o){if(null!=r&&r.length>o/2+e.MAX_ERRORS||o<0||o>e.MAX_EC_CODEWORDS)throw ChecksumException.getChecksumInstance();return e.errorCorrection.decode(t,o,r)},e.verifyCodewordCount=function(e,t){if(e.length<4)throw FormatException.getFormatInstance();var r=e[0];if(r>e.length)throw FormatException.getFormatInstance();if(0===r){if(!(t<e.length))throw FormatException.getFormatInstance();e[0]=e.length-t}},e.getBitCountForCodeword=function(e){for(var t=new Int32Array(8),r=0,o=t.length-1;!((1&e)!==r&&(r=1&e,--o<0));)t[o]++,e>>=1;return t},e.getCodewordBucketNumber=function(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)},e.getCodewordBucketNumber_number=function(t){return e.getCodewordBucketNumber(e.getBitCountForCodeword(t))},e.getCodewordBucketNumber_Int32Array=function(e){return(e[0]-e[2]+e[4]-e[6]+9)%9},e.toString=function(e){for(var t=new Formatter,r=0;r<e.length;r++){t.format("Row %2d: ",r);for(var o=0;o<e[r].length;o++){var n=e[r][o];0===n.getValue().length?t.format("        ",null):t.format("%4d(%2d)",n.getValue()[0],n.getConfidence(n.getValue()[0]))}t.format("%n")}return t.toString()},e.CODEWORD_SKEW_SIZE=2,e.MAX_ERRORS=3,e.MAX_EC_CODEWORDS=512,e.errorCorrection=new ErrorCorrection,e}();export default PDF417ScanningDecoder;
//# sourceMappingURL=/sm/6fe683b48406f0c6997f12b9340465500a947964d2b7ddff895122f929eb2b5d.map